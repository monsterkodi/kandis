// koffee 1.12.0

/*
 0000000  00000000   000   000  00     00  0000000  
000       000   000  000   000  000   000  000   000
000       0000000    000   000  000000000  0000000  
000       000   000  000   000  000 0 000  000   000
 0000000  000   000   0000000   000   000  0000000
 */
var Crumb, File, elem, kpos, ref, slash,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), elem = ref.elem, kpos = ref.kpos, slash = ref.slash;

File = require('../tools/file');

Crumb = (function() {
    function Crumb(column) {
        this.column = column;
        this.onMouseUp = bind(this.onMouseUp, this);
        this.onMouseDown = bind(this.onMouseDown, this);
        this.elem = elem({
            "class": 'crumb'
        });
        this.elem.columnIndex = this.column.index;
        this.elem.addEventListener('mousedown', this.onMouseDown);
        this.elem.addEventListener('mouseup', this.onMouseUp);
        this.column.div.insertBefore(this.elem, this.column.div.firstChild);
    }

    Crumb.prototype.onMouseDown = function(event) {
        return this.downPos = kpos(window.win.getBounds());
    };

    Crumb.prototype.onMouseUp = function(event) {
        var br, root, upPos;
        if (!this.downPos) {
            return;
        }
        upPos = kpos(window.win.getBounds());
        if (upPos.to(this.downPos).length() > 0) {
            delete this.downPos;
            this.column.focus();
            return;
        }
        if (this.column.index === 0) {
            if (event.target.id) {
                this.column.browser.browse(event.target.id);
            } else {
                root = this.elem.firstChild;
                br = root.getBoundingClientRect();
                if (kpos(event).x < br.left) {
                    this.column.browser.browse(root.id);
                } else {
                    this.column.browser.browse(this.column.parent.file);
                }
            }
        } else {
            this.column.makeRoot();
        }
        return delete this.downPos;
    };

    Crumb.prototype.setFile = function(file) {
        if (this.column.index === 0) {
            return this.elem.innerHTML = File.crumbSpan(slash.tilde(file));
        } else {
            return this.elem.innerHTML = slash.base(file);
        }
    };

    Crumb.prototype.clear = function() {
        return this.elem.innerHTML = '';
    };

    return Crumb;

})();

module.exports = Crumb;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J1bWIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vY29mZmVlL2Jyb3dzZXIiLCJzb3VyY2VzIjpbImNydW1iLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSxtQ0FBQTtJQUFBOztBQVFBLE1BQXdCLE9BQUEsQ0FBUSxLQUFSLENBQXhCLEVBQUUsZUFBRixFQUFRLGVBQVIsRUFBYzs7QUFFZCxJQUFBLEdBQU8sT0FBQSxDQUFRLGVBQVI7O0FBRUQ7SUFFQyxlQUFDLE1BQUQ7UUFBQyxJQUFDLENBQUEsU0FBRDs7O1FBRUEsSUFBQyxDQUFBLElBQUQsR0FBUSxJQUFBLENBQUs7WUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFNLE9BQU47U0FBTDtRQUNSLElBQUMsQ0FBQSxJQUFJLENBQUMsV0FBTixHQUFvQixJQUFDLENBQUEsTUFBTSxDQUFDO1FBQzVCLElBQUMsQ0FBQSxJQUFJLENBQUMsZ0JBQU4sQ0FBdUIsV0FBdkIsRUFBbUMsSUFBQyxDQUFBLFdBQXBDO1FBQ0EsSUFBQyxDQUFBLElBQUksQ0FBQyxnQkFBTixDQUF1QixTQUF2QixFQUFtQyxJQUFDLENBQUEsU0FBcEM7UUFDQSxJQUFDLENBQUEsTUFBTSxDQUFDLEdBQUcsQ0FBQyxZQUFaLENBQXlCLElBQUMsQ0FBQSxJQUExQixFQUFnQyxJQUFDLENBQUEsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUE1QztJQU5EOztvQkFRSCxXQUFBLEdBQWEsU0FBQyxLQUFEO2VBRVQsSUFBQyxDQUFBLE9BQUQsR0FBVyxJQUFBLENBQUssTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFYLENBQUEsQ0FBTDtJQUZGOztvQkFJYixTQUFBLEdBQVcsU0FBQyxLQUFEO0FBRVAsWUFBQTtRQUFBLElBQVUsQ0FBSSxJQUFDLENBQUEsT0FBZjtBQUFBLG1CQUFBOztRQUVBLEtBQUEsR0FBUSxJQUFBLENBQUssTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFYLENBQUEsQ0FBTDtRQUVSLElBQUcsS0FBSyxDQUFDLEVBQU4sQ0FBUyxJQUFDLENBQUEsT0FBVixDQUFrQixDQUFDLE1BQW5CLENBQUEsQ0FBQSxHQUE4QixDQUFqQztZQUNJLE9BQU8sSUFBQyxDQUFBO1lBQ1IsSUFBQyxDQUFBLE1BQU0sQ0FBQyxLQUFSLENBQUE7QUFDQSxtQkFISjs7UUFLQSxJQUFHLElBQUMsQ0FBQSxNQUFNLENBQUMsS0FBUixLQUFpQixDQUFwQjtZQUNJLElBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFoQjtnQkFDSSxJQUFDLENBQUEsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFoQixDQUF1QixLQUFLLENBQUMsTUFBTSxDQUFDLEVBQXBDLEVBREo7YUFBQSxNQUFBO2dCQUdJLElBQUEsR0FBTyxJQUFDLENBQUEsSUFBSSxDQUFDO2dCQUNiLEVBQUEsR0FBSyxJQUFJLENBQUMscUJBQUwsQ0FBQTtnQkFDTCxJQUFHLElBQUEsQ0FBSyxLQUFMLENBQVcsQ0FBQyxDQUFaLEdBQWdCLEVBQUUsQ0FBQyxJQUF0QjtvQkFDSSxJQUFDLENBQUEsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFoQixDQUF1QixJQUFJLENBQUMsRUFBNUIsRUFESjtpQkFBQSxNQUFBO29CQUdJLElBQUMsQ0FBQSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQWhCLENBQXVCLElBQUMsQ0FBQSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQXRDLEVBSEo7aUJBTEo7YUFESjtTQUFBLE1BQUE7WUFXSSxJQUFDLENBQUEsTUFBTSxDQUFDLFFBQVIsQ0FBQSxFQVhKOztlQWFBLE9BQU8sSUFBQyxDQUFBO0lBeEJEOztvQkEwQlgsT0FBQSxHQUFTLFNBQUMsSUFBRDtRQUdMLElBQUcsSUFBQyxDQUFBLE1BQU0sQ0FBQyxLQUFSLEtBQWlCLENBQXBCO21CQUNJLElBQUMsQ0FBQSxJQUFJLENBQUMsU0FBTixHQUFrQixJQUFJLENBQUMsU0FBTCxDQUFlLEtBQUssQ0FBQyxLQUFOLENBQVksSUFBWixDQUFmLEVBRHRCO1NBQUEsTUFBQTttQkFHSSxJQUFDLENBQUEsSUFBSSxDQUFDLFNBQU4sR0FBa0IsS0FBSyxDQUFDLElBQU4sQ0FBVyxJQUFYLEVBSHRCOztJQUhLOztvQkFRVCxLQUFBLEdBQU8sU0FBQTtlQUFHLElBQUMsQ0FBQSxJQUFJLENBQUMsU0FBTixHQUFrQjtJQUFyQjs7Ozs7O0FBRVgsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbiAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAgICAgIDAwICAwMDAwMDAwICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcbjAwMCAgICAgICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDBcbiAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICBcbiMjI1xuXG57IGVsZW0sIGtwb3MsIHNsYXNoIH0gPSByZXF1aXJlICdreGsnXG5cbkZpbGUgPSByZXF1aXJlICcuLi90b29scy9maWxlJ1xuXG5jbGFzcyBDcnVtYlxuXG4gICAgQDogKEBjb2x1bW4pIC0+XG4gICAgICAgIFxuICAgICAgICBAZWxlbSA9IGVsZW0gY2xhc3M6J2NydW1iJ1xuICAgICAgICBAZWxlbS5jb2x1bW5JbmRleCA9IEBjb2x1bW4uaW5kZXhcbiAgICAgICAgQGVsZW0uYWRkRXZlbnRMaXN0ZW5lciAnbW91c2Vkb3duJyBAb25Nb3VzZURvd25cbiAgICAgICAgQGVsZW0uYWRkRXZlbnRMaXN0ZW5lciAnbW91c2V1cCcgICBAb25Nb3VzZVVwXG4gICAgICAgIEBjb2x1bW4uZGl2Lmluc2VydEJlZm9yZSBAZWxlbSwgQGNvbHVtbi5kaXYuZmlyc3RDaGlsZFxuXG4gICAgb25Nb3VzZURvd246IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIEBkb3duUG9zID0ga3BvcyB3aW5kb3cud2luLmdldEJvdW5kcygpXG4gICAgICAgICAgICBcbiAgICBvbk1vdXNlVXA6IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpZiBub3QgQGRvd25Qb3NcbiAgICAgICAgXG4gICAgICAgIHVwUG9zID0ga3BvcyB3aW5kb3cud2luLmdldEJvdW5kcygpXG4gICAgICAgIFxuICAgICAgICBpZiB1cFBvcy50byhAZG93blBvcykubGVuZ3RoKCkgPiAwXG4gICAgICAgICAgICBkZWxldGUgQGRvd25Qb3NcbiAgICAgICAgICAgIEBjb2x1bW4uZm9jdXMoKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIFxuICAgICAgICBpZiBAY29sdW1uLmluZGV4ID09IDBcbiAgICAgICAgICAgIGlmIGV2ZW50LnRhcmdldC5pZFxuICAgICAgICAgICAgICAgIEBjb2x1bW4uYnJvd3Nlci5icm93c2UgZXZlbnQudGFyZ2V0LmlkXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcm9vdCA9IEBlbGVtLmZpcnN0Q2hpbGRcbiAgICAgICAgICAgICAgICBiciA9IHJvb3QuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICAgICAgICAgICAgICBpZiBrcG9zKGV2ZW50KS54IDwgYnIubGVmdFxuICAgICAgICAgICAgICAgICAgICBAY29sdW1uLmJyb3dzZXIuYnJvd3NlIHJvb3QuaWRcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIEBjb2x1bW4uYnJvd3Nlci5icm93c2UgQGNvbHVtbi5wYXJlbnQuZmlsZVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAY29sdW1uLm1ha2VSb290KClcbiAgICAgICAgICAgIFxuICAgICAgICBkZWxldGUgQGRvd25Qb3NcbiAgICAgICAgXG4gICAgc2V0RmlsZTogKGZpbGUpIC0+XG4gICAgICAgIFxuICAgICAgICAjIGtsb2cgJ3NldEZpbGUnIGZpbGVcbiAgICAgICAgaWYgQGNvbHVtbi5pbmRleCA9PSAwXG4gICAgICAgICAgICBAZWxlbS5pbm5lckhUTUwgPSBGaWxlLmNydW1iU3BhbiBzbGFzaC50aWxkZSBmaWxlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBlbGVtLmlubmVySFRNTCA9IHNsYXNoLmJhc2UgZmlsZVxuICAgICAgICBcbiAgICBjbGVhcjogLT4gQGVsZW0uaW5uZXJIVE1MID0gJydcbiAgICBcbm1vZHVsZS5leHBvcnRzID0gQ3J1bWJcbiJdfQ==
//# sourceURL=../../coffee/browser/crumb.coffee