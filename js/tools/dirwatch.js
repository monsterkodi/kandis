// koffee 1.12.0

/*
0000000    000  00000000   000   000   0000000   000000000   0000000  000   000  
000   000  000  000   000  000 0 000  000   000     000     000       000   000  
000   000  000  0000000    000000000  000000000     000     000       000000000  
000   000  000  000   000  000   000  000   000     000     000       000   000  
0000000    000  000   000  00     00  000   000     000      0000000  000   000
 */
var DirWatch, klog, post, ref, watch;

ref = require('kxk'), klog = ref.klog, post = ref.post, watch = ref.watch;

DirWatch = (function() {
    function DirWatch() {}

    DirWatch.watches = {};

    DirWatch.watch = function(dir) {
        var watcher;
        if (DirWatch.watches[dir]) {
            return;
        }
        klog("watch " + dir);
        watcher = watch.dir(dir);
        watcher.on('change', function(info) {
            if (info.change !== 'change') {
                klog('info', info.change, info.path);
                return post.emit('dirChanged', info.dir);
            }
        });
        watcher.on('error', function(err) {
            return console.error("watch.error " + err);
        });
        return DirWatch.watches[dir] = watcher;
    };

    DirWatch.unwatch = function(dir) {
        var ref1;
        klog("unwatch " + dir);
        if ((ref1 = DirWatch.watches[dir]) != null) {
            ref1.close();
        }
        return delete DirWatch.watches[dir];
    };

    return DirWatch;

})();

module.exports = DirWatch;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlyd2F0Y2guanMiLCJzb3VyY2VSb290IjoiLi4vLi4vY29mZmVlL3Rvb2xzIiwic291cmNlcyI6WyJkaXJ3YXRjaC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUE7O0FBUUEsTUFBd0IsT0FBQSxDQUFRLEtBQVIsQ0FBeEIsRUFBRSxlQUFGLEVBQVEsZUFBUixFQUFjOztBQUVSOzs7SUFFRixRQUFDLENBQUEsT0FBRCxHQUFXOztJQUVYLFFBQUMsQ0FBQSxLQUFELEdBQVEsU0FBQyxHQUFEO0FBRUosWUFBQTtRQUFBLElBQVUsUUFBUSxDQUFDLE9BQVEsQ0FBQSxHQUFBLENBQTNCO0FBQUEsbUJBQUE7O1FBQ0EsSUFBQSxDQUFLLFFBQUEsR0FBUyxHQUFkO1FBRUEsT0FBQSxHQUFVLEtBQUssQ0FBQyxHQUFOLENBQVUsR0FBVjtRQUNWLE9BQU8sQ0FBQyxFQUFSLENBQVcsUUFBWCxFQUFvQixTQUFDLElBQUQ7WUFDaEIsSUFBRyxJQUFJLENBQUMsTUFBTCxLQUFlLFFBQWxCO2dCQUNJLElBQUEsQ0FBSyxNQUFMLEVBQVksSUFBSSxDQUFDLE1BQWpCLEVBQXlCLElBQUksQ0FBQyxJQUE5Qjt1QkFDQSxJQUFJLENBQUMsSUFBTCxDQUFVLFlBQVYsRUFBdUIsSUFBSSxDQUFDLEdBQTVCLEVBRko7O1FBRGdCLENBQXBCO1FBSUEsT0FBTyxDQUFDLEVBQVIsQ0FBVyxPQUFYLEVBQW1CLFNBQUMsR0FBRDttQkFBTyxPQUFBLENBQUUsS0FBRixDQUFRLGNBQUEsR0FBZSxHQUF2QjtRQUFQLENBQW5CO2VBQ0EsUUFBUSxDQUFDLE9BQVEsQ0FBQSxHQUFBLENBQWpCLEdBQXdCO0lBWHBCOztJQWFSLFFBQUMsQ0FBQSxPQUFELEdBQVUsU0FBQyxHQUFEO0FBRU4sWUFBQTtRQUFBLElBQUEsQ0FBSyxVQUFBLEdBQVcsR0FBaEI7O2dCQUNxQixDQUFFLEtBQXZCLENBQUE7O2VBQ0EsT0FBTyxRQUFRLENBQUMsT0FBUSxDQUFBLEdBQUE7SUFKbEI7Ozs7OztBQU1kLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwICAgIDAwMCAgMDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICBcbjAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuMDAwICAgMDAwICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIDAwMDAwMDAwMCAgXG4wMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwICBcbjAwMDAwMDAgICAgMDAwICAwMDAgICAwMDAgIDAwICAgICAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIFxuIyMjXG5cbnsga2xvZywgcG9zdCwgd2F0Y2ggfSA9IHJlcXVpcmUgJ2t4aydcblxuY2xhc3MgRGlyV2F0Y2hcbiAgICAgICBcbiAgICBAd2F0Y2hlcyA9IHt9XG4gICAgICAgIFxuICAgIEB3YXRjaDogKGRpcikgLT5cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpZiBEaXJXYXRjaC53YXRjaGVzW2Rpcl1cbiAgICAgICAga2xvZyBcIndhdGNoICN7ZGlyfVwiXG4gICAgICAgIFxuICAgICAgICB3YXRjaGVyID0gd2F0Y2guZGlyIGRpclxuICAgICAgICB3YXRjaGVyLm9uICdjaGFuZ2UnIChpbmZvKSAtPiBcbiAgICAgICAgICAgIGlmIGluZm8uY2hhbmdlICE9ICdjaGFuZ2UnXG4gICAgICAgICAgICAgICAga2xvZyAnaW5mbycgaW5mby5jaGFuZ2UsIGluZm8ucGF0aFxuICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAnZGlyQ2hhbmdlZCcgaW5mby5kaXJcbiAgICAgICAgd2F0Y2hlci5vbiAnZXJyb3InIChlcnIpIC0+IGVycm9yIFwid2F0Y2guZXJyb3IgI3tlcnJ9XCJcbiAgICAgICAgRGlyV2F0Y2gud2F0Y2hlc1tkaXJdID0gd2F0Y2hlclxuICAgICAgICBcbiAgICBAdW53YXRjaDogKGRpcikgLT4gXG4gICAgICAgIFxuICAgICAgICBrbG9nIFwidW53YXRjaCAje2Rpcn1cIlxuICAgICAgICBEaXJXYXRjaC53YXRjaGVzW2Rpcl0/LmNsb3NlKClcbiAgICAgICAgZGVsZXRlIERpcldhdGNoLndhdGNoZXNbZGlyXVxuXG5tb2R1bGUuZXhwb3J0cyA9IERpcldhdGNoXG4iXX0=
//# sourceURL=../../coffee/tools/dirwatch.coffee