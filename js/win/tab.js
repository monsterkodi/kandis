// koffee 0.56.0

/*
000000000   0000000   0000000  
   000     000   000  000   000
   000     000000000  0000000  
   000     000   000  000   000
   000     000   000  0000000
 */
var File, Tab, Watcher, _, elem, kerror, post, ref, render, slash, syntax, tooltip;

ref = require('kxk'), post = ref.post, tooltip = ref.tooltip, slash = ref.slash, elem = ref.elem, kerror = ref.kerror, _ = ref._;

File = require('../tools/file');

Watcher = require('../tools/watcher');

render = require('../editor/render');

syntax = require('../editor/syntax');

Tab = (function() {
    function Tab(tabs, file) {
        this.tabs = tabs;
        this.file = file;
        this.dirty = false;
        this.div = elem({
            "class": 'tab',
            text: ''
        });
        this.tabs.div.appendChild(this.div);
        if (!this.file.startsWith('untitled')) {
            this.pkg = slash.pkg(this.file);
            if (this.pkg != null) {
                this.pkg = slash.basename(this.pkg);
            }
        }
        this.update();
        this.watcher = new Watcher(this.file);
    }

    Tab.prototype.foreignChanges = function(lineChanges) {
        if (this.foreign != null) {
            this.foreign;
        } else {
            this.foreign = [];
        }
        this.foreign.push(lineChanges);
        return this.update();
    };

    Tab.prototype.reload = function() {
        delete this.state;
        this.dirty = false;
        return this.update();
    };

    Tab.prototype.saveChanges = function() {
        var change, changes, i, j, len, len1, ref1, ref2;
        if (this.state) {
            if ((ref1 = this.foreign) != null ? ref1.length : void 0) {
                ref2 = this.foreign;
                for (i = 0, len = ref2.length; i < len; i++) {
                    changes = ref2[i];
                    for (j = 0, len1 = changes.length; j < len1; j++) {
                        change = changes[j];
                        switch (change.change) {
                            case 'changed':
                                this.state.state = this.state.state.changeLine(change.doIndex, change.after);
                                break;
                            case 'inserted':
                                this.state.state = this.state.state.insertLine(change.doIndex, change.after);
                                break;
                            case 'deleted':
                                this.state.state = this.state.state.deleteLine(change.doIndex);
                        }
                    }
                }
            }
            if (this.state.state) {
                return File.save(this.state.file, this.state.state.text(), (function(_this) {
                    return function(err) {
                        if (err) {
                            return kerror("tab.saveChanges failed " + err);
                        }
                        return _this.revert();
                    };
                })(this));
            } else {
                return kerror('tab.saveChanges -- nothing to save?');
            }
        } else {
            return post.emit('saveChanges');
        }
    };

    Tab.prototype.storeState = function() {
        if (window.editor.currentFile) {
            return this.state = window.editor["do"].tabState();
        }
    };

    Tab.prototype.restoreState = function() {
        var ref1;
        if (((ref1 = this.state) != null ? ref1.file : void 0) == null) {
            return kerror('no file in state?', this.state);
        }
        window.editor["do"].setTabState(this.state);
        return delete this.state;
    };

    Tab.prototype.update = function() {
        var diss, html, name, sep;
        this.div.innerHTML = '';
        this.div.classList.toggle('dirty', this.dirty);
        sep = '●';
        if (window.editor.newlineCharacters === '\r\n') {
            sep = '■';
        }
        this.div.appendChild(elem('span', {
            "class": 'dot',
            text: sep
        }));
        sep = "<span class='dot'>►</span>";
        this.pkgDiv = elem('span', {
            "class": 'pkg',
            html: this.pkg && (this.pkg + sep) || ''
        });
        this.div.appendChild(this.pkgDiv);
        diss = syntax.dissForTextAndSyntax(slash.basename(this.file), 'ko');
        name = elem('span', {
            "class": 'name',
            html: render.line(diss, {
                charWidth: 0
            })
        });
        this.div.appendChild(name);
        this.div.appendChild(elem('span', {
            "class": 'tabdrag'
        }));
        if (this.file != null) {
            diss = syntax.dissForTextAndSyntax(slash.tilde(this.file), 'ko');
            html = render.line(diss, {
                charWidth: 0
            });
            this.tooltip = new tooltip({
                elem: name,
                html: html,
                x: 0
            });
        }
        if (this.dirty) {
            this.div.appendChild(elem('span', {
                "class": 'dot',
                text: '●'
            }));
        }
        return this;
    };

    Tab.prototype.index = function() {
        return this.tabs.tabs.indexOf(this);
    };

    Tab.prototype.prev = function() {
        if (this.index() > 0) {
            return this.tabs.tab(this.index() - 1);
        }
    };

    Tab.prototype.next = function() {
        if (this.index() < this.tabs.numTabs() - 1) {
            return this.tabs.tab(this.index() + 1);
        }
    };

    Tab.prototype.nextOrPrev = function() {
        var ref1;
        return (ref1 = this.next()) != null ? ref1 : this.prev();
    };

    Tab.prototype.close = function() {
        var ref1;
        this.watcher.stop();
        if (this.dirty) {
            this.saveChanges();
        }
        this.div.remove();
        if ((ref1 = this.tooltip) != null) {
            ref1.del();
        }
        post.emit('tabClosed', this.file);
        return this;
    };

    Tab.prototype.hidePkg = function() {
        var ref1;
        return (ref1 = this.pkgDiv) != null ? ref1.style.display = 'none' : void 0;
    };

    Tab.prototype.showPkg = function() {
        var ref1;
        return (ref1 = this.pkgDiv) != null ? ref1.style.display = 'initial' : void 0;
    };

    Tab.prototype.setDirty = function(dirty) {
        if (this.dirty !== dirty) {
            this.dirty = dirty;
            return this.update();
        }
    };

    Tab.prototype.revert = function() {
        delete this.foreign;
        delete this.state;
        this.dirty = false;
        this.update();
        return this.tabs.update();
    };

    Tab.prototype.activate = function() {
        return post.emit('jumpToFile', {
            file: this.file
        });
    };

    Tab.prototype.finishActivation = function() {
        var changes, i, len, ref1, ref2;
        this.setActive();
        if (this.state != null) {
            this.restoreState();
        }
        if ((ref1 = this.foreign) != null ? ref1.length : void 0) {
            ref2 = this.foreign;
            for (i = 0, len = ref2.length; i < len; i++) {
                changes = ref2[i];
                window.editor["do"].foreignChanges(changes);
            }
            delete this.foreign;
        }
        return this.tabs.update();
    };

    Tab.prototype.isActive = function() {
        return this.div.classList.contains('active');
    };

    Tab.prototype.setActive = function() {
        if (!this.isActive()) {
            return this.div.classList.add('active');
        }
    };

    Tab.prototype.clearActive = function() {
        return this.div.classList.remove('active');
    };

    return Tab;

})();

module.exports = Tab;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQTs7QUFRQSxNQUE0QyxPQUFBLENBQVEsS0FBUixDQUE1QyxFQUFFLGVBQUYsRUFBUSxxQkFBUixFQUFpQixpQkFBakIsRUFBd0IsZUFBeEIsRUFBOEIsbUJBQTlCLEVBQXNDOztBQUV0QyxJQUFBLEdBQVUsT0FBQSxDQUFRLGVBQVI7O0FBQ1YsT0FBQSxHQUFVLE9BQUEsQ0FBUSxrQkFBUjs7QUFDVixNQUFBLEdBQVUsT0FBQSxDQUFRLGtCQUFSOztBQUNWLE1BQUEsR0FBVSxPQUFBLENBQVEsa0JBQVI7O0FBRUo7SUFFVyxhQUFDLElBQUQsRUFBUSxJQUFSO1FBQUMsSUFBQyxDQUFBLE9BQUQ7UUFBTyxJQUFDLENBQUEsT0FBRDtRQUVqQixJQUFDLENBQUEsS0FBRCxHQUFTO1FBQ1QsSUFBQyxDQUFBLEdBQUQsR0FBTyxJQUFBLENBQUs7WUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFPLEtBQVA7WUFBYyxJQUFBLEVBQU0sRUFBcEI7U0FBTDtRQUNQLElBQUMsQ0FBQSxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVYsQ0FBc0IsSUFBQyxDQUFBLEdBQXZCO1FBRUEsSUFBRyxDQUFJLElBQUMsQ0FBQSxJQUFJLENBQUMsVUFBTixDQUFpQixVQUFqQixDQUFQO1lBQ0ksSUFBQyxDQUFBLEdBQUQsR0FBTyxLQUFLLENBQUMsR0FBTixDQUFVLElBQUMsQ0FBQSxJQUFYO1lBQ1AsSUFBOEIsZ0JBQTlCO2dCQUFBLElBQUMsQ0FBQSxHQUFELEdBQU8sS0FBSyxDQUFDLFFBQU4sQ0FBZSxJQUFDLENBQUEsR0FBaEIsRUFBUDthQUZKOztRQUlBLElBQUMsQ0FBQSxNQUFELENBQUE7UUFFQSxJQUFDLENBQUEsT0FBRCxHQUFXLElBQUksT0FBSixDQUFZLElBQUMsQ0FBQSxJQUFiO0lBWkY7O2tCQWNiLGNBQUEsR0FBZ0IsU0FBQyxX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QVMsQ0FBQyxRQUFmLENBQXdCLFFBQXhCO0lBQUg7O2tCQUVWLFNBQUEsR0FBVyxTQUFBO1FBRVAsSUFBRyxDQUFJLElBQUMsQ0FBQSxRQUFELENBQUEsQ0FBUDttQkFDSSxJQUFDLENBQUEsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFmLENBQW1CLFFBQW5CLEVBREo7O0lBRk87O2tCQUtYLFdBQUEsR0FBYSxTQUFBO2VBRVQsSUFBQyxDQUFBLEdBQUcsQ0FBQyxTQUFTLENBQUMsTUFBZixDQUFzQixRQUF0QjtJQUZTOzs7Ozs7QUFJakIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgIDAwMCAgICAgMDAwMDAwMDAwICAwMDAwMDAwICBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAwMDAwICBcbiMjI1xuXG57IHBvc3QsIHRvb2x0aXAsIHNsYXNoLCBlbGVtLCBrZXJyb3IsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuRmlsZSAgICA9IHJlcXVpcmUgJy4uL3Rvb2xzL2ZpbGUnXG5XYXRjaGVyID0gcmVxdWlyZSAnLi4vdG9vbHMvd2F0Y2hlcidcbnJlbmRlciAgPSByZXF1aXJlICcuLi9lZGl0b3IvcmVuZGVyJ1xuc3ludGF4ICA9IHJlcXVpcmUgJy4uL2VkaXRvci9zeW50YXgnXG5cbmNsYXNzIFRhYlxuICAgIFxuICAgIGNvbnN0cnVjdG9yOiAoQHRhYnMsIEBmaWxlKSAtPlxuICAgICAgICBcbiAgICAgICAgQGRpcnR5ID0gZmFsc2VcbiAgICAgICAgQGRpdiA9IGVsZW0gY2xhc3M6ICd0YWInLCB0ZXh0OiAnJ1xuICAgICAgICBAdGFicy5kaXYuYXBwZW5kQ2hpbGQgQGRpdlxuXG4gICAgICAgIGlmIG5vdCBAZmlsZS5zdGFydHNXaXRoICd1bnRpdGxlZCdcbiAgICAgICAgICAgIEBwa2cgPSBzbGFzaC5wa2cgQGZpbGVcbiAgICAgICAgICAgIEBwa2cgPSBzbGFzaC5iYXNlbmFtZSBAcGtnIGlmIEBwa2c/XG4gICAgICAgIFxuICAgICAgICBAdXBkYXRlKClcbiAgICAgICAgXG4gICAgICAgIEB3YXRjaGVyID0gbmV3IFdhdGNoZXIgQGZpbGVcblxuICAgIGZvcmVpZ25DaGFuZ2VzOiAobGluZUNoYW5nZXMpIC0+XG4gICAgICAgIFxuICAgICAgICBAZm9yZWlnbiA/PSBbXVxuICAgICAgICBAZm9yZWlnbi5wdXNoIGxpbmVDaGFuZ2VzXG4gICAgICAgIEB1cGRhdGUoKSAgICAgICAgXG4gICAgICAgIFxuICAgIHJlbG9hZDogLT5cbiAgICAgICAgXG4gICAgICAgIGRlbGV0ZSBAc3RhdGVcbiAgICAgICAgQGRpcnR5ID0gZmFsc2VcbiAgICAgICAgQHVwZGF0ZSgpXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgIDAgICAgICAwMDAwMDAwMFxuICAgIFxuICAgIHNhdmVDaGFuZ2VzOiAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQHN0YXRlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIEBmb3JlaWduPy5sZW5ndGhcbiAgICAgICAgICAgICAgICBmb3IgY2hhbmdlcyBpbiBAZm9yZWlnblxuICAgICAgICAgICAgICAgICAgICBmb3IgY2hhbmdlIGluIGNoYW5nZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCBjaGFuZ2UuY2hhbmdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hlbiAnY2hhbmdlZCcgIHRoZW4gQHN0YXRlLnN0YXRlID0gQHN0YXRlLnN0YXRlLmNoYW5nZUxpbmUgY2hhbmdlLmRvSW5kZXgsIGNoYW5nZS5hZnRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZW4gJ2luc2VydGVkJyB0aGVuIEBzdGF0ZS5zdGF0ZSA9IEBzdGF0ZS5zdGF0ZS5pbnNlcnRMaW5lIGNoYW5nZS5kb0luZGV4LCBjaGFuZ2UuYWZ0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGVuICdkZWxldGVkJyAgdGhlbiBAc3RhdGUuc3RhdGUgPSBAc3RhdGUuc3RhdGUuZGVsZXRlTGluZSBjaGFuZ2UuZG9JbmRleFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBAc3RhdGUuc3RhdGUgXG4gICAgICAgICAgICAgICAgRmlsZS5zYXZlIEBzdGF0ZS5maWxlLCBAc3RhdGUuc3RhdGUudGV4dCgpLCAoZXJyKSA9PlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2Vycm9yIFwidGFiLnNhdmVDaGFuZ2VzIGZhaWxlZCAje2Vycn1cIiBpZiBlcnJcbiAgICAgICAgICAgICAgICAgICAgQHJldmVydCgpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAga2Vycm9yICd0YWIuc2F2ZUNoYW5nZXMgLS0gbm90aGluZyB0byBzYXZlPydcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcG9zdC5lbWl0ICdzYXZlQ2hhbmdlcydcbiAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgc3RvcmVTdGF0ZTogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIHdpbmRvdy5lZGl0b3IuY3VycmVudEZpbGVcbiAgICAgICAgICAgIEBzdGF0ZSA9IHdpbmRvdy5lZGl0b3IuZG8udGFiU3RhdGUoKVxuICAgICAgICBcbiAgICByZXN0b3JlU3RhdGU6IC0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ga2Vycm9yICdubyBmaWxlIGluIHN0YXRlPycsIEBzdGF0ZSBpZiBub3QgQHN0YXRlPy5maWxlP1xuICAgICAgICB3aW5kb3cuZWRpdG9yLmRvLnNldFRhYlN0YXRlIEBzdGF0ZVxuICAgICAgICBkZWxldGUgQHN0YXRlXG4gICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwICAgICAgICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgdXBkYXRlOiAtPlxuICAgICAgICAgICBcbiAgICAgICAgQGRpdi5pbm5lckhUTUwgPSAnJ1xuICAgICAgICBAZGl2LmNsYXNzTGlzdC50b2dnbGUgJ2RpcnR5JywgQGRpcnR5IFxuICAgICAgICAgICAgICAgIFxuICAgICAgICBzZXAgPSAn4pePJ1xuICAgICAgICBzZXAgPSAn4pagJyBpZiB3aW5kb3cuZWRpdG9yLm5ld2xpbmVDaGFyYWN0ZXJzID09ICdcXHJcXG4nXG4gICAgICAgIEBkaXYuYXBwZW5kQ2hpbGQgZWxlbSAnc3BhbicsIGNsYXNzOidkb3QnLCB0ZXh0OnNlcFxuICAgICAgICBcbiAgICAgICAgc2VwID0gXCI8c3BhbiBjbGFzcz0nZG90Jz7ilro8L3NwYW4+XCJcbiAgICAgICAgQHBrZ0RpdiA9IGVsZW0gJ3NwYW4nLCBjbGFzczoncGtnJywgaHRtbDogQHBrZyBhbmQgKEBwa2cgKyBzZXApIG9yICcnXG4gICAgICAgIEBkaXYuYXBwZW5kQ2hpbGQgQHBrZ0RpdlxuICAgICAgICAgICAgXG4gICAgICAgIGRpc3MgPSBzeW50YXguZGlzc0ZvclRleHRBbmRTeW50YXggc2xhc2guYmFzZW5hbWUoQGZpbGUpLCAna28nICMsIGpvaW46IHRydWUgXG4gICAgICAgIG5hbWUgPSBlbGVtICdzcGFuJywgY2xhc3M6J25hbWUnLCBodG1sOnJlbmRlci5saW5lIGRpc3MsIGNoYXJXaWR0aDowXG4gICAgICAgIEBkaXYuYXBwZW5kQ2hpbGQgbmFtZVxuXG4gICAgICAgIEBkaXYuYXBwZW5kQ2hpbGQgZWxlbSAnc3BhbicsIGNsYXNzOid0YWJkcmFnJ1xuICAgICAgICBcbiAgICAgICAgaWYgQGZpbGU/XG4gICAgICAgICAgICBkaXNzID0gc3ludGF4LmRpc3NGb3JUZXh0QW5kU3ludGF4IHNsYXNoLnRpbGRlKEBmaWxlKSwgJ2tvJyAjLCBqb2luOiB0cnVlIFxuICAgICAgICAgICAgaHRtbCA9IHJlbmRlci5saW5lIGRpc3MsIGNoYXJXaWR0aDowXG4gICAgICAgICAgICBAdG9vbHRpcCA9IG5ldyB0b29sdGlwIGVsZW06bmFtZSwgaHRtbDpodG1sLCB4OjBcbiAgICAgICAgICAgIFxuICAgICAgICBAZGl2LmFwcGVuZENoaWxkIGVsZW0gJ3NwYW4nLCBjbGFzczonZG90JywgdGV4dDon4pePJyBpZiBAZGlydHkgIyBAaXNEaXJ0eSgpXG4gICAgICAgIEBcblxuICAgIGluZGV4OiAtPiBAdGFicy50YWJzLmluZGV4T2YgQFxuICAgIHByZXY6ICAtPiBAdGFicy50YWIgQGluZGV4KCktMSBpZiBAaW5kZXgoKSA+IDBcbiAgICBuZXh0OiAgLT4gQHRhYnMudGFiIEBpbmRleCgpKzEgaWYgQGluZGV4KCkgPCBAdGFicy5udW1UYWJzKCktMVxuICAgIG5leHRPclByZXY6IC0+IEBuZXh0KCkgPyBAcHJldigpXG4gICAgICAgICAgICBcbiAgICBjbG9zZTogLT5cbiAgICAgICAgXG4gICAgICAgIEB3YXRjaGVyLnN0b3AoKVxuICAgICAgICBcbiAgICAgICAgaWYgQGRpcnR5XG4gICAgICAgICAgICBAc2F2ZUNoYW5nZXMoKVxuICAgICAgICAgICAgXG4gICAgICAgIEBkaXYucmVtb3ZlKClcbiAgICAgICAgQHRvb2x0aXA/LmRlbCgpXG4gICAgICAgIHBvc3QuZW1pdCAndGFiQ2xvc2VkJywgQGZpbGVcbiAgICAgICAgQFxuICAgIFxuICAgIGhpZGVQa2c6IC0+IEBwa2dEaXY/LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICBzaG93UGtnOiAtPiBAcGtnRGl2Py5zdHlsZS5kaXNwbGF5ID0gJ2luaXRpYWwnXG4gICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAwMDAgMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwMDAwMCAgICAgICAwMDAgICAgICAgMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAgICAgXG4gICAgICAgICAgICBcbiAgICBzZXREaXJ0eTogKGRpcnR5KSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQGRpcnR5ICE9IGRpcnR5XG4gICAgICAgICAgICBAZGlydHkgPSBkaXJ0eVxuICAgICAgICAgICAgQHVwZGF0ZSgpXG4gICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgMDAwIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgMCAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgcmV2ZXJ0OiAtPlxuICAgICAgICBcbiAgICAgICAgZGVsZXRlIEBmb3JlaWduXG4gICAgICAgIGRlbGV0ZSBAc3RhdGVcbiAgICAgICAgQGRpcnR5ID0gZmFsc2VcbiAgICAgICAgQHVwZGF0ZSgpXG4gICAgICAgIEB0YWJzLnVwZGF0ZSgpXG5cbiAgICAjICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAwMDAgMDAwICAgMDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgICAgIDAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGFjdGl2YXRlOiAtPiBcbiAgICAgICAgXG4gICAgICAgIHBvc3QuZW1pdCAnanVtcFRvRmlsZScsIGZpbGU6QGZpbGVcbiAgICAgICAgXG4gICAgZmluaXNoQWN0aXZhdGlvbjogLT5cbiAgICAgICAgXG4gICAgICAgIEBzZXRBY3RpdmUoKVxuICAgICAgICBcbiAgICAgICAgaWYgQHN0YXRlP1xuICAgICAgICAgICAgQHJlc3RvcmVTdGF0ZSgpXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgQGZvcmVpZ24/Lmxlbmd0aFxuICAgICAgICAgICAgZm9yIGNoYW5nZXMgaW4gQGZvcmVpZ25cbiAgICAgICAgICAgICAgICB3aW5kb3cuZWRpdG9yLmRvLmZvcmVpZ25DaGFuZ2VzIGNoYW5nZXNcbiAgICAgICAgICAgIGRlbGV0ZSBAZm9yZWlnblxuICAgICAgICAgICAgXG4gICAgICAgIEB0YWJzLnVwZGF0ZSgpXG5cbiAgICAjICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwIDAwMCAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgMCAgICAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBpc0FjdGl2ZTogLT4gQGRpdi5jbGFzc0xpc3QuY29udGFpbnMgJ2FjdGl2ZSdcbiAgICBcbiAgICBzZXRBY3RpdmU6IC0+IFxuICAgICAgICBcbiAgICAgICAgaWYgbm90IEBpc0FjdGl2ZSgpXG4gICAgICAgICAgICBAZGl2LmNsYXNzTGlzdC5hZGQgJ2FjdGl2ZSdcbiAgICAgICAgICAgIFxuICAgIGNsZWFyQWN0aXZlOiAtPlxuICAgICAgICBcbiAgICAgICAgQGRpdi5jbGFzc0xpc3QucmVtb3ZlICdhY3RpdmUnXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBUYWJcbiJdfQ==
//# sourceURL=../../coffee/win/tab.coffee