// koffee 1.12.0

/*
000000000  00000000  00000000   00     00  000  000   000   0000000   000    
   000     000       000   000  000   000  000  0000  000  000   000  000    
   000     0000000   0000000    000000000  000  000 0 000  000000000  000    
   000     000       000   000  000 0 000  000  000  0000  000   000  000    
   000     00000000  000   000  000   000  000  000   000  000   000  0000000
 */
var Terminal, TextEditor, kerror, kpos, popup, post, prefs, ref, salt, stopEvent, syntax,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

ref = require('kxk'), post = ref.post, stopEvent = ref.stopEvent, prefs = ref.prefs, popup = ref.popup, kpos = ref.kpos, kerror = ref.kerror;

salt = require('../tools/salt');

TextEditor = require('../editor/texteditor');

syntax = require('../editor/syntax');

Terminal = (function(superClass) {
    extend(Terminal, superClass);

    function Terminal(viewElem) {
        this.showContextMenu = bind(this.showContextMenu, this);
        this.onContextMenu = bind(this.onContextMenu, this);
        this.dequeueMeta = bind(this.dequeueMeta, this);
        Terminal.__super__.constructor.call(this, viewElem, {
            features: ['Scrollbar', 'Numbers', 'Minimap', 'Meta'],
            fontSize: 15
        });
        this.view.addEventListener("contextmenu", this.onContextMenu);
        this.metaQueue = [];
        this.setHeader(prefs.get('terminal:header', false));
        this.initInvisibles();
        this.setLines(['']);
    }

    Terminal.prototype.appendLineDiss = function(text, diss) {
        var tail;
        if (diss == null) {
            diss = [];
        }
        if (diss != null ? diss.length : void 0) {
            this.syntax.setDiss(this.numLines(), diss);
        }
        tail = this.cursorPos()[1] === this.numLines() - 1 && this.numCursors() === 1;
        this.appendText(text);
        if (tail) {
            this.singleCursorAtPos([0, this.numLines() - 1]);
            return this.scroll.to(this.scroll.fullHeight);
        }
    };

    Terminal.prototype.appendDiss = function(diss) {
        return this.appendLineDiss(syntax.lineForDiss(diss), diss);
    };

    Terminal.prototype.appendMeta = function(meta) {
        var i, l, len, ref1;
        if (meta == null) {
            return kerror('Terminal.appendMeta -- no meta?');
        }
        this.meta.append(meta);
        if (meta.diss != null) {
            return this.appendLineDiss(syntax.lineForDiss(meta.diss), meta.diss);
        } else if (meta.clss === 'salt') {
            this.appendMeta({
                clss: 'spacer'
            });
            ref1 = salt(meta.text).split('\n');
            for (i = 0, len = ref1.length; i < len; i++) {
                l = ref1[i];
                this.appendMeta({
                    clss: 'spacer',
                    text: '# ' + l
                });
            }
            return this.appendMeta({
                clss: 'spacer'
            });
        } else if (meta.clss === 'termCommand') {
            return this.appendLineDiss(meta.command, syntax.dissForTextAndSyntax(meta.command, 'term'));
        } else if (meta.text != null) {
            return this.appendLineDiss(meta.text);
        } else {
            return this.appendLineDiss('');
        }
    };

    Terminal.prototype.queueMeta = function(meta) {
        this.metaQueue.push(meta);
        clearTimeout(this.metaTimer);
        return this.metaTimer = setTimeout(this.dequeueMeta, 0);
    };

    Terminal.prototype.dequeueMeta = function() {
        var count, meta;
        count = 0;
        while (meta = this.metaQueue.shift()) {
            this.appendMeta(meta);
            count += 1;
            if (count > 20) {
                break;
            }
        }
        clearTimeout(this.metaTimer);
        if (this.metaQueue.length) {
            return this.metaTimer = setTimeout(this.dequeueMeta, 0);
        }
    };

    Terminal.prototype.clear = function() {
        this.meta.clear();
        this.singleCursorAtPos([0, 0]);
        return Terminal.__super__.clear.call(this);
    };

    Terminal.prototype.setAutoClear = function(state) {
        return prefs.set('terminal:autoclear', state);
    };

    Terminal.prototype.getAutoClear = function() {
        return prefs.get('terminal:autoclear', true);
    };

    Terminal.prototype.setHeader = function(state) {
        return prefs.set('terminal:header', state);
    };

    Terminal.prototype.getHeader = function() {
        return prefs.get('terminal:header', true);
    };

    Terminal.prototype.doAutoClear = function() {
        if (this.getAutoClear()) {
            return this.clear();
        }
    };

    Terminal.prototype.onContextMenu = function(event) {
        return stopEvent(event, this.showContextMenu(kpos(event)));
    };

    Terminal.prototype.showContextMenu = function(absPos) {
        var opt;
        if (absPos == null) {
            absPos = kpos(this.view.getBoundingClientRect().left, this.view.getBoundingClientRect().top);
        }
        opt = {
            items: [
                {
                    text: 'Clear',
                    combo: 'alt+k',
                    cb: this.clear
                }, {
                    text: 'Close',
                    combo: 'alt+ctrl+k',
                    cb: window.split.hideTerminal
                }
            ]
        };
        opt.x = absPos.x;
        opt.y = absPos.y;
        return popup.menu(opt);
    };

    Terminal.prototype.handleModKeyComboCharEvent = function(mod, key, combo, char, event) {
        var href, split;
        if ('unhandled' !== Terminal.__super__.handleModKeyComboCharEvent.call(this, mod, key, combo, char, event)) {
            return;
        }
        switch (combo) {
            case 'enter':
                if (href = this.meta.hrefAtLineIndex(this.cursorPos()[1])) {
                    post.emit('loadFile', "" + href);
                }
                return;
            case 'ctrl+enter':
            case 'command+enter':
                if (href = this.meta.hrefAtLineIndex(this.cursorPos()[1])) {
                    post.emit('loadFile', "" + href);
                    window.editor.focus();
                }
                return;
            case 'ctrl+s':
            case 'command+s':
                if (this.meta.saveChanges()) {
                    return;
                }
                break;
            case 'esc':
                split = window.split;
                split.focus('commandline-editor');
                split["do"]('enlarge editor');
                return;
        }
        return 'unhandled';
    };

    return Terminal;

})(TextEditor);

module.exports = Terminal;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVybWluYWwuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vY29mZmVlL3dpbiIsInNvdXJjZXMiOlsidGVybWluYWwuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLG9GQUFBO0lBQUE7Ozs7QUFRQSxNQUFrRCxPQUFBLENBQVEsS0FBUixDQUFsRCxFQUFFLGVBQUYsRUFBUSx5QkFBUixFQUFtQixpQkFBbkIsRUFBMEIsaUJBQTFCLEVBQWlDLGVBQWpDLEVBQXVDOztBQUV2QyxJQUFBLEdBQWEsT0FBQSxDQUFRLGVBQVI7O0FBQ2IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxzQkFBUjs7QUFDYixNQUFBLEdBQWEsT0FBQSxDQUFRLGtCQUFSOztBQUVQOzs7SUFFQyxrQkFBQyxRQUFEOzs7O1FBRUMsMENBQU0sUUFBTixFQUFnQjtZQUFBLFFBQUEsRUFBVSxDQUFDLFdBQUQsRUFBYSxTQUFiLEVBQXVCLFNBQXZCLEVBQWlDLE1BQWpDLENBQVY7WUFBb0QsUUFBQSxFQUFVLEVBQTlEO1NBQWhCO1FBRUEsSUFBQyxDQUFBLElBQUksQ0FBQyxnQkFBTixDQUF1QixhQUF2QixFQUFxQyxJQUFDLENBQUEsYUFBdEM7UUFFQSxJQUFDLENBQUEsU0FBRCxHQUFhO1FBRWIsSUFBQyxDQUFBLFNBQUQsQ0FBVyxLQUFLLENBQUMsR0FBTixDQUFVLGlCQUFWLEVBQTRCLEtBQTVCLENBQVg7UUFFQSxJQUFDLENBQUEsY0FBRCxDQUFBO1FBQ0EsSUFBQyxDQUFBLFFBQUQsQ0FBVSxDQUFDLEVBQUQsQ0FBVjtJQVhEOzt1QkFtQkgsY0FBQSxHQUFnQixTQUFDLElBQUQsRUFBTyxJQUFQO0FBRVosWUFBQTs7WUFGbUIsT0FBSzs7UUFFeEIsbUJBQXFDLElBQUksQ0FBRSxlQUEzQztZQUFBLElBQUMsQ0FBQSxNQUFNLENBQUMsT0FBUixDQUFnQixJQUFDLENBQUEsUUFBRCxDQUFBLENBQWhCLEVBQTZCLElBQTdCLEVBQUE7O1FBQ0EsSUFBQSxH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QUFZLG9CQUFaO2dCQUNBLEtBQUssRUFBQyxFQUFELEVBQUwsQ0FBWSxnQkFBWjtBQUNBO0FBaEJSO2VBa0JBO0lBdEJ3Qjs7OztHQWhKVDs7QUF3S3ZCLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwICAgICAwMCAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgIFxuICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgICBcbiAgIDAwMCAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgIDAwMCAwIDAwMCAgMDAwMDAwMDAwICAwMDAgICAgXG4gICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgIFxuICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDBcbiMjI1xuXG57IHBvc3QsIHN0b3BFdmVudCwgcHJlZnMsIHBvcHVwLCBrcG9zLCBrZXJyb3IgfSA9IHJlcXVpcmUgJ2t4aydcblxuc2FsdCAgICAgICA9IHJlcXVpcmUgJy4uL3Rvb2xzL3NhbHQnXG5UZXh0RWRpdG9yID0gcmVxdWlyZSAnLi4vZWRpdG9yL3RleHRlZGl0b3InXG5zeW50YXggICAgID0gcmVxdWlyZSAnLi4vZWRpdG9yL3N5bnRheCdcblxuY2xhc3MgVGVybWluYWwgZXh0ZW5kcyBUZXh0RWRpdG9yXG5cbiAgICBAOiAodmlld0VsZW0pIC0+XG4gICAgICAgIFxuICAgICAgICBzdXBlciB2aWV3RWxlbSwgZmVhdHVyZXM6IFsnU2Nyb2xsYmFyJyAnTnVtYmVycycgJ01pbmltYXAnICdNZXRhJ10sIGZvbnRTaXplOiAxNVxuICAgICAgICBcbiAgICAgICAgQHZpZXcuYWRkRXZlbnRMaXN0ZW5lciBcImNvbnRleHRtZW51XCIgQG9uQ29udGV4dE1lbnVcbiAgICAgICAgXG4gICAgICAgIEBtZXRhUXVldWUgPSBbXVxuICAgICAgICBcbiAgICAgICAgQHNldEhlYWRlciBwcmVmcy5nZXQgJ3Rlcm1pbmFsOmhlYWRlcicgZmFsc2VcbiAgICAgICAgXG4gICAgICAgIEBpbml0SW52aXNpYmxlcygpXG4gICAgICAgIEBzZXRMaW5lcyBbJyddXG4gICAgICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwICAgMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuICAgICAgICAgICAgICAgIFxuICAgIGFwcGVuZExpbmVEaXNzOiAodGV4dCwgZGlzcz1bXSkgLT5cbiAgICAgICAgXG4gICAgICAgIEBzeW50YXguc2V0RGlzcyBAbnVtTGluZXMoKSwgZGlzcyBpZiBkaXNzPy5sZW5ndGhcbiAgICAgICAgdGFpbCA9IEBjdXJzb3JQb3MoKVsxXSA9PSBAbnVtTGluZXMoKS0xIGFuZCBAbnVtQ3Vyc29ycygpID09IDFcbiAgICAgICAgQGFwcGVuZFRleHQgdGV4dFxuICAgICAgICBpZiB0YWlsXG4gICAgICAgICAgICBAc2luZ2xlQ3Vyc29yQXRQb3MgWzAsIEBudW1MaW5lcygpLTFdIFxuICAgICAgICAgICAgQHNjcm9sbC50byBAc2Nyb2xsLmZ1bGxIZWlnaHRcbiAgICAgICAgICAgIFxuICAgIGFwcGVuZERpc3M6IChkaXNzKSAtPiBAYXBwZW5kTGluZURpc3Mgc3ludGF4LmxpbmVGb3JEaXNzKGRpc3MpLCBkaXNzICAgICAgICBcbiAgICBcbiAgICAjIDAwICAgICAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMFxuICAgICMgMDAwMDAwMDAwICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMDBcbiAgICAjIDAwMCAwIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMFxuICAgIFxuICAgIGFwcGVuZE1ldGE6IChtZXRhKSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgbm90IG1ldGE/XG4gICAgICAgICAgICByZXR1cm4ga2Vycm9yICdUZXJtaW5hbC5hcHBlbmRNZXRhIC0tIG5vIG1ldGE/J1xuICAgICAgICAgICAgXG4gICAgICAgIEBtZXRhLmFwcGVuZCBtZXRhXG4gICAgICAgIFxuICAgICAgICBpZiBtZXRhLmRpc3M/XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEBhcHBlbmRMaW5lRGlzcyBzeW50YXgubGluZUZvckRpc3MobWV0YS5kaXNzKSwgbWV0YS5kaXNzIFxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIGVsc2UgaWYgbWV0YS5jbHNzID09ICdzYWx0J1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBAYXBwZW5kTWV0YSBjbHNzOiAnc3BhY2VyJ1xuICAgICAgICAgICAgZm9yIGwgaW4gc2FsdChtZXRhLnRleHQpLnNwbGl0ICdcXG4nXG4gICAgICAgICAgICAgICAgQGFwcGVuZE1ldGEgY2xzczonc3BhY2VyJyB0ZXh0OicjICcrbFxuICAgICAgICAgICAgQGFwcGVuZE1ldGEgY2xzczogJ3NwYWNlcidcbiAgICAgICAgICAgIFxuICAgICAgICBlbHNlIGlmIG1ldGEuY2xzcyA9PSAndGVybUNvbW1hbmQnXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEBhcHBlbmRMaW5lRGlzcyBtZXRhLmNvbW1hbmQsIHN5bnRheC5kaXNzRm9yVGV4dEFuZFN5bnRheCBtZXRhLmNvbW1hbmQsICd0ZXJtJ1xuXG4gICAgICAgIGVsc2UgaWYgbWV0YS50ZXh0P1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBAYXBwZW5kTGluZURpc3MgbWV0YS50ZXh0XG4gICAgICAgICAgICBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBAYXBwZW5kTGluZURpc3MgJydcbiAgICAgICAgXG4gICAgcXVldWVNZXRhOiAobWV0YSkgLT5cbiAgICAgICAgXG4gICAgICAgIEBtZXRhUXVldWUucHVzaCBtZXRhXG4gICAgICAgIGNsZWFyVGltZW91dCBAbWV0YVRpbWVyXG4gICAgICAgIEBtZXRhVGltZXIgPSBzZXRUaW1lb3V0IEBkZXF1ZXVlTWV0YSwgMFxuICAgICAgICBcbiAgICBkZXF1ZXVlTWV0YTogPT5cbiAgICAgICAgXG4gICAgICAgIGNvdW50ID0gMFxuICAgICAgICB3aGlsZSBtZXRhID0gQG1ldGFRdWV1ZS5zaGlmdCgpXG4gICAgICAgICAgICBAYXBwZW5kTWV0YSBtZXRhXG4gICAgICAgICAgICBjb3VudCArPSAxXG4gICAgICAgICAgICBicmVhayBpZiBjb3VudCA+IDIwXG4gICAgICAgIGNsZWFyVGltZW91dCBAbWV0YVRpbWVyXG4gICAgICAgIEBtZXRhVGltZXIgPSBzZXRUaW1lb3V0IEBkZXF1ZXVlTWV0YSwgMCBpZiBAbWV0YVF1ZXVlLmxlbmd0aFxuICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgY2xlYXI6IC0+XG4gICAgICAgIEBtZXRhLmNsZWFyKClcbiAgICAgICAgQHNpbmdsZUN1cnNvckF0UG9zIFswLDBdXG4gICAgICAgIHN1cGVyKClcblxuICAgIHNldEF1dG9DbGVhcjogKHN0YXRlKSAtPiBwcmVmcy5zZXQgJ3Rlcm1pbmFsOmF1dG9jbGVhcicgc3RhdGVcbiAgICBnZXRBdXRvQ2xlYXI6IC0+IHByZWZzLmdldCAndGVybWluYWw6YXV0b2NsZWFyJyB0cnVlXG5cbiAgICBzZXRIZWFkZXI6IChzdGF0ZSkgLT4gcHJlZnMuc2V0ICd0ZXJtaW5hbDpoZWFkZXInIHN0YXRlXG4gICAgZ2V0SGVhZGVyOiAtPiBwcmVmcy5nZXQgJ3Rlcm1pbmFsOmhlYWRlcicgdHJ1ZVxuICAgIFxuICAgIGRvQXV0b0NsZWFyOiAtPiBpZiBAZ2V0QXV0b0NsZWFyKCkgdGhlbiBAY2xlYXIoKVxuXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgIyBleGVjdXRlOiAoY21tZCkgLT5cbiAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICBcbiAgICAjIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAgICAgIFxuXG4gICAgb25Db250ZXh0TWVudTogKGV2ZW50KSA9PiBzdG9wRXZlbnQgZXZlbnQsIEBzaG93Q29udGV4dE1lbnUga3BvcyBldmVudFxuICAgICAgICAgICAgICBcbiAgICBzaG93Q29udGV4dE1lbnU6IChhYnNQb3MpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBub3QgYWJzUG9zP1xuICAgICAgICAgICAgYWJzUG9zID0ga3BvcyBAdmlldy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0LCBAdmlldy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3BcbiAgICAgICAgXG4gICAgICAgIG9wdCA9IGl0ZW1zOiBbXG4gICAgICAgICAgICB0ZXh0OiAgICdDbGVhcidcbiAgICAgICAgICAgIGNvbWJvOiAgJ2FsdCtrJyBcbiAgICAgICAgICAgIGNiOiAgICAgQGNsZWFyXG4gICAgICAgICxcbiAgICAgICAgICAgIHRleHQ6ICAgJ0Nsb3NlJ1xuICAgICAgICAgICAgY29tYm86ICAnYWx0K2N0cmwraydcbiAgICAgICAgICAgIGNiOiAgICAgd2luZG93LnNwbGl0LmhpZGVUZXJtaW5hbFxuICAgICAgICBdXG4gICAgICAgIFxuICAgICAgICBvcHQueCA9IGFic1Bvcy54XG4gICAgICAgIG9wdC55ID0gYWJzUG9zLnlcbiAgICAgICAgcG9wdXAubWVudSBvcHRcbiAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAgIDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgXG4gICAgXG4gICAgaGFuZGxlTW9kS2V5Q29tYm9DaGFyRXZlbnQ6IChtb2QsIGtleSwgY29tYm8sIGNoYXIsIGV2ZW50KSAtPlxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmICd1bmhhbmRsZWQnICE9IHN1cGVyIG1vZCwga2V5LCBjb21ibywgY2hhciwgZXZlbnRcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBjb21ib1xuICAgICAgICAgICAgd2hlbiAnZW50ZXInXG4gICAgICAgICAgICAgICAgaWYgaHJlZiA9IEBtZXRhLmhyZWZBdExpbmVJbmRleCBAY3Vyc29yUG9zKClbMV1cbiAgICAgICAgICAgICAgICAgICAgcG9zdC5lbWl0ICdsb2FkRmlsZScgXCIje2hyZWZ9XCIgXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICB3aGVuICdjdHJsK2VudGVyJyAnY29tbWFuZCtlbnRlcidcbiAgICAgICAgICAgICAgICBpZiBocmVmID0gQG1ldGEuaHJlZkF0TGluZUluZGV4IEBjdXJzb3JQb3MoKVsxXVxuICAgICAgICAgICAgICAgICAgICBwb3N0LmVtaXQgJ2xvYWRGaWxlJyBcIiN7aHJlZn1cIiBcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmVkaXRvci5mb2N1cygpXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICB3aGVuICdjdHJsK3MnICdjb21tYW5kK3MnXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlmIEBtZXRhLnNhdmVDaGFuZ2VzKClcbiAgICAgICAgICAgIHdoZW4gJ2VzYydcbiAgICAgICAgICAgICAgICBzcGxpdCA9IHdpbmRvdy5zcGxpdFxuICAgICAgICAgICAgICAgIHNwbGl0LmZvY3VzICdjb21tYW5kbGluZS1lZGl0b3InXG4gICAgICAgICAgICAgICAgc3BsaXQuZG8gICAgJ2VubGFyZ2UgZWRpdG9yJ1xuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAndW5oYW5kbGVkJ1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRlcm1pbmFsXG4iXX0=
//# sourceURL=../../coffee/win/terminal.coffee