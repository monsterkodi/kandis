// koffee 1.4.0

/*
00000000  000  000      00000000  000   000   0000000   000   000  0000000    000      00000000  00000000 
000       000  000      000       000   000  000   000  0000  000  000   000  000      000       000   000
000000    000  000      0000000   000000000  000000000  000 0 000  000   000  000      0000000   0000000  
000       000  000      000       000   000  000   000  000  0000  000   000  000      000       000   000
000       000  0000000  00000000  000   000  000   000  000   000  0000000    0000000  00000000  000   000
 */
var File, FileHandler, _, dialog, electron, empty, filelist, first, kerror, klog, post, prefs, ref, remote, reversed, slash, valid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), post = ref.post, reversed = ref.reversed, filelist = ref.filelist, empty = ref.empty, slash = ref.slash, first = ref.first, prefs = ref.prefs, klog = ref.klog, valid = ref.valid, kerror = ref.kerror, _ = ref._;

File = require('../tools/file');

electron = require('electron');

remote = electron.remote;

dialog = remote.dialog;

FileHandler = (function() {
    function FileHandler() {
        this.saveFileAs = bind(this.saveFileAs, this);
        this.openFile = bind(this.openFile, this);
        this.saveChanges = bind(this.saveChanges, this);
        this.saveFile = bind(this.saveFile, this);
        this.saveAll = bind(this.saveAll, this);
        this.removeFile = bind(this.removeFile, this);
        this.reloadFile = bind(this.reloadFile, this);
        this.reloadTab = bind(this.reloadTab, this);
        this.openFiles = bind(this.openFiles, this);
        this.loadFile = bind(this.loadFile, this);
        post.on('reloadFile', this.reloadFile);
        post.on('removeFile', this.removeFile);
        post.on('saveFileAs', this.saveFileAs);
        post.on('saveFile', this.saveFile);
        post.on('saveAll', this.saveAll);
        post.on('saveChanges', this.saveChanges);
        post.on('reloadTab', this.reloadTab);
        post.on('loadFile', this.loadFile);
        post.on('openFile', this.openFile);
        post.on('openFiles', this.openFiles);
    }

    FileHandler.prototype.loadFile = function(file, opt) {
        var activeTab, err, fileExists, filePos, ref1, tab;
        if (opt == null) {
            opt = {};
        }
        if ((file != null) && file.length <= 0) {
            file = null;
        }
        editor.saveScrollCursorsAndSelections();
        if (file != null) {
            ref1 = slash.splitFilePos(file), file = ref1[0], filePos = ref1[1];
            if (!file.startsWith('untitled')) {
                file = slash.resolve(file);
                try {
                    process.chdir(slash.dir(file));
                } catch (error) {
                    err = error;
                    kerror(err);
                }
            }
        }
        if (file !== (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0) || (opt != null ? opt.reload : void 0)) {
            if (fileExists = slash.fileExists(file)) {
                this.addToRecent(file);
            }
            tab = tabs.tab(file);
            if (empty(tab)) {
                tab = tabs.addTab(file);
            }
            if (activeTab = tabs.activeTab()) {
                if (tab !== activeTab) {
                    activeTab.clearActive();
                    if (activeTab.dirty) {
                        activeTab.storeState();
                    }
                }
            }
            editor.setCurrentFile(file);
            tab.finishActivation();
            editor.restoreScrollCursorsAndSelections();
            if (fileExists) {
                post.toOthers('fileLoaded', file, winID);
                post.emit('cwdSet', slash.dir(file));
            }
        }
        split.raise('editor');
        if ((filePos != null) && (filePos[0] || filePos[1])) {
            editor.singleCursorAtPos(filePos);
            return editor.scroll.cursorToTop();
        }
    };

    FileHandler.prototype.openFiles = function(ofiles, options) {
        var answer, file, files, i, len;
        if (ofiles != null ? ofiles.length : void 0) {
            files = filelist(ofiles, {
                ignoreHidden: false
            });
            if (files.length >= 10) {
                answer = dialog.showMessageBox({
                    type: 'warning',
                    buttons: ['Cancel', 'Open All'],
                    defaultId: 0,
                    cancelId: 0,
                    title: "A Lot of Files Warning",
                    message: "You have selected " + files.length + " files.",
                    detail: "Are you sure you want to open that many files?"
                });
                if (answer !== 1) {
                    return;
                }
            }
            if (files.length === 0) {
                return [];
            }
            window.stash.set('openFilePath', slash.dir(files[0]));
            if (!(options != null ? options.newWindow : void 0) && !(options != null ? options.newTab : void 0)) {
                file = slash.resolve(files.shift());
                this.loadFile(file);
            }
            for (i = 0, len = files.length; i < len; i++) {
                file = files[i];
                if (options != null ? options.newWindow : void 0) {
                    post.toMain('newWindowWithFile', file);
                } else {
                    post.emit('newTabWithFile', file);
                }
            }
            return ofiles;
        }
    };

    FileHandler.prototype.reloadTab = function(file) {
        if (file === (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0)) {
            return this.loadFile(typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0, {
                reload: true
            });
        } else {
            return post.emit('revertFile', file);
        }
    };

    FileHandler.prototype.reloadFile = function(file) {
        var tab;
        if (!file) {
            return this.reloadActiveTab();
        } else if (tab = tabs.tab(file)) {
            if (tab === tabs.activeTab()) {
                return this.reloadActiveTab();
            } else {
                return tab.reload();
            }
        }
    };

    FileHandler.prototype.reloadActiveTab = function() {
        var tab;
        if (tab = tabs.activeTab()) {
            tab.reload();
        }
        this.loadFile(editor.currentFile, {
            reload: true
        });
        if (editor.currentFile != null) {
            return post.toOtherWins('reloadTab', editor.currentFile);
        }
    };

    FileHandler.prototype.removeFile = function(file) {
        var neighborTab, tab;
        if (tab = tabs.tab(file)) {
            if (tab === tabs.activeTab()) {
                if (neighborTab = tab.nextOrPrev()) {
                    neighborTab.activate();
                }
            }
            klog('removeFile');
            return tabs.closeTab(tab);
        }
    };

    FileHandler.prototype.saveAll = function() {
        var i, len, ref1, results, tab;
        ref1 = tabs.tabs;
        results = [];
        for (i = 0, len = ref1.length; i < len; i++) {
            tab = ref1[i];
            if (tab.dirty) {
                if (tab === tabs.activeTab()) {
                    results.push(this.saveFile(tab.file));
                } else {
                    if (!tab.file.startsWith('untitled')) {
                        results.push(tab.saveChanges());
                    } else {
                        results.push(void 0);
                    }
                }
            } else {
                results.push(void 0);
            }
        }
        return results;
    };

    FileHandler.prototype.saveFile = function(file) {
        if (file != null) {
            file;
        } else {
            file = editor.currentFile;
        }
        if ((file == null) || file.startsWith('untitled')) {
            this.saveFileAs();
            return;
        }
        editor.stopWatcher();
        return File.save(file, editor.text(), function(err, saved) {
            editor.saveScrollCursorsAndSelections();
            if (valid(err)) {
                kerror("saving '" + file + "' failed:", err);
            } else {
                editor.setCurrentFile(saved);
                post.toOthers('fileSaved', saved, window.winID);
                post.emit('saved', saved);
            }
            return editor.restoreScrollCursorsAndSelections();
        });
    };

    FileHandler.prototype.addToRecent = function(file) {
        var recent;
        recent = window.state.get('recentFiles', []);
        if (file === first(recent)) {
            return;
        }
        _.pull(recent, file);
        recent.unshift(file);
        while (recent.length > prefs.get('recentFilesLength', 15)) {
            recent.pop();
        }
        window.state.set('recentFiles', recent);
        return commandline.commands.open.setHistory(reversed(recent));
    };

    FileHandler.prototype.saveChanges = function() {
        if ((editor.currentFile != null) && editor["do"].hasLineChanges() && slash.fileExists(editor.currentFile)) {
            return File.save(editor.currentFile, editor.text(), function(err) {
                if (err) {
                    return kerror("FileHandler.saveChanges failed " + err);
                }
            });
        }
    };

    FileHandler.prototype.openFile = function(opt) {
        var dir;
        if (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0) {
            dir = slash.dir(editor.currentFile);
        }
        if (dir != null) {
            dir;
        } else {
            dir = slash.resolve('.');
        }
        return dialog.showOpenDialog({
            title: "Open File",
            defaultPath: window.stash.get('openFilePath', dir),
            properties: ['openFile', 'multiSelections']
        }, function(files) {
            return post.emit('openFiles', files, opt);
        });
    };

    FileHandler.prototype.saveFileAs = function() {
        var defaultPath;
        defaultPath = slash.unslash(typeof editor !== "undefined" && editor !== null ? editor.currentDir() : void 0);
        return dialog.showSaveDialog({
            title: 'Save File As',
            defaultPath: defaultPath
        }).then((function(_this) {
            return function(result) {
                if (!result.cancelled && result.filePath) {
                    _this.addToRecent(result.filePath);
                    return _this.saveFile(result.filePath);
                }
            };
        })(this));
    };

    return FileHandler;

})();

module.exports = FileHandler;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZWhhbmRsZXIuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLDhIQUFBO0lBQUE7O0FBUUEsTUFBbUYsT0FBQSxDQUFRLEtBQVIsQ0FBbkYsRUFBRSxlQUFGLEVBQVEsdUJBQVIsRUFBa0IsdUJBQWxCLEVBQTRCLGlCQUE1QixFQUFtQyxpQkFBbkMsRUFBMEMsaUJBQTFDLEVBQWlELGlCQUFqRCxFQUF3RCxlQUF4RCxFQUE4RCxpQkFBOUQsRUFBcUUsbUJBQXJFLEVBQTZFOztBQUU3RSxJQUFBLEdBQVcsT0FBQSxDQUFRLGVBQVI7O0FBQ1gsUUFBQSxHQUFXLE9BQUEsQ0FBUSxVQUFSOztBQUNYLE1BQUEsR0FBVyxRQUFRLENBQUM7O0FBQ3BCLE1BQUEsR0FBVyxNQUFNLENBQUM7O0FBRVo7SUFFVyxxQkFBQTs7Ozs7Ozs7Ozs7UUFFVCxJQUFJLENBQUMsRUFBTCxDQUFRLFlBQVIsRUFBc0IsSUFBQyxDQUFBLFVBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxZQUFSLEVBQXNCLElBQUMsQ0FBQSxVQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsWUFBUixFQUFzQixJQUFDLENBQUEsVUFBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFVBQVIsRUFBc0IsSUFBQyxDQUFBLFFBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxTQUFSLEVBQXNCLElBQUMsQ0FBQSxPQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsYUFBUixFQUFzQixJQUFDLENBQUEsV0FBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFdBQVIsRUFBc0IsSUFBQyxDQUFBLFNBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxVQUFSLEVBQXNCLElBQUMsQ0FBQSxRQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsVUFBUixFQUFzQixJQUFDLENBQUEsUUFBdkI7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QTdCO1FBQVgsQ0FKTjtJQUpNOzswQkFnQlYsVUFBQSxHQUFZLFNBQUE7QUFFUixZQUFBO1FBQUEsV0FBQSxHQUFjLEtBQUssQ0FBQyxPQUFOLG9EQUFjLE1BQU0sQ0FBRSxVQUFSLENBQUEsVUFBZDtlQUNkLE1BQU0sQ0FBQyxjQUFQLENBQXNCO1lBQUEsS0FBQSxFQUFNLGNBQU47WUFBcUIsV0FBQSxFQUFZLFdBQWpDO1NBQXRCLENBQW1FLENBQUMsSUFBcEUsQ0FBeUUsQ0FBQSxTQUFBLEtBQUE7bUJBQUEsU0FBQyxNQUFEO2dCQUNyRSxJQUFHLENBQUksTUFBTSxDQUFDLFNBQVgsSUFBeUIsTUFBTSxDQUFDLFFBQW5DO29CQUNJLEtBQUMsQ0FBQSxXQUFELENBQWEsTUFBTSxDQUFDLFFBQXBCOzJCQUNBLEtBQUMsQ0FBQSxRQUFELENBQVUsTUFBTSxDQUFDLFFBQWpCLEVBRko7O1lBRHFFO1FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUF6RTtJQUhROzs7Ozs7QUFRaEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMCAgICAgIDAwMDAwMDAwICAwMDAwMDAwMCBcbjAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbjAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwICBcbjAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbjAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiMjI1xuXG57IHBvc3QsIHJldmVyc2VkLCBmaWxlbGlzdCwgZW1wdHksIHNsYXNoLCBmaXJzdCwgcHJlZnMsIGtsb2csIHZhbGlkLCBrZXJyb3IsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuRmlsZSAgICAgPSByZXF1aXJlICcuLi90b29scy9maWxlJ1xuZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbnJlbW90ZSAgID0gZWxlY3Ryb24ucmVtb3RlXG5kaWFsb2cgICA9IHJlbW90ZS5kaWFsb2dcblxuY2xhc3MgRmlsZUhhbmRsZXJcblxuICAgIGNvbnN0cnVjdG9yOiAoKSAtPlxuXG4gICAgICAgIHBvc3Qub24gJ3JlbG9hZEZpbGUnICBAcmVsb2FkRmlsZVxuICAgICAgICBwb3N0Lm9uICdyZW1vdmVGaWxlJyAgQHJlbW92ZUZpbGVcbiAgICAgICAgcG9zdC5vbiAnc2F2ZUZpbGVBcycgIEBzYXZlRmlsZUFzXG4gICAgICAgIHBvc3Qub24gJ3NhdmVGaWxlJyAgICBAc2F2ZUZpbGVcbiAgICAgICAgcG9zdC5vbiAnc2F2ZUFsbCcgICAgIEBzYXZlQWxsXG4gICAgICAgIHBvc3Qub24gJ3NhdmVDaGFuZ2VzJyBAc2F2ZUNoYW5nZXNcbiAgICAgICAgcG9zdC5vbiAncmVsb2FkVGFiJyAgIEByZWxvYWRUYWJcbiAgICAgICAgcG9zdC5vbiAnbG9hZEZpbGUnICAgIEBsb2FkRmlsZVxuICAgICAgICBwb3N0Lm9uICdvcGVuRmlsZScgICAgQG9wZW5GaWxlXG4gICAgICAgIHBvc3Qub24gJ29wZW5GaWxlcycgICBAb3BlbkZpbGVzXG4gICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwMDAwICAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGxvYWRGaWxlOiAoZmlsZSwgb3B0PXt9KSA9PlxuICAgIFxuICAgICAgICAjIGtsb2cgJ2xvYWRGaWxlJyBmaWxlXG4gICAgICAgIFxuICAgICAgICBmaWxlID0gbnVsbCBpZiBmaWxlPyBhbmQgZmlsZS5sZW5ndGggPD0gMFxuICAgIFxuICAgICAgICBlZGl0b3Iuc2F2ZVNjcm9sbEN1cnNvcnNBbmRTZWxlY3Rpb25zKClcbiAgICBcbiAgICAgICAgaWYgZmlsZT9cbiAgICAgICAgICAgIFtmaWxlLCBmaWxlUG9zXSA9IHNsYXNoLnNwbGl0RmlsZVBvcyBmaWxlXG4gICAgICAgICAgICBpZiBub3QgZmlsZS5zdGFydHNXaXRoICd1bnRpdGxlZCdcbiAgICAgICAgICAgICAgICBmaWxlID0gc2xhc2gucmVzb2x2ZSBmaWxlXG4gICAgICAgICAgICAgICAgIyBrbG9nICdsb2FkRmlsZScgZmlsZVxuICAgICAgICAgICAgICAgIHRyeVxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmNoZGlyIHNsYXNoLmRpciBmaWxlXG4gICAgICAgICAgICAgICAgICAgICMga2xvZyAnY3dkJyBwcm9jZXNzLmN3ZCgpXG4gICAgICAgICAgICAgICAgY2F0Y2ggZXJyXG4gICAgICAgICAgICAgICAgICAgIGtlcnJvciBlcnJcbiAgICBcbiAgICAgICAgaWYgZmlsZSAhPSBlZGl0b3I/LmN1cnJlbnRGaWxlIG9yIG9wdD8ucmVsb2FkXG4gICAgXG4gICAgICAgICAgICBpZiBmaWxlRXhpc3RzID0gc2xhc2guZmlsZUV4aXN0cyBmaWxlXG4gICAgICAgICAgICAgICAgQGFkZFRvUmVjZW50IGZpbGVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGFiID0gdGFicy50YWIgZmlsZVxuICAgICAgICAgICAgaWYgZW1wdHkgdGFiXG4gICAgICAgICAgICAgICAgdGFiID0gdGFicy5hZGRUYWIgZmlsZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBhY3RpdmVUYWIgPSB0YWJzLmFjdGl2ZVRhYigpXG4gICAgICAgICAgICAgICAgaWYgdGFiICE9IGFjdGl2ZVRhYlxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVUYWIuY2xlYXJBY3RpdmUoKVxuICAgICAgICAgICAgICAgICAgICBpZiBhY3RpdmVUYWIuZGlydHkgIyBhY3RpdmVUYWIuaXNEaXJ0eSgpXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVUYWIuc3RvcmVTdGF0ZSgpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBlZGl0b3Iuc2V0Q3VycmVudEZpbGUgZmlsZVxuICAgIFxuICAgICAgICAgICAgdGFiLmZpbmlzaEFjdGl2YXRpb24oKSAjIHNldEFjdGl2ZSwgcmVzdG9yZSBzdGF0ZSwgdXBkYXRlIHRhYnNcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZWRpdG9yLnJlc3RvcmVTY3JvbGxDdXJzb3JzQW5kU2VsZWN0aW9ucygpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIGZpbGVFeGlzdHNcbiAgICAgICAgICAgICAgICBwb3N0LnRvT3RoZXJzICdmaWxlTG9hZGVkJyBmaWxlLCB3aW5JRCAjIGluZGV4ZXJcbiAgICAgICAgICAgICAgICBwb3N0LmVtaXQgJ2N3ZFNldCcgc2xhc2guZGlyIGZpbGVcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgc3BsaXQucmFpc2UgJ2VkaXRvcidcbiAgICBcbiAgICAgICAgaWYgZmlsZVBvcz8gYW5kIChmaWxlUG9zWzBdIG9yIGZpbGVQb3NbMV0pXG4gICAgICAgICAgICBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRQb3MgZmlsZVBvc1xuICAgICAgICAgICAgZWRpdG9yLnNjcm9sbC5jdXJzb3JUb1RvcCgpXG5cbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgICAgICAgMDAwMDAwICAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgICAgICAwMDBcbiAgICAjICAwMDAwMDAwICAgMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMFxuICAgIFxuICAgIG9wZW5GaWxlczogKG9maWxlcywgb3B0aW9ucykgPT4gIyBjYWxsZWQgZnJvbSBmaWxlIGRpYWxvZywgb3BlbiBjb21tYW5kIGFuZCBicm93c2VyXG4gICAgXG4gICAgICAgIGlmIG9maWxlcz8ubGVuZ3RoXG4gICAgXG4gICAgICAgICAgICBmaWxlcyA9IGZpbGVsaXN0IG9maWxlcywgaWdub3JlSGlkZGVuOiBmYWxzZVxuICAgIFxuICAgICAgICAgICAgaWYgZmlsZXMubGVuZ3RoID49IDEwXG4gICAgICAgICAgICAgICAgYW5zd2VyID0gZGlhbG9nLnNob3dNZXNzYWdlQm94XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJ1xuICAgICAgICAgICAgICAgICAgICBidXR0b25zOiBbJ0NhbmNlbCcsICdPcGVuIEFsbCddXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRJZDogMFxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxJZDogMFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJBIExvdCBvZiBGaWxlcyBXYXJuaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJZb3UgaGF2ZSBzZWxlY3RlZCAje2ZpbGVzLmxlbmd0aH0gZmlsZXMuXCJcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBvcGVuIHRoYXQgbWFueSBmaWxlcz9cIlxuICAgICAgICAgICAgICAgIHJldHVybiBpZiBhbnN3ZXIgIT0gMVxuICAgIFxuICAgICAgICAgICAgaWYgZmlsZXMubGVuZ3RoID09IDBcbiAgICAgICAgICAgICAgICByZXR1cm4gW11cbiAgICBcbiAgICAgICAgICAgIHdpbmRvdy5zdGFzaC5zZXQgJ29wZW5GaWxlUGF0aCcgc2xhc2guZGlyIGZpbGVzWzBdXG4gICAgXG4gICAgICAgICAgICBpZiBub3Qgb3B0aW9ucz8ubmV3V2luZG93IGFuZCBub3Qgb3B0aW9ucz8ubmV3VGFiXG4gICAgICAgICAgICAgICAgZmlsZSA9IHNsYXNoLnJlc29sdmUgZmlsZXMuc2hpZnQoKVxuICAgICAgICAgICAgICAgIEBsb2FkRmlsZSBmaWxlXG4gICAgXG4gICAgICAgICAgICBmb3IgZmlsZSBpbiBmaWxlc1xuICAgICAgICAgICAgICAgIGlmIG9wdGlvbnM/Lm5ld1dpbmRvd1xuICAgICAgICAgICAgICAgICAgICBwb3N0LnRvTWFpbiAnbmV3V2luZG93V2l0aEZpbGUnIGZpbGVcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAnbmV3VGFiV2l0aEZpbGUnIGZpbGVcbiAgICBcbiAgICAgICAgICAgIHJldHVybiBvZmlsZXNcbiAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgcmVsb2FkVGFiOiAoZmlsZSkgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIGZpbGUgPT0gZWRpdG9yPy5jdXJyZW50RmlsZVxuICAgICAgICAgICAgQGxvYWRGaWxlIGVkaXRvcj8uY3VycmVudEZpbGUsIHJlbG9hZDp0cnVlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHBvc3QuZW1pdCAncmV2ZXJ0RmlsZScgZmlsZVxuICAgICAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwMDAwICAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgIFxuICAgIHJlbG9hZEZpbGU6IChmaWxlKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgbm90IGZpbGVcbiAgICAgICAgICAgIEByZWxvYWRBY3RpdmVUYWIoKVxuICAgICAgICBlbHNlIGlmIHRhYiA9IHRhYnMudGFiIGZpbGVcbiAgICAgICAgICAgIGlmIHRhYiA9PSB0YWJzLmFjdGl2ZVRhYigpXG4gICAgICAgICAgICAgICAgQHJlbG9hZEFjdGl2ZVRhYigpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGFiLnJlbG9hZCgpXG4gICAgICAgICAgICBcbiAgICByZWxvYWRBY3RpdmVUYWI6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiB0YWIgPSB0YWJzLmFjdGl2ZVRhYigpXG4gICAgICAgICAgICB0YWIucmVsb2FkKClcbiAgICAgICAgXG4gICAgICAgIEBsb2FkRmlsZSBlZGl0b3IuY3VycmVudEZpbGUsIHJlbG9hZDp0cnVlXG4gICAgXG4gICAgICAgIGlmIGVkaXRvci5jdXJyZW50RmlsZT9cbiAgICAgICAgICAgIHBvc3QudG9PdGhlcldpbnMgJ3JlbG9hZFRhYicsIGVkaXRvci5jdXJyZW50RmlsZVxuXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMCAgICAgMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwIDAwMCAgIDAwMDAwMDAgICAgICAgICAwMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgICAwICAgICAgMDAwMDAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICByZW1vdmVGaWxlOiAoZmlsZSkgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIHRhYiA9IHRhYnMudGFiIGZpbGVcbiAgICAgICAgICAgIGlmIHRhYiA9PSB0YWJzLmFjdGl2ZVRhYigpXG4gICAgICAgICAgICAgICAgaWYgbmVpZ2hib3JUYWIgPSB0YWIubmV4dE9yUHJldigpXG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm9yVGFiLmFjdGl2YXRlKClcbiAgICAgICAgICAgIGtsb2cgJ3JlbW92ZUZpbGUnXG4gICAgICAgICAgICB0YWJzLmNsb3NlVGFiIHRhYlxuICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAgICAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgIDAgICAgICAwMDAwMDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwICBcbiAgICBcbiAgICBzYXZlQWxsOiA9PlxuICAgICAgICBcbiAgICAgICAgZm9yIHRhYiBpbiB0YWJzLnRhYnNcbiAgICAgICAgICAgIGlmIHRhYi5kaXJ0eSBcbiAgICAgICAgICAgICAgICBpZiB0YWIgPT0gdGFicy5hY3RpdmVUYWIoKVxuICAgICAgICAgICAgICAgICAgICBAc2F2ZUZpbGUgdGFiLmZpbGVcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YWIuZmlsZS5zdGFydHNXaXRoICd1bnRpdGxlZCdcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYi5zYXZlQ2hhbmdlcygpXG5cbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAjICAgICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBzYXZlRmlsZTogKGZpbGUpID0+XG4gICAgXG4gICAgICAgIGZpbGUgPz0gZWRpdG9yLmN1cnJlbnRGaWxlXG4gICAgICAgIFxuICAgICAgICBpZiBub3QgZmlsZT8gb3IgZmlsZS5zdGFydHNXaXRoICd1bnRpdGxlZCdcbiAgICAgICAgICAgIEBzYXZlRmlsZUFzKClcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICBcbiAgICAgICAgZWRpdG9yLnN0b3BXYXRjaGVyKClcbiAgICAgICAgXG4gICAgICAgIEZpbGUuc2F2ZSBmaWxlLCBlZGl0b3IudGV4dCgpLCAoZXJyLCBzYXZlZCkgLT5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZWRpdG9yLnNhdmVTY3JvbGxDdXJzb3JzQW5kU2VsZWN0aW9ucygpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIHZhbGlkIGVyclxuICAgICAgICAgICAgICAgIGtlcnJvciBcInNhdmluZyAnI3tmaWxlfScgZmFpbGVkOlwiIGVyclxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGVkaXRvci5zZXRDdXJyZW50RmlsZSAgICAgc2F2ZWRcbiAgICAgICAgICAgICAgICBwb3N0LnRvT3RoZXJzICdmaWxlU2F2ZWQnIHNhdmVkLCB3aW5kb3cud2luSURcbiAgICAgICAgICAgICAgICBwb3N0LmVtaXQgICAgICdzYXZlZCcgICAgIHNhdmVkXG5cbiAgICAgICAgICAgIGVkaXRvci5yZXN0b3JlU2Nyb2xsQ3Vyc29yc0FuZFNlbGVjdGlvbnMoKVxuICAgICAgICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwMCAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAgICAwMDAgMCAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwICAgICAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIGFkZFRvUmVjZW50OiAoZmlsZSkgLT5cbiAgICBcbiAgICAgICAgcmVjZW50ID0gd2luZG93LnN0YXRlLmdldCAncmVjZW50RmlsZXMnLCBbXVxuICAgICAgICByZXR1cm4gaWYgZmlsZSA9PSBmaXJzdCByZWNlbnRcbiAgICAgICAgXy5wdWxsIHJlY2VudCwgZmlsZVxuICAgICAgICByZWNlbnQudW5zaGlmdCBmaWxlXG4gICAgICAgIHdoaWxlIHJlY2VudC5sZW5ndGggPiBwcmVmcy5nZXQgJ3JlY2VudEZpbGVzTGVuZ3RoJywgMTVcbiAgICAgICAgICAgIHJlY2VudC5wb3AoKVxuICAgIFxuICAgICAgICB3aW5kb3cuc3RhdGUuc2V0ICdyZWNlbnRGaWxlcycsIHJlY2VudFxuICAgICAgICBjb21tYW5kbGluZS5jb21tYW5kcy5vcGVuLnNldEhpc3RvcnkgcmV2ZXJzZWQgcmVjZW50XG4gICAgICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgIDAgICAgICAwMDAwMDAwMCAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAgICBcbiAgICBcbiAgICBzYXZlQ2hhbmdlczogPT5cbiAgICAgICAgXG4gICAgICAgIGlmIGVkaXRvci5jdXJyZW50RmlsZT8gYW5kIGVkaXRvci5kby5oYXNMaW5lQ2hhbmdlcygpIGFuZCBzbGFzaC5maWxlRXhpc3RzIGVkaXRvci5jdXJyZW50RmlsZVxuICAgICAgICAgICAgRmlsZS5zYXZlIGVkaXRvci5jdXJyZW50RmlsZSwgZWRpdG9yLnRleHQoKSwgKGVycikgLT5cbiAgICAgICAgICAgICAgICBrZXJyb3IgXCJGaWxlSGFuZGxlci5zYXZlQ2hhbmdlcyBmYWlsZWQgI3tlcnJ9XCIgaWYgZXJyXG4gICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwIDAgMDAwICAgICAgICAwMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBvcGVuRmlsZTogKG9wdCkgPT5cbiAgICBcbiAgICAgICAgZGlyID0gc2xhc2guZGlyIGVkaXRvci5jdXJyZW50RmlsZSBpZiBlZGl0b3I/LmN1cnJlbnRGaWxlXG4gICAgICAgIGRpciA/PSBzbGFzaC5yZXNvbHZlICcuJ1xuICAgICAgICBkaWFsb2cuc2hvd09wZW5EaWFsb2dcbiAgICAgICAgICAgIHRpdGxlOiBcIk9wZW4gRmlsZVwiXG4gICAgICAgICAgICBkZWZhdWx0UGF0aDogd2luZG93LnN0YXNoLmdldCAnb3BlbkZpbGVQYXRoJywgZGlyXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiBbJ29wZW5GaWxlJyAnbXVsdGlTZWxlY3Rpb25zJ11cbiAgICAgICAgICAgICwgKGZpbGVzKSAtPiBwb3N0LmVtaXQgJ29wZW5GaWxlcycgZmlsZXMsIG9wdFxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwICAgMDAwICAgICAgMCAgICAgIDAwMDAwMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMDAwMDAgICBcbiAgICBcbiAgICBzYXZlRmlsZUFzOiA9PlxuICAgIFxuICAgICAgICBkZWZhdWx0UGF0aCA9IHNsYXNoLnVuc2xhc2ggZWRpdG9yPy5jdXJyZW50RGlyKClcbiAgICAgICAgZGlhbG9nLnNob3dTYXZlRGlhbG9nKHRpdGxlOidTYXZlIEZpbGUgQXMnIGRlZmF1bHRQYXRoOmRlZmF1bHRQYXRoKS50aGVuIChyZXN1bHQpID0+XG4gICAgICAgICAgICBpZiBub3QgcmVzdWx0LmNhbmNlbGxlZCBhbmQgcmVzdWx0LmZpbGVQYXRoXG4gICAgICAgICAgICAgICAgQGFkZFRvUmVjZW50IHJlc3VsdC5maWxlUGF0aFxuICAgICAgICAgICAgICAgIEBzYXZlRmlsZSByZXN1bHQuZmlsZVBhdGhcbiAgICAgICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBGaWxlSGFuZGxlclxuIl19
//# sourceURL=../../coffee/win/filehandler.coffee