// koffee 1.4.0

/*
00000000  000  000      00000000  000   000   0000000   000   000  0000000    000      00000000  00000000 
000       000  000      000       000   000  000   000  0000  000  000   000  000      000       000   000
000000    000  000      0000000   000000000  000000000  000 0 000  000   000  000      0000000   0000000  
000       000  000      000       000   000  000   000  000  0000  000   000  000      000       000   000
000       000  0000000  00000000  000   000  000   000  000   000  0000000    0000000  00000000  000   000
 */
var File, FileHandler, _, dialog, electron, empty, filelist, first, kerror, post, prefs, ref, remote, reversed, slash, valid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), post = ref.post, reversed = ref.reversed, filelist = ref.filelist, empty = ref.empty, slash = ref.slash, first = ref.first, prefs = ref.prefs, valid = ref.valid, kerror = ref.kerror, _ = ref._;

File = require('../tools/file');

electron = require('electron');

remote = electron.remote;

dialog = remote.dialog;

FileHandler = (function() {
    function FileHandler() {
        this.saveFileAs = bind(this.saveFileAs, this);
        this.openFile = bind(this.openFile, this);
        this.saveChanges = bind(this.saveChanges, this);
        this.saveFile = bind(this.saveFile, this);
        this.saveAll = bind(this.saveAll, this);
        this.removeFile = bind(this.removeFile, this);
        this.reloadFile = bind(this.reloadFile, this);
        this.reloadTab = bind(this.reloadTab, this);
        this.openFiles = bind(this.openFiles, this);
        this.loadFile = bind(this.loadFile, this);
        post.on('reloadFile', this.reloadFile);
        post.on('removeFile', this.removeFile);
        post.on('saveFileAs', this.saveFileAs);
        post.on('saveFile', this.saveFile);
        post.on('saveAll', this.saveAll);
        post.on('saveChanges', this.saveChanges);
        post.on('reloadTab', this.reloadTab);
        post.on('loadFile', this.loadFile);
        post.on('openFile', this.openFile);
        post.on('openFiles', this.openFiles);
    }

    FileHandler.prototype.loadFile = function(file, opt) {
        var activeTab, fileExists, filePos, ref1, tab;
        if (opt == null) {
            opt = {};
        }
        if ((file != null) && file.length <= 0) {
            file = null;
        }
        editor.saveScrollCursorsAndSelections();
        if (file != null) {
            ref1 = slash.splitFilePos(file), file = ref1[0], filePos = ref1[1];
            if (!file.startsWith('untitled')) {
                file = slash.resolve(file);
            }
        }
        if (file !== (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0) || (opt != null ? opt.reload : void 0)) {
            if (fileExists = slash.fileExists(file)) {
                this.addToRecent(file);
            }
            tab = tabs.tab(file);
            if (empty(tab)) {
                tab = tabs.addTab(file);
            }
            if (activeTab = tabs.activeTab()) {
                if (tab !== activeTab) {
                    activeTab.clearActive();
                    if (activeTab.dirty) {
                        activeTab.storeState();
                    }
                }
            }
            editor.setCurrentFile(file);
            tab.finishActivation();
            editor.restoreScrollCursorsAndSelections();
            if (fileExists) {
                post.toOthers('fileLoaded', file, winID);
                post.emit('cwdSet', slash.dir(file));
            }
        }
        split.raise('editor');
        if ((filePos != null) && (filePos[0] || filePos[1])) {
            editor.singleCursorAtPos(filePos);
            return editor.scroll.cursorToTop();
        }
    };

    FileHandler.prototype.openFiles = function(ofiles, options) {
        var answer, file, files, i, len;
        if (ofiles != null ? ofiles.length : void 0) {
            files = filelist(ofiles, {
                ignoreHidden: false
            });
            if (files.length >= 10) {
                answer = dialog.showMessageBox({
                    type: 'warning',
                    buttons: ['Cancel', 'Open All'],
                    defaultId: 0,
                    cancelId: 0,
                    title: "A Lot of Files Warning",
                    message: "You have selected " + files.length + " files.",
                    detail: "Are you sure you want to open that many files?"
                });
                if (answer !== 1) {
                    return;
                }
            }
            if (files.length === 0) {
                return [];
            }
            window.stash.set('openFilePath', slash.dir(files[0]));
            if (!(options != null ? options.newWindow : void 0) && !(options != null ? options.newTab : void 0)) {
                file = slash.resolve(files.shift());
                this.loadFile(file);
            }
            for (i = 0, len = files.length; i < len; i++) {
                file = files[i];
                if (options != null ? options.newWindow : void 0) {
                    post.toMain('newWindowWithFile', file);
                } else {
                    post.emit('newTabWithFile', file);
                }
            }
            return ofiles;
        }
    };

    FileHandler.prototype.reloadTab = function(file) {
        if (file === (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0)) {
            return this.loadFile(typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0, {
                reload: true
            });
        } else {
            return post.emit('revertFile', file);
        }
    };

    FileHandler.prototype.reloadFile = function(file) {
        var tab;
        if (!file) {
            return this.reloadActiveTab();
        } else if (tab = tabs.tab(file)) {
            if (tab === tabs.activeTab()) {
                return this.reloadActiveTab();
            } else {
                return tab.reload();
            }
        }
    };

    FileHandler.prototype.reloadActiveTab = function() {
        var tab;
        if (tab = tabs.activeTab()) {
            tab.reload();
        }
        this.loadFile(editor.currentFile, {
            reload: true
        });
        if (editor.currentFile != null) {
            return post.toOtherWins('reloadTab', editor.currentFile);
        }
    };

    FileHandler.prototype.removeFile = function(file) {
        var neighborTab, tab;
        if (tab = tabs.tab(file)) {
            if (tab === tabs.activeTab()) {
                if (neighborTab = tab.nextOrPrev()) {
                    neighborTab.activate();
                }
            }
            return tabs.closeTab(tab);
        }
    };

    FileHandler.prototype.saveAll = function() {
        var i, len, ref1, results, tab;
        ref1 = tabs.tabs;
        results = [];
        for (i = 0, len = ref1.length; i < len; i++) {
            tab = ref1[i];
            if (tab.dirty) {
                if (tab === tabs.activeTab()) {
                    results.push(this.saveFile(tab.file));
                } else {
                    if (!tab.file.startsWith('untitled')) {
                        results.push(tab.saveChanges());
                    } else {
                        results.push(void 0);
                    }
                }
            } else {
                results.push(void 0);
            }
        }
        return results;
    };

    FileHandler.prototype.saveFile = function(file) {
        if (file != null) {
            file;
        } else {
            file = editor.currentFile;
        }
        if ((file == null) || file.startsWith('untitled')) {
            this.saveFileAs();
            return;
        }
        editor.stopWatcher();
        return File.save(file, editor.text(), function(err, saved) {
            editor.saveScrollCursorsAndSelections();
            if (valid(err)) {
                kerror("saving '" + file + "' failed:", err);
            } else {
                editor.setCurrentFile(saved);
                post.toOthers('fileSaved', saved, window.winID);
                post.emit('saved', saved);
            }
            return editor.restoreScrollCursorsAndSelections();
        });
    };

    FileHandler.prototype.addToRecent = function(file) {
        var recent;
        recent = window.state.get('recentFiles', []);
        if (file === first(recent)) {
            return;
        }
        _.pull(recent, file);
        recent.unshift(file);
        while (recent.length > prefs.get('recentFilesLength', 15)) {
            recent.pop();
        }
        window.state.set('recentFiles', recent);
        return commandline.commands.open.setHistory(reversed(recent));
    };

    FileHandler.prototype.saveChanges = function() {
        if ((editor.currentFile != null) && editor["do"].hasLineChanges() && slash.fileExists(editor.currentFile)) {
            return File.save(editor.currentFile, editor.text(), function(err) {
                if (err) {
                    return kerror("FileHandler.saveChanges failed " + err);
                }
            });
        }
    };

    FileHandler.prototype.openFile = function(opt) {
        var dir;
        if (typeof editor !== "undefined" && editor !== null ? editor.currentFile : void 0) {
            dir = slash.dir(editor.currentFile);
        }
        if (dir != null) {
            dir;
        } else {
            dir = slash.resolve('.');
        }
        return dialog.showOpenDialog({
            title: "Open File",
            defaultPath: window.stash.get('openFilePath', dir),
            properties: ['openFile', 'multiSelections']
        }, function(files) {
            return post.emit('openFiles', files, opt);
        });
    };

    FileHandler.prototype.saveFileAs = function() {
        return dialog.showSaveDialog({
            title: "Save File As",
            defaultPath: slash.unslash(slash.dir(editor.currentFile)),
            properties: ['openFile', 'createDirectory']
        }, (function(_this) {
            return function(file) {
                if (file) {
                    _this.addToRecent(file);
                    return _this.saveFile(file);
                }
            };
        })(this));
    };

    return FileHandler;

})();

module.exports = FileHandler;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZWhhbmRsZXIuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLHdIQUFBO0lBQUE7O0FBUUEsTUFBNkUsT0FBQSxDQUFRLEtBQVIsQ0FBN0UsRUFBRSxlQUFGLEVBQVEsdUJBQVIsRUFBa0IsdUJBQWxCLEVBQTRCLGlCQUE1QixFQUFtQyxpQkFBbkMsRUFBMEMsaUJBQTFDLEVBQWlELGlCQUFqRCxFQUF3RCxpQkFBeEQsRUFBK0QsbUJBQS9ELEVBQXVFOztBQUV2RSxJQUFBLEdBQVcsT0FBQSxDQUFRLGVBQVI7O0FBQ1gsUUFBQSxHQUFXLE9BQUEsQ0FBUSxVQUFSOztBQUNYLE1BQUEsR0FBVyxRQUFRLENBQUM7O0FBQ3BCLE1BQUEsR0FBVyxNQUFNLENBQUM7O0FBRVo7SUFFVyxxQkFBQTs7Ozs7Ozs7Ozs7UUFFVCxJQUFJLENBQUMsRUFBTCxDQUFRLFlBQVIsRUFBdUIsSUFBQyxDQUFBLFVBQXhCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxZQUFSLEVBQXVCLElBQUMsQ0FBQSxVQUF4QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsWUFBUixFQUF1QixJQUFDLENBQUEsVUFBeEI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFVBQVIsRUFBdUIsSUFBQyxDQUFBLFFBQXhCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxTQUFSLEVBQXVCLElBQUMsQ0FBQSxPQUF4QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsYUFBUixFQUF1QixJQUFDLENBQUEsV0FBeEI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFdBQVIsRUFBdUIsSUFBQyxDQUFBLFNBQXhCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxVQUFSLEVBQXVCLElBQUMsQ0FBQSxRQUF4QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsVUFBUixFQUF1QixJQUFDLENBQUEsUUFBeEI7UUFDQSxJQUFJLENB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TUFBTSxDQUFDLFdBQWpCLENBQWQsQ0FEYjtZQUVBLFVBQUEsRUFBWSxDQUFDLFVBQUQsRUFBYSxpQkFBYixDQUZaO1NBREosRUFJTSxDQUFBLFNBQUEsS0FBQTttQkFBQSxTQUFDLElBQUQ7Z0JBQ0UsSUFBRyxJQUFIO29CQUNJLEtBQUMsQ0FBQSxXQUFELENBQWEsSUFBYjsyQkFDQSxLQUFDLENBQUEsUUFBRCxDQUFVLElBQVYsRUFGSjs7WUFERjtRQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FKTjtJQUZROzs7Ozs7QUFXaEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMCAgICAgIDAwMDAwMDAwICAwMDAwMDAwMCBcbjAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbjAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwICBcbjAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbjAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiMjI1xuXG57IHBvc3QsIHJldmVyc2VkLCBmaWxlbGlzdCwgZW1wdHksIHNsYXNoLCBmaXJzdCwgcHJlZnMsIHZhbGlkLCBrZXJyb3IsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuRmlsZSAgICAgPSByZXF1aXJlICcuLi90b29scy9maWxlJ1xuZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbnJlbW90ZSAgID0gZWxlY3Ryb24ucmVtb3RlXG5kaWFsb2cgICA9IHJlbW90ZS5kaWFsb2dcblxuY2xhc3MgRmlsZUhhbmRsZXJcblxuICAgIGNvbnN0cnVjdG9yOiAoKSAtPlxuXG4gICAgICAgIHBvc3Qub24gJ3JlbG9hZEZpbGUnLCAgQHJlbG9hZEZpbGVcbiAgICAgICAgcG9zdC5vbiAncmVtb3ZlRmlsZScsICBAcmVtb3ZlRmlsZVxuICAgICAgICBwb3N0Lm9uICdzYXZlRmlsZUFzJywgIEBzYXZlRmlsZUFzXG4gICAgICAgIHBvc3Qub24gJ3NhdmVGaWxlJywgICAgQHNhdmVGaWxlXG4gICAgICAgIHBvc3Qub24gJ3NhdmVBbGwnLCAgICAgQHNhdmVBbGxcbiAgICAgICAgcG9zdC5vbiAnc2F2ZUNoYW5nZXMnLCBAc2F2ZUNoYW5nZXNcbiAgICAgICAgcG9zdC5vbiAncmVsb2FkVGFiJywgICBAcmVsb2FkVGFiXG4gICAgICAgIHBvc3Qub24gJ2xvYWRGaWxlJywgICAgQGxvYWRGaWxlXG4gICAgICAgIHBvc3Qub24gJ29wZW5GaWxlJywgICAgQG9wZW5GaWxlXG4gICAgICAgIHBvc3Qub24gJ29wZW5GaWxlcycsICAgQG9wZW5GaWxlc1xuICAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBsb2FkRmlsZTogKGZpbGUsIG9wdD17fSkgPT5cbiAgICBcbiAgICAgICAgZmlsZSA9IG51bGwgaWYgZmlsZT8gYW5kIGZpbGUubGVuZ3RoIDw9IDBcbiAgICBcbiAgICAgICAgZWRpdG9yLnNhdmVTY3JvbGxDdXJzb3JzQW5kU2VsZWN0aW9ucygpXG4gICAgXG4gICAgICAgIGlmIGZpbGU/XG4gICAgICAgICAgICBbZmlsZSwgZmlsZVBvc10gPSBzbGFzaC5zcGxpdEZpbGVQb3MgZmlsZVxuICAgICAgICAgICAgaWYgbm90IGZpbGUuc3RhcnRzV2l0aCAndW50aXRsZWQnXG4gICAgICAgICAgICAgICAgZmlsZSA9IHNsYXNoLnJlc29sdmUgZmlsZVxuICAgIFxuICAgICAgICBpZiBmaWxlICE9IGVkaXRvcj8uY3VycmVudEZpbGUgb3Igb3B0Py5yZWxvYWRcbiAgICBcbiAgICAgICAgICAgIGlmIGZpbGVFeGlzdHMgPSBzbGFzaC5maWxlRXhpc3RzIGZpbGVcbiAgICAgICAgICAgICAgICBAYWRkVG9SZWNlbnQgZmlsZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB0YWIgPSB0YWJzLnRhYiBmaWxlXG4gICAgICAgICAgICBpZiBlbXB0eSB0YWJcbiAgICAgICAgICAgICAgICB0YWIgPSB0YWJzLmFkZFRhYiBmaWxlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIGFjdGl2ZVRhYiA9IHRhYnMuYWN0aXZlVGFiKClcbiAgICAgICAgICAgICAgICBpZiB0YWIgIT0gYWN0aXZlVGFiXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYi5jbGVhckFjdGl2ZSgpXG4gICAgICAgICAgICAgICAgICAgIGlmIGFjdGl2ZVRhYi5kaXJ0eSAjIGFjdGl2ZVRhYi5pc0RpcnR5KClcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYi5zdG9yZVN0YXRlKClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGVkaXRvci5zZXRDdXJyZW50RmlsZSBmaWxlXG4gICAgXG4gICAgICAgICAgICB0YWIuZmluaXNoQWN0aXZhdGlvbigpICMgc2V0QWN0aXZlLCByZXN0b3JlIHN0YXRlLCB1cGRhdGUgdGFic1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBlZGl0b3IucmVzdG9yZVNjcm9sbEN1cnNvcnNBbmRTZWxlY3Rpb25zKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgZmlsZUV4aXN0c1xuICAgICAgICAgICAgICAgIHBvc3QudG9PdGhlcnMgJ2ZpbGVMb2FkZWQnLCBmaWxlLCB3aW5JRCAjIGluZGV4ZXJcbiAgICAgICAgICAgICAgICBwb3N0LmVtaXQgJ2N3ZFNldCcsIHNsYXNoLmRpciBmaWxlXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHNwbGl0LnJhaXNlICdlZGl0b3InXG4gICAgXG4gICAgICAgIGlmIGZpbGVQb3M/IGFuZCAoZmlsZVBvc1swXSBvciBmaWxlUG9zWzFdKVxuICAgICAgICAgICAgZWRpdG9yLnNpbmdsZUN1cnNvckF0UG9zIGZpbGVQb3NcbiAgICAgICAgICAgIGVkaXRvci5zY3JvbGwuY3Vyc29yVG9Ub3AoKVxuXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgMCAwMDAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgICAgMDAwXG4gICAgIyAgMDAwMDAwMCAgIDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDBcbiAgICBcbiAgICBvcGVuRmlsZXM6IChvZmlsZXMsIG9wdGlvbnMpID0+ICMgY2FsbGVkIGZyb20gZmlsZSBkaWFsb2csIG9wZW4gY29tbWFuZCBhbmQgYnJvd3NlclxuICAgIFxuICAgICAgICBpZiBvZmlsZXM/Lmxlbmd0aFxuICAgIFxuICAgICAgICAgICAgZmlsZXMgPSBmaWxlbGlzdCBvZmlsZXMsIGlnbm9yZUhpZGRlbjogZmFsc2VcbiAgICBcbiAgICAgICAgICAgIGlmIGZpbGVzLmxlbmd0aCA+PSAxMFxuICAgICAgICAgICAgICAgIGFuc3dlciA9IGRpYWxvZy5zaG93TWVzc2FnZUJveFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnd2FybmluZydcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uczogWydDYW5jZWwnLCAnT3BlbiBBbGwnXVxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0SWQ6IDBcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsSWQ6IDBcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiQSBMb3Qgb2YgRmlsZXMgV2FybmluZ1wiXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiWW91IGhhdmUgc2VsZWN0ZWQgI3tmaWxlcy5sZW5ndGh9IGZpbGVzLlwiXG4gICAgICAgICAgICAgICAgICAgIGRldGFpbDogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gb3BlbiB0aGF0IG1hbnkgZmlsZXM/XCJcbiAgICAgICAgICAgICAgICByZXR1cm4gaWYgYW5zd2VyICE9IDFcbiAgICBcbiAgICAgICAgICAgIGlmIGZpbGVzLmxlbmd0aCA9PSAwXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdXG4gICAgXG4gICAgICAgICAgICB3aW5kb3cuc3Rhc2guc2V0ICdvcGVuRmlsZVBhdGgnIHNsYXNoLmRpciBmaWxlc1swXVxuICAgIFxuICAgICAgICAgICAgaWYgbm90IG9wdGlvbnM/Lm5ld1dpbmRvdyBhbmQgbm90IG9wdGlvbnM/Lm5ld1RhYlxuICAgICAgICAgICAgICAgIGZpbGUgPSBzbGFzaC5yZXNvbHZlIGZpbGVzLnNoaWZ0KClcbiAgICAgICAgICAgICAgICBAbG9hZEZpbGUgZmlsZVxuICAgIFxuICAgICAgICAgICAgZm9yIGZpbGUgaW4gZmlsZXNcbiAgICAgICAgICAgICAgICBpZiBvcHRpb25zPy5uZXdXaW5kb3dcbiAgICAgICAgICAgICAgICAgICAgcG9zdC50b01haW4gJ25ld1dpbmRvd1dpdGhGaWxlJyBmaWxlXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBwb3N0LmVtaXQgJ25ld1RhYldpdGhGaWxlJyBmaWxlXG4gICAgXG4gICAgICAgICAgICByZXR1cm4gb2ZpbGVzXG4gICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIHJlbG9hZFRhYjogKGZpbGUpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBmaWxlID09IGVkaXRvcj8uY3VycmVudEZpbGVcbiAgICAgICAgICAgIEBsb2FkRmlsZSBlZGl0b3I/LmN1cnJlbnRGaWxlLCByZWxvYWQ6dHJ1ZVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ3JldmVydEZpbGUnIGZpbGVcbiAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICByZWxvYWRGaWxlOiAoZmlsZSkgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBmaWxlXG4gICAgICAgICAgICBAcmVsb2FkQWN0aXZlVGFiKClcbiAgICAgICAgZWxzZSBpZiB0YWIgPSB0YWJzLnRhYiBmaWxlXG4gICAgICAgICAgICBpZiB0YWIgPT0gdGFicy5hY3RpdmVUYWIoKVxuICAgICAgICAgICAgICAgIEByZWxvYWRBY3RpdmVUYWIoKVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHRhYi5yZWxvYWQoKVxuICAgICAgICAgICAgXG4gICAgcmVsb2FkQWN0aXZlVGFiOiAtPlxuICAgICAgICBcbiAgICAgICAgaWYgdGFiID0gdGFicy5hY3RpdmVUYWIoKVxuICAgICAgICAgICAgdGFiLnJlbG9hZCgpXG4gICAgICAgIFxuICAgICAgICBAbG9hZEZpbGUgZWRpdG9yLmN1cnJlbnRGaWxlLCByZWxvYWQ6dHJ1ZVxuICAgIFxuICAgICAgICBpZiBlZGl0b3IuY3VycmVudEZpbGU/XG4gICAgICAgICAgICBwb3N0LnRvT3RoZXJXaW5zICdyZWxvYWRUYWInLCBlZGl0b3IuY3VycmVudEZpbGVcblxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAgICAgIDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwICAgICAgICAgMDAwMDAwICAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgICAgMCAgICAgIDAwMDAwMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgcmVtb3ZlRmlsZTogKGZpbGUpID0+XG4gICAgICAgIFxuICAgICAgICBpZiB0YWIgPSB0YWJzLnRhYiBmaWxlXG4gICAgICAgICAgICBpZiB0YWIgPT0gdGFicy5hY3RpdmVUYWIoKVxuICAgICAgICAgICAgICAgIGlmIG5laWdoYm9yVGFiID0gdGFiLm5leHRPclByZXYoKVxuICAgICAgICAgICAgICAgICAgICBuZWlnaGJvclRhYi5hY3RpdmF0ZSgpXG4gICAgICAgICAgICB0YWJzLmNsb3NlVGFiIHRhYlxuICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAgICAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgIDAgICAgICAwMDAwMDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwICBcbiAgICBcbiAgICBzYXZlQWxsOiA9PlxuICAgICAgICBcbiAgICAgICAgZm9yIHRhYiBpbiB0YWJzLnRhYnNcbiAgICAgICAgICAgIGlmIHRhYi5kaXJ0eSBcbiAgICAgICAgICAgICAgICBpZiB0YWIgPT0gdGFicy5hY3RpdmVUYWIoKVxuICAgICAgICAgICAgICAgICAgICBAc2F2ZUZpbGUgdGFiLmZpbGVcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YWIuZmlsZS5zdGFydHNXaXRoICd1bnRpdGxlZCdcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYi5zYXZlQ2hhbmdlcygpXG5cbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAjICAgICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBzYXZlRmlsZTogKGZpbGUpID0+XG4gICAgXG4gICAgICAgIGZpbGUgPz0gZWRpdG9yLmN1cnJlbnRGaWxlXG4gICAgICAgIFxuICAgICAgICBpZiBub3QgZmlsZT8gb3IgZmlsZS5zdGFydHNXaXRoICd1bnRpdGxlZCdcbiAgICAgICAgICAgIEBzYXZlRmlsZUFzKClcbiAgICAgICAgICAgIHJldHVyblxuICAgIFxuICAgICAgICBlZGl0b3Iuc3RvcFdhdGNoZXIoKVxuICAgICAgICBcbiAgICAgICAgRmlsZS5zYXZlIGZpbGUsIGVkaXRvci50ZXh0KCksIChlcnIsIHNhdmVkKSAtPlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBlZGl0b3Iuc2F2ZVNjcm9sbEN1cnNvcnNBbmRTZWxlY3Rpb25zKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgdmFsaWQgZXJyXG4gICAgICAgICAgICAgICAga2Vycm9yIFwic2F2aW5nICcje2ZpbGV9JyBmYWlsZWQ6XCIsIGVyclxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGVkaXRvci5zZXRDdXJyZW50RmlsZSAgICAgIHNhdmVkXG4gICAgICAgICAgICAgICAgcG9zdC50b090aGVycyAnZmlsZVNhdmVkJywgc2F2ZWQsIHdpbmRvdy53aW5JRFxuICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAgICAgJ3NhdmVkJywgICAgIHNhdmVkXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBlZGl0b3IucmVzdG9yZVNjcm9sbEN1cnNvcnNBbmRTZWxlY3Rpb25zKClcbiAgICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAgICAgICAgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMDAgIDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwIDAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBhZGRUb1JlY2VudDogKGZpbGUpIC0+XG4gICAgXG4gICAgICAgIHJlY2VudCA9IHdpbmRvdy5zdGF0ZS5nZXQgJ3JlY2VudEZpbGVzJywgW11cbiAgICAgICAgcmV0dXJuIGlmIGZpbGUgPT0gZmlyc3QgcmVjZW50XG4gICAgICAgIF8ucHVsbCByZWNlbnQsIGZpbGVcbiAgICAgICAgcmVjZW50LnVuc2hpZnQgZmlsZVxuICAgICAgICB3aGlsZSByZWNlbnQubGVuZ3RoID4gcHJlZnMuZ2V0ICdyZWNlbnRGaWxlc0xlbmd0aCcsIDE1XG4gICAgICAgICAgICByZWNlbnQucG9wKClcbiAgICBcbiAgICAgICAgd2luZG93LnN0YXRlLnNldCAncmVjZW50RmlsZXMnLCByZWNlbnRcbiAgICAgICAgY29tbWFuZGxpbmUuY29tbWFuZHMub3Blbi5zZXRIaXN0b3J5IHJldmVyc2VkIHJlY2VudFxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAgMDAwIDAwMCAgIDAwMDAwMDAgICAgICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAwIDAwMCAgMDAwICAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDAgICAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwICAgXG4gICAgXG4gICAgc2F2ZUNoYW5nZXM6ID0+XG4gICAgICAgIFxuICAgICAgICBpZiBlZGl0b3IuY3VycmVudEZpbGU/IGFuZCBlZGl0b3IuZG8uaGFzTGluZUNoYW5nZXMoKSBhbmQgc2xhc2guZmlsZUV4aXN0cyBlZGl0b3IuY3VycmVudEZpbGVcbiAgICAgICAgICAgIEZpbGUuc2F2ZSBlZGl0b3IuY3VycmVudEZpbGUsIGVkaXRvci50ZXh0KCksIChlcnIpIC0+XG4gICAgICAgICAgICAgICAga2Vycm9yIFwiRmlsZUhhbmRsZXIuc2F2ZUNoYW5nZXMgZmFpbGVkICN7ZXJyfVwiIGlmIGVyclxuICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgICAgICAgMDAwMDAwICAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwICAgICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgb3BlbkZpbGU6IChvcHQpID0+XG4gICAgXG4gICAgICAgIGRpciA9IHNsYXNoLmRpciBlZGl0b3IuY3VycmVudEZpbGUgaWYgZWRpdG9yPy5jdXJyZW50RmlsZVxuICAgICAgICBkaXIgPz0gc2xhc2gucmVzb2x2ZSAnLidcbiAgICAgICAgZGlhbG9nLnNob3dPcGVuRGlhbG9nXG4gICAgICAgICAgICB0aXRsZTogXCJPcGVuIEZpbGVcIlxuICAgICAgICAgICAgZGVmYXVsdFBhdGg6IHdpbmRvdy5zdGFzaC5nZXQgJ29wZW5GaWxlUGF0aCcsIGRpclxuICAgICAgICAgICAgcHJvcGVydGllczogWydvcGVuRmlsZScsICdtdWx0aVNlbGVjdGlvbnMnXVxuICAgICAgICAgICAgLCAoZmlsZXMpIC0+IHBvc3QuZW1pdCAnb3BlbkZpbGVzJywgZmlsZXMsIG9wdFxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgICAgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwICAgMDAwICAgICAgMCAgICAgIDAwMDAwMDAwICAgICAgICAwMDAgICAgICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMDAwMDAgICBcbiAgICBcbiAgICBzYXZlRmlsZUFzOiA9PlxuICAgIFxuICAgICAgICBkaWFsb2cuc2hvd1NhdmVEaWFsb2dcbiAgICAgICAgICAgIHRpdGxlOiBcIlNhdmUgRmlsZSBBc1wiXG4gICAgICAgICAgICBkZWZhdWx0UGF0aDogc2xhc2gudW5zbGFzaCBzbGFzaC5kaXIgZWRpdG9yLmN1cnJlbnRGaWxlXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiBbJ29wZW5GaWxlJywgJ2NyZWF0ZURpcmVjdG9yeSddXG4gICAgICAgICAgICAsIChmaWxlKSA9PlxuICAgICAgICAgICAgICAgIGlmIGZpbGVcbiAgICAgICAgICAgICAgICAgICAgQGFkZFRvUmVjZW50IGZpbGVcbiAgICAgICAgICAgICAgICAgICAgQHNhdmVGaWxlIGZpbGVcbiAgICAgICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBGaWxlSGFuZGxlclxuIl19
//# sourceURL=../../coffee/win/filehandler.coffee