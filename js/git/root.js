// koffee 1.4.0

/*
00000000    0000000    0000000   000000000  
000   000  000   000  000   000     000     
0000000    000   000  000   000     000     
000   000  000   000  000   000     000     
000   000   0000000    0000000      000
 */
var _, childp, dir, empty, fixPath, fs, gitCmd, gitOpt, ref, root, slash, valid;

ref = require('kxk'), valid = ref.valid, empty = ref.empty, slash = ref.slash, childp = ref.childp, fs = ref.fs, _ = ref._;

fixPath = function(p) {
    var ref1;
    p = p.trim();
    if ((p[0] === (ref1 = p[2]) && ref1 === '/')) {
        p = p[1].toUpperCase() + ':' + p.slice(2);
    }
    return slash.resolve(p);
};

gitCmd = 'git rev-parse --show-toplevel';

gitOpt = function(cwd) {
    return {
        cwd: cwd,
        encoding: 'utf8',
        stdio: ['pipe', 'pipe', 'ignore']
    };
};

root = function(pth, cb) {
    var err;
    pth = slash.resolve(pth);
    if (_.isFunction(cb)) {
        if (empty(pth)) {
            return cb('');
        } else {
            pth = slash.unslash(pth);
            return slash.dirExists(pth, function(stat) {
                pth = valid(stat) ? slash.unslash(pth) : slash.dir(pth);
                if (empty(pth)) {
                    return cb('');
                } else {
                    return childp.exec(gitCmd, gitOpt(pth), function(err, r) {
                        if (valid(err)) {
                            return cb('');
                        } else {
                            return cb(fixPath(r));
                        }
                    });
                }
            });
        }
    } else {
        if (empty(pth)) {
            return '';
        }
        try {
            pth = slash.dirExists(pth) ? slash.unslash(pth) : slash.dir(pth);
            if (empty(pth)) {
                return '';
            }
            return fixPath(childp.execSync(gitCmd, gitOpt(pth)));
        } catch (error) {
            err = error;
            return '';
        }
    }
};

if (module.parent) {
    module.exports = root;
} else {
    if (!empty(process.argv[2])) {
        dir = slash.resolve(process.argv[2]);
    } else {
        dir = process.cwd();
    }
    console.log(root(dir));
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm9vdC5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUE7O0FBUUEsTUFBeUMsT0FBQSxDQUFRLEtBQVIsQ0FBekMsRUFBRSxpQkFBRixFQUFTLGlCQUFULEVBQWdCLGlCQUFoQixFQUF1QixtQkFBdkIsRUFBK0IsV0FBL0IsRUFBbUM7O0FBRW5DLE9BQUEsR0FBVSxTQUFDLENBQUQ7QUFFTixRQUFBO0lBQUEsQ0FBQSxHQUFJLENBQUMsQ0FBQyxJQUFGLENBQUE7SUFDSixJQUFHLENBQUEsQ0FBRSxDQUFBLENBQUEsQ0FBRixhQUFRLENBQUUsQ0FBQSxDQUFBLEVBQVYsUUFBQSxLQUFnQixHQUFoQixDQUFIO1FBQ0ksQ0FBQSxHQUFJLENBQUUsQ0FBQSxDQUFBLENBQUUsQ0FBQyxXQUFMLENBQUEsQ0FBQSxHQUFxQixHQUFyQixHQUEyQixDQUFDLENBQUMsS0FBRixDQUFRLENBQVIsRUFEbkM7O0FBRUEsV0FBTyxLQUFLLENBQUMsT0FBTixDQUFjLENBQWQ7QUFMRDs7QUFPVixNQUFBLEdBQVU7O0FBQ1YsTUFBQSxHQUFTLFNBQUMsR0FBRDtXQUFTO1FBQUEsR0FBQSxFQUFJLEdBQUo7UUFBUyxRQUFBLEVBQVMsTUFBbEI7UUFBeUIsS0FBQSxFQUFNLENBQUMsTUFBRCxFQUFRLE1BQVIsRUFBZSxRQUFmLENBQS9COztBQUFUOztBQUVULElBQUEsR0FBTyxTQUFDLEdBQUQsRUFBTSxFQUFOO0FBRUgsUUFBQTtJQUFBLEdBQUEsR0FBTSxLQUFLLENBQUMsT0FBTixDQUFjLEdBQWQ7SUFFTixJQUFHLENBQUMsQ0FBQyxVQUFGLENBQWEsRUFBYixDQUFIO1FBRUksSUFBRyxLQUFBLENBQU0sR0FBTixDQUFIO21CQUNJLEVBQUEsQ0FBRyxFQUFILEVBREo7U0FBQSxNQUFBO1lBR0ksR0FBQSxHQUFNLEtBQUssQ0FBQyxPQUFOLENBQWMsR0FBZDttQkFFTixLQUFLLENBQUMsU0FBTixDQUFnQixHQUFoQixFQUFxQixTQUFDLElBQUQ7Z0JBQ2pCLEdBQUEsR0FBUyxLQUFBLENBQU0sSUFBTixDQUFILEdBQW9CLEtBQUssQ0FBQyxPQUFOLENBQWMsR0FBZCxDQUFwQixHQUE0QyxLQUFLLENBQUMsR0FBTixDQUFVLEdBQVY7Z0JBQ2xELElBQUcsS0FBQSxDQUFNLEdBQU4sQ0FBSDsyQkFDSSxFQUFBLENBQUcsRUFBSCxFQURKO2lCQUFBLE1BQUE7MkJBR0ksTUFBTSxDQUFDLElBQVAsQ0FBWSxNQUFaLEVBQW9CLE1BQUEsQ0FBTyxHQUFQLENBQXBCLEVBQWlDLFNBQUMsR0FBRCxFQUFLLENBQUw7d0JBQzdCLElBQUcsS0FBQSxDQUFNLEdBQU4sQ0FBSDttQ0FDSSxFQUFBLENBQUcsRUFBSCxFQURKO3lCQUFBLE1BQUE7bUNBR0ksRUFBQSxDQUFHLE9BQUEsQ0FBUSxDQUFSLENBQUgsRUFISjs7b0JBRDZCLENBQWpDLEVBSEo7O1lBRmlCLENBQXJCLEVBTEo7U0FGSjtLQUFBLE1BQUE7UUFtQkksSUFBYSxLQUFBLENBQU0sR0FBTixDQUFiO0FBQUEsbUJBQU8sR0FBUDs7QUFFQTtZQUNJLEdBQUEsR0FBUyxLQUFLLENBQUMsU0FBTixDQUFnQixHQUFoQixDQUFILEdBQTZCLEtBQUssQ0FBQyxPQUFOLENBQWMsR0FBZCxDQUE3QixHQUFxRCxLQUFLLENBQUMsR0FBTixDQUFVLEdBQVY7WUFDM0QsSUFBYSxLQUFBLENBQU0sR0FBTixDQUFiO0FBQUEsdUJBQU8sR0FBUDs7QUFDQSxtQkFBTyxPQUFBLENBQVEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsTUFBaEIsRUFBd0IsTUFBQSxDQUFPLEdBQVAsQ0FBeEIsQ0FBUixFQUhYO1NBQUEsYUFBQTtZQUtNO0FBQ0YsbUJBQU8sR0FOWDtTQXJCSjs7QUFKRzs7QUF1Q1AsSUFBRyxNQUFNLENBQUMsTUFBVjtJQUVJLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLEtBRnJCO0NBQUEsTUFBQTtJQUtJLElBQUcsQ0FBSSxLQUFBLENBQU0sT0FBTyxDQUFDLElBQUssQ0FBQSxDQUFBLENBQW5CLENBQVA7UUFDSSxHQUFBLEdBQU0sS0FBSyxDQUFDLE9BQU4sQ0FBYyxPQUFPLENBQUMsSUFBSyxDQUFBLENBQUEsQ0FBM0IsRUFEVjtLQUFBLE1BQUE7UUFHSSxHQUFBLEdBQU0sT0FBTyxDQUFDLEdBQVIsQ0FBQSxFQUhWOztJQUtBLE9BQUEsQ0FBQSxHQUFBLENBQUksSUFBQSxDQUFLLEdBQUwsQ0FBSixFQVZKIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMCAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIFxuMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbjAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuMDAwICAgMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgICAgMDAwICAgICBcbiMjI1xuXG57IHZhbGlkLCBlbXB0eSwgc2xhc2gsIGNoaWxkcCwgZnMsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuZml4UGF0aCA9IChwKSAtPlxuICAgIFxuICAgIHAgPSBwLnRyaW0oKVxuICAgIGlmIHBbMF0gPT0gcFsyXSA9PSAnLydcbiAgICAgICAgcCA9IHBbMV0udG9VcHBlckNhc2UoKSArICc6JyArIHAuc2xpY2UgMlxuICAgIHJldHVybiBzbGFzaC5yZXNvbHZlIHAgICAgXG5cbmdpdENtZCAgPSAnZ2l0IHJldi1wYXJzZSAtLXNob3ctdG9wbGV2ZWwnXG5naXRPcHQgPSAoY3dkKSAtPiBjd2Q6Y3dkLCBlbmNvZGluZzondXRmOCcgc3RkaW86WydwaXBlJyAncGlwZScgJ2lnbm9yZSddXG4gICAgXG5yb290ID0gKHB0aCwgY2IpIC0+XG5cbiAgICBwdGggPSBzbGFzaC5yZXNvbHZlIHB0aFxuICAgIFxuICAgIGlmIF8uaXNGdW5jdGlvbiBjYlxuICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkgcHRoXG4gICAgICAgICAgICBjYiAnJ1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBwdGggPSBzbGFzaC51bnNsYXNoIHB0aFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBzbGFzaC5kaXJFeGlzdHMgcHRoLCAoc3RhdCkgLT5cbiAgICAgICAgICAgICAgICBwdGggPSBpZiB2YWxpZChzdGF0KSB0aGVuIHNsYXNoLnVuc2xhc2gocHRoKSBlbHNlIHNsYXNoLmRpcihwdGgpXG4gICAgICAgICAgICAgICAgaWYgZW1wdHkgcHRoXG4gICAgICAgICAgICAgICAgICAgIGNiICcnIFxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRwLmV4ZWMgZ2l0Q21kLCBnaXRPcHQocHRoKSwgKGVycixyKSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmFsaWQgZXJyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IgJycgXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IgZml4UGF0aCByXG4gICAgZWxzZVxuICAgIFxuICAgICAgICByZXR1cm4gJycgaWYgZW1wdHkgcHRoXG4gICAgICAgIFxuICAgICAgICB0cnlcbiAgICAgICAgICAgIHB0aCA9IGlmIHNsYXNoLmRpckV4aXN0cyhwdGgpIHRoZW4gc2xhc2gudW5zbGFzaChwdGgpIGVsc2Ugc2xhc2guZGlyKHB0aClcbiAgICAgICAgICAgIHJldHVybiAnJyBpZiBlbXB0eSBwdGhcbiAgICAgICAgICAgIHJldHVybiBmaXhQYXRoIGNoaWxkcC5leGVjU3luYyBnaXRDbWQsIGdpdE9wdChwdGgpXG4gICAgICAgICAgICBcbiAgICAgICAgY2F0Y2ggZXJyXG4gICAgICAgICAgICByZXR1cm4gJydcblxuIyAwMCAgICAgMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICBcbiMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4jIDAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIFxuIyAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiMgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG5cbmlmIG1vZHVsZS5wYXJlbnRcbiAgICBcbiAgICBtb2R1bGUuZXhwb3J0cyA9IHJvb3RcbiAgICBcbmVsc2VcbiAgICBpZiBub3QgZW1wdHkgcHJvY2Vzcy5hcmd2WzJdXG4gICAgICAgIGRpciA9IHNsYXNoLnJlc29sdmUgcHJvY2Vzcy5hcmd2WzJdXG4gICAgZWxzZVxuICAgICAgICBkaXIgPSBwcm9jZXNzLmN3ZCgpXG4gICAgICAgIFxuICAgIGxvZyByb290IGRpclxuICAgICJdfQ==
//# sourceURL=../../coffee/git/root.coffee