// koffee 1.12.0

/*
00     00   0000000    0000000  00000000    0000000
000   000  000   000  000       000   000  000   000
000000000  000000000  000       0000000    000   000
000 0 000  000   000  000       000   000  000   000
000   000  000   000   0000000  000   000   0000000
 */
var Command, GitInfo, Macro, Transform, _, args, empty, fs, indexer, kerror, post, prefs, ref, req, reversed, salt, slash, syntax, valid,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf;

ref = require('kxk'), _ = ref._, args = ref.args, empty = ref.empty, fs = ref.fs, kerror = ref.kerror, post = ref.post, prefs = ref.prefs, reversed = ref.reversed, slash = ref.slash, valid = ref.valid;

indexer = require('../main/indexer');

salt = require('../tools/salt');

req = require('../tools/req');

GitInfo = require('../win/gitinfo');

Command = require('../commandline/command');

syntax = require('../editor/syntax');

Transform = require('../editor/actions/transform');

Macro = (function(superClass) {
    extend(Macro, superClass);

    Macro.macroNames = ['clean', 'help', 'dbg', 'class', 'req', 'inv', 'blink', 'color', 'fps', 'cwd', 'git', 'unix'];

    function Macro(commandline) {
        Macro.__super__.constructor.call(this, commandline);
        this.macros = Macro.macroNames;
        this.macros = this.macros.concat(Transform.transformNames);
        this.names = ['macro'];
    }

    Macro.prototype.start = function(name) {
        var text;
        Macro.__super__.start.call(this, name);
        text = this.last();
        if (!(text != null ? text.length : void 0)) {
            text = 'dbg';
        }
        return {
            text: text,
            select: true
        };
    };

    Macro.prototype.listItems = function() {
        var i, items, j, len, results;
        items = _.uniq(_.concat(reversed(this.history), this.macros));
        results = [];
        for (j = 0, len = items.length; j < len; j++) {
            i = items[j];
            results.push({
                text: i,
                line: indexOf.call(this.macros, i) >= 0 && '◼' || '◆',
                type: 'macro'
            });
        }
        return results;
    };

    Macro.prototype.execute = function(command) {
        var cleaned, clss, cmmd, cp, dir, editor, file, indent, insert, j, k, l, len, len1, li, line, lines, lst, m, n, num, ref1, ref2, ref3, ref4, ref5, s, step, t, terminal, text, ti, words, wordsInArgsOrCursorsOrSelection;
        if (empty(command)) {
            return kerror('no command!');
        }
        command = Macro.__super__.execute.call(this, command);
        editor = window.editor;
        cp = editor.cursorPos();
        args = command.split(/\s+/);
        cmmd = args.shift();
        wordsInArgsOrCursorsOrSelection = function(args, opt) {
            var cw, ws;
            if (args.length) {
                return args;
            } else {
                cw = editor.wordsAtCursors(positionsNotInRanges(editor.cursors(), editor.selections()), opt);
                ws = _.uniq(cw.concat(editor.textsInRanges(editor.selections())));
                return ws.filter(function(w) {
                    return w.trim().length;
                });
            }
        };
        switch (cmmd) {
            case 'inv':
                window.textEditor.toggleInvisibles();
                break;
            case 'blink':
                editor.toggleBlink();
                if (prefs.get('blink')) {
                    this.commandline.startBlink();
                } else {
                    this.commandline.stopBlink();
                }
                break;
            case 'color':
            case 'colors':
                editor.togglePigments();
                break;
            case 'fps':
                if ((ref1 = window.fps) != null) {
                    ref1.toggle();
                }
                break;
            case 'cwd':
                if ((ref2 = window.cwd) != null) {
                    ref2.toggle();
                }
                break;
            case 'git':
                GitInfo.start();
                break;
            case 'err':
                post.toMain('throwError');
                throw new Error('err');
                break;
            case 'help':
                terminal = window.terminal;
                text = fs.readFileSync(__dirname + "/../../bin/cheet.noon", {
                    encoding: 'utf8'
                });
                terminal.clear();
                ref3 = text.split('\n');
                for (j = 0, len = ref3.length; j < len; j++) {
                    l = ref3[j];
                    terminal.appendLineDiss(l, syntax.dissForTextAndSyntax(l, 'noon'));
                }
                terminal.scroll.cursorToTop(1);
                window.split["do"]('show terminal');
                break;
            case 'req':
                if (slash.ext(editor.currentFile) !== 'coffee') {
                    return;
                }
                lines = req(editor.currentFile, editor.lines(), editor);
                if (valid(lines)) {
                    editor["do"].start();
                    for (k = 0, len1 = lines.length; k < len1; k++) {
                        line = lines[k];
                        if (line.op === 'insert') {
                            editor["do"].insert(line.index, line.text);
                        } else {
                            editor["do"].change(line.index, line.text);
                        }
                    }
                    editor["do"].end();
                    return {
                        "do": "focus editor"
                    };
                }
                break;
            case 'dbg':
                li = cp[1];
                indent = editor.indentStringForLineAtIndex(li);
                if (!editor.isCursorInIndent() && !editor.isCursorInLastLine()) {
                    li += 1;
                }
                insert = indent + 'log "';
                insert += editor.funcInfoAtLineIndex(li);
                lst = args.length && parseInt(args[0]) || 0;
                if (lst) {
                    args.shift();
                }
                words = wordsInArgsOrCursorsOrSelection(args, {
                    include: '#@.-'
                });
                for (ti = m = 0, ref4 = words.length - lst; 0 <= ref4 ? m < ref4 : m > ref4; ti = 0 <= ref4 ? ++m : --m) {
                    t = words[ti];
                    insert += t + ":\#{kstr " + t + "} ";
                }
                insert = insert.trimRight();
                insert += '"';
                if (lst) {
                    insert += ((function() {
                        var n, ref5, ref6, results;
                        results = [];
                        for (ti = n = ref5 = words.length - lst, ref6 = words.length; ref5 <= ref6 ? n < ref6 : n > ref6; ti = ref5 <= ref6 ? ++n : --n) {
                            results.push(", kstr(" + words[ti] + ")");
                        }
                        return results;
                    })()).join('');
                }
                editor["do"].start();
                editor["do"].insert(li, insert);
                editor.singleCursorAtPos([editor.line(li).length, li]);
                editor["do"].end();
                ({
                    focus: editor.name
                });
                break;
            case 'class':
                clss = args.length && args[0] || _.last(editor.textsInRanges(editor.selections()));
                if (clss != null) {
                    clss;
                } else {
                    clss = 'Class';
                }
                dir = (editor.currentFile != null) && slash.dir(editor.currentFile) || process.cwd();
                file = slash.join(dir, clss.toLowerCase() + '.coffee');
                if (slash.fileExists(file)) {
                    return {
                        text: "file " + file + " exists!"
                    };
                }
                text = "###\n";
                text += ((function() {
                    var len2, n, ref5, results;
                    ref5 = salt(clss).split('\n');
                    results = [];
                    for (n = 0, len2 = ref5.length; n < len2; n++) {
                        s = ref5[n];
                        results.push(s);
                    }
                    return results;
                })()).join('\n');
                text += "\n###\n";
                text += "\nclass " + clss + "\n\n    @: () ->\n\n\nmodule.exports = " + clss + "\n";
                fs.writeFile(file, text, {
                    encoding: 'utf8'
                }, function(err) {
                    if (err != null) {
                        kerror('writing class skeleton failed', err);
                        return;
                    }
                    return post.emit('newTabWithFile', file);
                });
                return {
                    focus: editor.name
                };
            case 'clean':
                editor["do"].start();
                for (li = n = 0, ref5 = editor.numLines(); 0 <= ref5 ? n < ref5 : n > ref5; li = 0 <= ref5 ? ++n : --n) {
                    line = editor.line(li);
                    cleaned = line.trimRight();
                    if (line !== cleaned) {
                        editor["do"].change(li, cleaned);
                    }
                }
                editor["do"].end();
                break;
            case 'unix':
                editor.newlineCharacters = '\n';
                post.emit('saveFile');
                break;
            case 'header':
                editor.toggleHeader();
                break;
            case 'col':
                num = args.length > 0 && parseInt(args[0]) || 10;
                step = args.length > 1 && parseInt(args[1]) || 1;
                editor.cursorColumns(num, step);
                break;
            case 'line':
                num = args.length > 0 && parseInt(args[0]) || 10;
                step = args.length > 1 && parseInt(args[1]) || 1;
                editor.cursorLines(num, step);
                break;
            default:
                if (Transform.transformNames && indexOf.call(Transform.transformNames, cmmd) >= 0) {
                    window.textEditor.Transform["do"].apply(null, [window.textEditor, cmmd].concat(args));
                } else {
                    kerror('unhandled macro', cmmd, Transform.transformNames);
                    if (_.last(this.history) === command.trim()) {
                        this.history.pop();
                    }
                }
        }
        return {
            select: true
        };
    };

    return Macro;

})(Command);

module.exports = Macro;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFjcm8uanMiLCJzb3VyY2VSb290IjoiLi4vLi4vY29mZmVlL2NvbW1hbmRzIiwic291cmNlcyI6WyJtYWNyby5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsb0lBQUE7SUFBQTs7OztBQVFBLE1BQXNFLE9BQUEsQ0FBUSxLQUFSLENBQXRFLEVBQUUsU0FBRixFQUFLLGVBQUwsRUFBVyxpQkFBWCxFQUFrQixXQUFsQixFQUFzQixtQkFBdEIsRUFBOEIsZUFBOUIsRUFBb0MsaUJBQXBDLEVBQTJDLHVCQUEzQyxFQUFxRCxpQkFBckQsRUFBNEQ7O0FBRTVELE9BQUEsR0FBWSxPQUFBLENBQVEsaUJBQVI7O0FBQ1osSUFBQSxHQUFZLE9BQUEsQ0FBUSxlQUFSOztBQUNaLEdBQUEsR0FBWSxPQUFBLENBQVEsY0FBUjs7QUFDWixPQUFBLEdBQVksT0FBQSxDQUFRLGdCQUFSOztBQUNaLE9BQUEsR0FBWSxPQUFBLENBQVEsd0JBQVI7O0FBQ1osTUFBQSxHQUFZLE9BQUEsQ0FBUSxrQkFBUjs7QUFDWixTQUFBLEdBQVksT0FBQSxDQUFRLDZCQUFSOztBQUVOOzs7SUFFRixLQUFDLENBQUEsVUFBRCxHQUFjLENBQUMsT0FBRCxFQUFTLE1BQVQsRUFBZ0IsS0FBaEIsRUFBc0IsT0FBdEIsRUFBOEIsS0FBOUIsRUFBb0MsS0FBcEMsRUFBMEMsT0FBMUMsRUFBa0QsT0FBbEQsRUFBMEQsS0FBMUQsRUFBZ0UsS0FBaEUsRUFBc0UsS0FBdEUsRUFBNEUsTUFBNUU7O0lBRVgsZUFBQyxXQUFEO1FBRUMsdUNBQU0sV0FBTjtRQUVBLElBQUMsQ0FBQSxNQUFELEdBQVUsS0FBSyxDQUFDO1FBQ2hCLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBQyxDQUFBLE1BQU0sQ0FBQyxNQUFSLENBQWUsU0FBUyxDQUFDLGNBQXpCO1FBQ1YsSUFBQyxDQUFBLEtBQUQsR0FBVSxDQUFDLE9BQUQ7SUFOWDs7b0JBY0gsS0FBQSxHQUFPLFNBQUMsSUFB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LElBQUssQ0FBQSxDQUFBLENBQWQsQ0FBcEIsSUFBeUM7Z0JBQ2hELElBQUEsR0FBTyxJQUFJLENBQUMsTUFBTCxHQUFjLENBQWQsSUFBb0IsUUFBQSxDQUFTLElBQUssQ0FBQSxDQUFBLENBQWQsQ0FBcEIsSUFBeUM7Z0JBQ2hELE1BQU0sQ0FBQyxXQUFQLENBQW1CLEdBQW5CLEVBQXdCLElBQXhCO0FBSkM7QUExTFQ7Z0JBd01RLElBQUcsU0FBUyxDQUFDLGNBQVYsSUFBNkIsYUFBUSxTQUFTLENBQUMsY0FBbEIsRUFBQSxJQUFBLE1BQWhDO29CQUNJLE1BQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFDLEVBQUQsRUFBRyxDQUFDLEtBQS9CLENBQXFDLElBQXJDLEVBQTJDLENBQUMsTUFBTSxDQUFDLFVBQVIsRUFBb0IsSUFBcEIsQ0FBeUIsQ0FBQyxNQUExQixDQUFpQyxJQUFqQyxDQUEzQyxFQURKO2lCQUFBLE1BQUE7b0JBR0ksTUFBQSxDQUFPLGlCQUFQLEVBQTBCLElBQTFCLEVBQWdDLFNBQVMsQ0FBQyxjQUExQztvQkFDQSxJQUFHLENBQUMsQ0FBQyxJQUFGLENBQU8sSUFBQyxDQUFBLE9BQVIsQ0FBQSxLQUFvQixPQUFPLENBQUMsSUFBUixDQUFBLENBQXZCO3dCQUNJLElBQUMsQ0FBQSxPQUFPLENBQUMsR0FBVCxDQUFBLEVBREo7cUJBSko7O0FBeE1SO2VBK01BO1lBQUEsTUFBQSxFQUFRLElBQVI7O0lBbE9LOzs7O0dBNUNPOztBQWdScEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwICAgICAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMFxuMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuMDAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMCAgIDAwMFxuMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwXG4jIyNcblxueyBfLCBhcmdzLCBlbXB0eSwgZnMsIGtlcnJvciwgcG9zdCwgcHJlZnMsIHJldmVyc2VkLCBzbGFzaCwgdmFsaWQgfSA9IHJlcXVpcmUgJ2t4aydcblxuaW5kZXhlciAgID0gcmVxdWlyZSAnLi4vbWFpbi9pbmRleGVyJ1xuc2FsdCAgICAgID0gcmVxdWlyZSAnLi4vdG9vbHMvc2FsdCdcbnJlcSAgICAgICA9IHJlcXVpcmUgJy4uL3Rvb2xzL3JlcSdcbkdpdEluZm8gICA9IHJlcXVpcmUgJy4uL3dpbi9naXRpbmZvJ1xuQ29tbWFuZCAgID0gcmVxdWlyZSAnLi4vY29tbWFuZGxpbmUvY29tbWFuZCdcbnN5bnRheCAgICA9IHJlcXVpcmUgJy4uL2VkaXRvci9zeW50YXgnXG5UcmFuc2Zvcm0gPSByZXF1aXJlICcuLi9lZGl0b3IvYWN0aW9ucy90cmFuc2Zvcm0nXG5cbmNsYXNzIE1hY3JvIGV4dGVuZHMgQ29tbWFuZFxuXG4gICAgQG1hY3JvTmFtZXMgPSBbJ2NsZWFuJyAnaGVscCcgJ2RiZycgJ2NsYXNzJyAncmVxJyAnaW52JyAnYmxpbmsnICdjb2xvcicgJ2ZwcycgJ2N3ZCcgJ2dpdCcgJ3VuaXgnXVxuXG4gICAgQDogKGNvbW1hbmRsaW5lKSAtPlxuXG4gICAgICAgIHN1cGVyIGNvbW1hbmRsaW5lXG5cbiAgICAgICAgQG1hY3JvcyA9IE1hY3JvLm1hY3JvTmFtZXNcbiAgICAgICAgQG1hY3JvcyA9IEBtYWNyb3MuY29uY2F0IFRyYW5zZm9ybS50cmFuc2Zvcm1OYW1lc1xuICAgICAgICBAbmFtZXMgID0gWydtYWNybyddXG5cbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICAgICAwMDBcbiAgICAjICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcblxuICAgIHN0YXJ0OiAobmFtZSkgLT5cblxuICAgICAgICBzdXBlciBuYW1lXG4gICAgICAgIHRleHQgPSBAbGFzdCgpXG4gICAgICAgIHRleHQgPSAnZGJnJyBpZiBub3QgdGV4dD8ubGVuZ3RoXG4gICAgICAgIHRleHQ6ICAgdGV4dFxuICAgICAgICBzZWxlY3Q6IHRydWVcblxuICAgICMgMDAwICAgICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAwMDAgIDAwMCAgICAgICAgICAwMDBcbiAgICAjIDAwMCAgICAgIDAwMCAgMDAwMDAwMCAgICAgIDAwMFxuICAgICMgMDAwICAgICAgMDAwICAgICAgIDAwMCAgICAgMDAwXG4gICAgIyAwMDAwMDAwICAwMDAgIDAwMDAwMDAgICAgICAwMDBcblxuICAgIGxpc3RJdGVtczogLT5cblxuICAgICAgICBpdGVtcyA9IF8udW5pcSBfLmNvbmNhdCByZXZlcnNlZChAaGlzdG9yeSksIEBtYWNyb3NcblxuICAgICAgICAoe3RleHQ6IGksIGxpbmU6IGkgaW4gQG1hY3JvcyBhbmQgJ+KXvCcgb3IgJ+KXhicsIHR5cGU6J21hY3JvJ30gZm9yIGkgaW4gaXRlbXMpXG5cbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMDBcblxuICAgIGV4ZWN1dGU6IChjb21tYW5kKSAtPlxuXG4gICAgICAgIHJldHVybiBrZXJyb3IgJ25vIGNvbW1hbmQhJyBpZiBlbXB0eSBjb21tYW5kXG5cbiAgICAgICAgY29tbWFuZCA9IHN1cGVyIGNvbW1hbmRcblxuICAgICAgICBlZGl0b3IgID0gd2luZG93LmVkaXRvclxuICAgICAgICBjcCAgICAgID0gZWRpdG9yLmN1cnNvclBvcygpXG4gICAgICAgIGFyZ3MgICAgPSBjb21tYW5kLnNwbGl0IC9cXHMrL1xuICAgICAgICBjbW1kICAgID0gYXJncy5zaGlmdCgpXG5cbiAgICAgICAgd29yZHNJbkFyZ3NPckN1cnNvcnNPclNlbGVjdGlvbiA9IChhcmdzLCBvcHQpIC0+XG4gICAgICAgICAgICBpZiBhcmdzLmxlbmd0aFxuICAgICAgICAgICAgICAgIHJldHVybiBhcmdzXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgY3cgPSBlZGl0b3Iud29yZHNBdEN1cnNvcnMgcG9zaXRpb25zTm90SW5SYW5nZXMoZWRpdG9yLmN1cnNvcnMoKSwgZWRpdG9yLnNlbGVjdGlvbnMoKSksIG9wdFxuICAgICAgICAgICAgICAgIHdzID0gXy51bmlxIGN3LmNvbmNhdCBlZGl0b3IudGV4dHNJblJhbmdlcyBlZGl0b3Iuc2VsZWN0aW9ucygpXG4gICAgICAgICAgICAgICAgd3MuZmlsdGVyICh3KSAtPiB3LnRyaW0oKS5sZW5ndGhcblxuICAgICAgICBzd2l0Y2ggY21tZFxuXG4gICAgICAgICAgICAjIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgICAgICAgICAgICMgMDAwICAwMDAwICAwMDAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgIDAwMCAwIDAwMCAgIDAwMCAwMDBcbiAgICAgICAgICAgICMgMDAwICAwMDAgIDAwMDAgICAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgIDBcblxuICAgICAgICAgICAgd2hlbiAnaW52J1xuICAgICAgICAgICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLnRvZ2dsZUludmlzaWJsZXMoKVxuXG4gICAgICAgICAgICAjIDAwMDAwMDAgICAgMDAwICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgMDAwMCAgMDAwICAwMDAgIDAwMFxuICAgICAgICAgICAgIyAwMDAwMDAwICAgIDAwMCAgICAgIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgMDAwXG4gICAgICAgICAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG4gICAgICAgICAgICB3aGVuICdibGluaydcbiAgICAgICAgICAgICAgICBlZGl0b3IudG9nZ2xlQmxpbmsoKVxuICAgICAgICAgICAgICAgIGlmIHByZWZzLmdldCAnYmxpbmsnXG4gICAgICAgICAgICAgICAgICAgIEBjb21tYW5kbGluZS5zdGFydEJsaW5rKClcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIEBjb21tYW5kbGluZS5zdG9wQmxpbmsoKVxuXG4gICAgICAgICAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgICAgICAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG5cbiAgICAgICAgICAgIHdoZW4gJ2NvbG9yJyAnY29sb3JzJyB0aGVuIGVkaXRvci50b2dnbGVQaWdtZW50cygpXG5cbiAgICAgICAgICAgICMgMDAwMDAwMDAgIDAwMDAwMDAwICAgIDAwMDAwMDAgICAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgICAgICAgIDAwMDAwMDAgICAwMDAgIDAwMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAgICAgIDAwMCAgICAgMDAwXG4gICAgICAgICAgICAjIDAwMDAwMCAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgMDAwMCAgMDAwICAgICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgICAgICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAgIDAwICAgICAwMCAgMDAwMDAwMCAgICAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgMDAwXG5cbiAgICAgICAgICAgIHdoZW4gJ2ZwcycgICB0aGVuIHdpbmRvdy5mcHM/LnRvZ2dsZSgpXG4gICAgICAgICAgICB3aGVuICdjd2QnICAgdGhlbiB3aW5kb3cuY3dkPy50b2dnbGUoKVxuICAgICAgICAgICAgd2hlbiAnZ2l0JyAgIHRoZW4gR2l0SW5mby5zdGFydCgpXG4gICAgICAgICAgICB3aGVuICdlcnInXG4gICAgICAgICAgICAgICAgcG9zdC50b01haW4gJ3Rocm93RXJyb3InXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yICdlcnInXG5cbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgMDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwXG4gICAgICAgICAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDBcblxuICAgICAgICAgICAgd2hlbiAnaGVscCdcblxuICAgICAgICAgICAgICAgIHRlcm1pbmFsID0gd2luZG93LnRlcm1pbmFsXG4gICAgICAgICAgICAgICAgdGV4dCA9IGZzLnJlYWRGaWxlU3luYyBcIiN7X19kaXJuYW1lfS8uLi8uLi9iaW4vY2hlZXQubm9vblwiIGVuY29kaW5nOid1dGY4J1xuICAgICAgICAgICAgICAgIHRlcm1pbmFsLmNsZWFyKClcbiAgICAgICAgICAgICAgICBmb3IgbCBpbiB0ZXh0LnNwbGl0ICdcXG4nXG4gICAgICAgICAgICAgICAgICAgIHRlcm1pbmFsLmFwcGVuZExpbmVEaXNzIGwsIHN5bnRheC5kaXNzRm9yVGV4dEFuZFN5bnRheCBsLCAnbm9vbidcblxuICAgICAgICAgICAgICAgIHRlcm1pbmFsLnNjcm9sbC5jdXJzb3JUb1RvcCAxXG4gICAgICAgICAgICAgICAgd2luZG93LnNwbGl0LmRvICdzaG93IHRlcm1pbmFsJ1xuXG4gICAgICAgICAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgMDAgMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwIDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwIDAwXG5cbiAgICAgICAgICAgIHdoZW4gJ3JlcSdcblxuICAgICAgICAgICAgICAgIHJldHVybiBpZiBzbGFzaC5leHQoZWRpdG9yLmN1cnJlbnRGaWxlKSAhPSAnY29mZmVlJ1xuICAgICAgICAgICAgICAgIGxpbmVzID0gcmVxIGVkaXRvci5jdXJyZW50RmlsZSwgZWRpdG9yLmxpbmVzKCksIGVkaXRvclxuXG4gICAgICAgICAgICAgICAgaWYgdmFsaWQgbGluZXNcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmRvLnN0YXJ0KClcbiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gbGluZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxpbmUub3AgPT0gJ2luc2VydCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZG8uaW5zZXJ0IGxpbmUuaW5kZXgsIGxpbmUudGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5kby5jaGFuZ2UgbGluZS5pbmRleCwgbGluZS50ZXh0XG5cbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmRvLmVuZCgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkbzogXCJmb2N1cyBlZGl0b3JcIlxuXG4gICAgICAgICAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAwMDAgIDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwMDBcblxuICAgICAgICAgICAgd2hlbiAnZGJnJ1xuXG4gICAgICAgICAgICAgICAgbGkgPSBjcFsxXVxuICAgICAgICAgICAgICAgIGluZGVudCA9IGVkaXRvci5pbmRlbnRTdHJpbmdGb3JMaW5lQXRJbmRleCBsaVxuICAgICAgICAgICAgICAgIGxpICs9IDEgaWYgbm90IGVkaXRvci5pc0N1cnNvckluSW5kZW50KCkgYW5kIG5vdCBlZGl0b3IuaXNDdXJzb3JJbkxhc3RMaW5lKClcbiAgICAgICAgICAgICAgICBpbnNlcnQgPSBpbmRlbnQgKyAnbG9nIFwiJ1xuICAgICAgICAgICAgICAgIGluc2VydCArPSBlZGl0b3IuZnVuY0luZm9BdExpbmVJbmRleCBsaVxuICAgICAgICAgICAgICAgIGxzdCA9IGFyZ3MubGVuZ3RoIGFuZCBwYXJzZUludChhcmdzWzBdKSBvciAwXG4gICAgICAgICAgICAgICAgYXJncy5zaGlmdCgpIGlmIGxzdFxuICAgICAgICAgICAgICAgIHdvcmRzID0gd29yZHNJbkFyZ3NPckN1cnNvcnNPclNlbGVjdGlvbiBhcmdzLCBpbmNsdWRlOiAnI0AuLSdcbiAgICAgICAgICAgICAgICBmb3IgdGkgaW4gWzAuLi53b3Jkcy5sZW5ndGggLSBsc3RdXG4gICAgICAgICAgICAgICAgICAgIHQgPSB3b3Jkc1t0aV1cbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0ICs9IFwiI3t0fTpcXCN7a3N0ciAje3R9fSBcIlxuICAgICAgICAgICAgICAgIGluc2VydCA9IGluc2VydC50cmltUmlnaHQoKVxuICAgICAgICAgICAgICAgIGluc2VydCArPSAnXCInXG4gICAgICAgICAgICAgICAgaWYgbHN0XG4gICAgICAgICAgICAgICAgICAgIGluc2VydCArPSAoXCIsIGtzdHIoI3t3b3Jkc1t0aV19KVwiIGZvciB0aSBpbiBbd29yZHMubGVuZ3RoIC0gbHN0Li4ud29yZHMubGVuZ3RoXSkuam9pbiAnJ1xuXG4gICAgICAgICAgICAgICAgZWRpdG9yLmRvLnN0YXJ0KClcbiAgICAgICAgICAgICAgICBlZGl0b3IuZG8uaW5zZXJ0IGxpLCBpbnNlcnRcbiAgICAgICAgICAgICAgICBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRQb3MgW2VkaXRvci5saW5lKGxpKS5sZW5ndGgsIGxpXVxuICAgICAgICAgICAgICAgIGVkaXRvci5kby5lbmQoKVxuXG4gICAgICAgICAgICAgICAgZm9jdXM6IGVkaXRvci5uYW1lXG5cbiAgICAgICAgICAgICMgIDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwXG4gICAgICAgICAgICAjICAwMDAwMDAwICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwXG5cbiAgICAgICAgICAgIHdoZW4gJ2NsYXNzJ1xuXG4gICAgICAgICAgICAgICAgY2xzcyA9IGFyZ3MubGVuZ3RoIGFuZCBhcmdzWzBdIG9yIF8ubGFzdCBlZGl0b3IudGV4dHNJblJhbmdlcyhlZGl0b3Iuc2VsZWN0aW9ucygpKVxuICAgICAgICAgICAgICAgIGNsc3MgPz0gJ0NsYXNzJ1xuICAgICAgICAgICAgICAgIGRpciA9IGVkaXRvci5jdXJyZW50RmlsZT8gYW5kIHNsYXNoLmRpcihlZGl0b3IuY3VycmVudEZpbGUpIG9yIHByb2Nlc3MuY3dkKClcbiAgICAgICAgICAgICAgICBmaWxlID0gc2xhc2guam9pbiBkaXIsIGNsc3MudG9Mb3dlckNhc2UoKSArICcuY29mZmVlJ1xuICAgICAgICAgICAgICAgIGlmIHNsYXNoLmZpbGVFeGlzdHMgZmlsZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGV4dDogXCJmaWxlICN7ZmlsZX0gZXhpc3RzIVwiXG4gICAgICAgICAgICAgICAgdGV4dCA9IFwiIyMjXFxuXCJcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IChzIGZvciBzIGluIHNhbHQoY2xzcykuc3BsaXQgJ1xcbicpLmpvaW4gJ1xcbidcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiXFxuIyMjXFxuXCJcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiXCJcIlxuXG4gICAgICAgICAgICAgICAgY2xhc3MgI3tjbHNzfVxuXG4gICAgICAgICAgICAgICAgICAgIEA6ICgpIC0+XG5cblxuICAgICAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gI3tjbHNzfVxuXG4gICAgICAgICAgICAgICAgXCJcIlwiXG4gICAgICAgICAgICAgICAgZnMud3JpdGVGaWxlIGZpbGUsIHRleHQsIGVuY29kaW5nOid1dGY4JywgKGVycikgLT5cbiAgICAgICAgICAgICAgICAgICAgaWYgZXJyP1xuICAgICAgICAgICAgICAgICAgICAgICAga2Vycm9yICd3cml0aW5nIGNsYXNzIHNrZWxldG9uIGZhaWxlZCcgZXJyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgcG9zdC5lbWl0ICduZXdUYWJXaXRoRmlsZScgZmlsZVxuICAgICAgICAgICAgICAgIHJldHVybiBmb2N1czogZWRpdG9yLm5hbWVcblxuICAgICAgICAgICAgIyAgMDAwMDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAwIDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwXG4gICAgICAgICAgICAjICAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcblxuICAgICAgICAgICAgd2hlbiAnY2xlYW4nXG5cbiAgICAgICAgICAgICAgICBlZGl0b3IuZG8uc3RhcnQoKVxuICAgICAgICAgICAgICAgIGZvciBsaSBpbiBbMC4uLmVkaXRvci5udW1MaW5lcygpXVxuICAgICAgICAgICAgICAgICAgICBsaW5lID0gZWRpdG9yLmxpbmUgbGlcbiAgICAgICAgICAgICAgICAgICAgY2xlYW5lZCA9IGxpbmUudHJpbVJpZ2h0KClcbiAgICAgICAgICAgICAgICAgICAgaWYgbGluZSAhPSBjbGVhbmVkXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZG8uY2hhbmdlIGxpLCBjbGVhbmVkXG4gICAgICAgICAgICAgICAgZWRpdG9yLmRvLmVuZCgpXG5cbiAgICAgICAgICAgIHdoZW4gJ3VuaXgnXG5cbiAgICAgICAgICAgICAgICBlZGl0b3IubmV3bGluZUNoYXJhY3RlcnMgPSAnXFxuJ1xuICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAnc2F2ZUZpbGUnXG5cbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAgICAwMDBcblxuICAgICAgICAgICAgd2hlbiAnaGVhZGVyJ1xuXG4gICAgICAgICAgICAgICAgZWRpdG9yLnRvZ2dsZUhlYWRlcigpXG5cbiAgICAgICAgICAgIHdoZW4gJ2NvbCdcblxuICAgICAgICAgICAgICAgIG51bSAgPSBhcmdzLmxlbmd0aCA+IDAgYW5kIHBhcnNlSW50KGFyZ3NbMF0pIG9yIDEwXG4gICAgICAgICAgICAgICAgc3RlcCA9IGFyZ3MubGVuZ3RoID4gMSBhbmQgcGFyc2VJbnQoYXJnc1sxXSkgb3IgMVxuICAgICAgICAgICAgICAgIGVkaXRvci5jdXJzb3JDb2x1bW5zIG51bSwgc3RlcFxuXG4gICAgICAgICAgICB3aGVuICdsaW5lJ1xuXG4gICAgICAgICAgICAgICAgbnVtICA9IGFyZ3MubGVuZ3RoID4gMCBhbmQgcGFyc2VJbnQoYXJnc1swXSkgb3IgMTBcbiAgICAgICAgICAgICAgICBzdGVwID0gYXJncy5sZW5ndGggPiAxIGFuZCBwYXJzZUludChhcmdzWzFdKSBvciAxXG4gICAgICAgICAgICAgICAgZWRpdG9yLmN1cnNvckxpbmVzIG51bSwgc3RlcFxuXG4gICAgICAgICAgICBlbHNlXG5cbiAgICAgICAgICAgICAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAgICAgIDAwXG4gICAgICAgICAgICAgICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgICAgICMgICAgMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwMDBcbiAgICAgICAgICAgICAgICAjICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgICAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwXG4gICAgICAgICAgICAgICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG4gICAgICAgICAgICAgICAgaWYgVHJhbnNmb3JtLnRyYW5zZm9ybU5hbWVzIGFuZCBjbW1kIGluIFRyYW5zZm9ybS50cmFuc2Zvcm1OYW1lc1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5UcmFuc2Zvcm0uZG8uYXBwbHkgbnVsbCwgW3dpbmRvdy50ZXh0RWRpdG9yLCBjbW1kXS5jb25jYXQgYXJnc1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAga2Vycm9yICd1bmhhbmRsZWQgbWFjcm8nLCBjbW1kLCBUcmFuc2Zvcm0udHJhbnNmb3JtTmFtZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgXy5sYXN0KEBoaXN0b3J5KSA9PSBjb21tYW5kLnRyaW0oKVxuICAgICAgICAgICAgICAgICAgICAgICAgQGhpc3RvcnkucG9wKClcblxuICAgICAgICBzZWxlY3Q6IHRydWVcblxubW9kdWxlLmV4cG9ydHMgPSBNYWNyb1xuIl19
//# sourceURL=../../coffee/commands/macro.coffee