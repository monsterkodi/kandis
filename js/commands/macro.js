// koffee 1.4.0

/*
00     00   0000000    0000000  00000000    0000000
000   000  000   000  000       000   000  000   000
000000000  000000000  000       0000000    000   000
000 0 000  000   000  000       000   000  000   000
000   000  000   000   0000000  000   000   0000000
 */
var Command, GitInfo, Macro, Transform, _, args, empty, fs, indexer, kerror, post, prefs, ref, req, reversed, salt, slash, syntax, valid,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf;

ref = require('kxk'), post = ref.post, reversed = ref.reversed, empty = ref.empty, prefs = ref.prefs, slash = ref.slash, valid = ref.valid, args = ref.args, fs = ref.fs, kerror = ref.kerror, _ = ref._;

indexer = require('../main/indexer');

salt = require('../tools/salt');

req = require('../tools/req');

GitInfo = require('../win/gitinfo');

Command = require('../commandline/command');

syntax = require('../editor/syntax');

Transform = require('../editor/actions/transform');

Macro = (function(superClass) {
    extend(Macro, superClass);

    Macro.macroNames = ['clean', 'help', 'dbg', 'class', 'req', 'inv', 'blink', 'color', 'fps', 'cwd', 'git', 'unix'];

    function Macro(commandline) {
        Macro.__super__.constructor.call(this, commandline);
        this.macros = Macro.macroNames;
        this.macros = this.macros.concat(Transform.transformNames);
        this.names = ['macro'];
    }

    Macro.prototype.start = function(name) {
        var text;
        Macro.__super__.start.call(this, name);
        text = this.last();
        if (!(text != null ? text.length : void 0)) {
            text = 'dbg';
        }
        return {
            text: text,
            select: true
        };
    };

    Macro.prototype.listItems = function() {
        var i, items, j, len, results;
        items = _.uniq(_.concat(reversed(this.history), this.macros));
        results = [];
        for (j = 0, len = items.length; j < len; j++) {
            i = items[j];
            results.push({
                text: i,
                line: indexOf.call(this.macros, i) >= 0 && '◼' || '◆',
                type: 'macro'
            });
        }
        return results;
    };

    Macro.prototype.execute = function(command) {
        var cleaned, clss, cmmd, cp, dir, editor, file, indent, insert, j, k, l, len, len1, li, line, lines, lst, m, n, num, ref1, ref2, ref3, ref4, ref5, s, step, t, terminal, text, ti, words, wordsInArgsOrCursorsOrSelection;
        if (empty(command)) {
            return kerror('no command!');
        }
        command = Macro.__super__.execute.call(this, command);
        editor = window.editor;
        cp = editor.cursorPos();
        args = command.split(/\s+/);
        cmmd = args.shift();
        wordsInArgsOrCursorsOrSelection = function(args, opt) {
            var cw, ws;
            if (args.length) {
                return args;
            } else {
                cw = editor.wordsAtCursors(positionsNotInRanges(editor.cursors(), editor.selections()), opt);
                ws = _.uniq(cw.concat(editor.textsInRanges(editor.selections())));
                return ws.filter(function(w) {
                    return w.trim().length;
                });
            }
        };
        switch (cmmd) {
            case 'inv':
                window.textEditor.toggleInvisibles();
                break;
            case 'blink':
                editor.toggleBlink();
                if (prefs.get('blink')) {
                    this.commandline.startBlink();
                } else {
                    this.commandline.stopBlink();
                }
                break;
            case 'color':
                editor.togglePigments();
                break;
            case 'fps':
                if ((ref1 = window.fps) != null) {
                    ref1.toggle();
                }
                break;
            case 'cwd':
                if ((ref2 = window.cwd) != null) {
                    ref2.toggle();
                }
                break;
            case 'git':
                GitInfo.start();
                break;
            case 'err':
                post.toMain('throwError');
                throw new Error('err');
                break;
            case 'help':
                terminal = window.terminal;
                text = fs.readFileSync(__dirname + "/../../bin/cheet.noon", {
                    encoding: 'utf8'
                });
                terminal.clear();
                ref3 = text.split('\n');
                for (j = 0, len = ref3.length; j < len; j++) {
                    l = ref3[j];
                    terminal.appendLineDiss(l, syntax.dissForTextAndSyntax(l, 'noon'));
                }
                terminal.scroll.cursorToTop(1);
                window.split["do"]('show terminal');
                break;
            case 'req':
                if (slash.ext(editor.currentFile) !== 'coffee') {
                    return;
                }
                words = [];
                lines = req(editor.currentFile, editor.lines(), words, editor);
                if (valid(lines)) {
                    editor["do"].start();
                    for (k = 0, len1 = lines.length; k < len1; k++) {
                        line = lines[k];
                        if (line.op === 'insert') {
                            editor["do"].insert(line.index, line.text);
                        } else {
                            editor["do"].change(line.index, line.text);
                        }
                    }
                    editor["do"].end();
                    return {
                        "do": "focus editor"
                    };
                }
                break;
            case 'dbg':
                li = cp[1];
                indent = editor.indentStringForLineAtIndex(li);
                if (!editor.isCursorInIndent() && !editor.isCursorInLastLine()) {
                    li += 1;
                }
                insert = indent + 'log "';
                insert += editor.funcInfoAtLineIndex(li);
                lst = args.length && parseInt(args[0]) || 0;
                if (lst) {
                    args.shift();
                }
                words = wordsInArgsOrCursorsOrSelection(args, {
                    include: "#@.-"
                });
                for (ti = m = 0, ref4 = words.length - lst; 0 <= ref4 ? m < ref4 : m > ref4; ti = 0 <= ref4 ? ++m : --m) {
                    t = words[ti];
                    insert += t + ":\#{kstr " + t + "} ";
                }
                insert = insert.trimRight();
                insert += '"';
                if (lst) {
                    insert += ((function() {
                        var n, ref5, ref6, results;
                        results = [];
                        for (ti = n = ref5 = words.length - lst, ref6 = words.length; ref5 <= ref6 ? n < ref6 : n > ref6; ti = ref5 <= ref6 ? ++n : --n) {
                            results.push(", kstr(" + words[ti] + ")");
                        }
                        return results;
                    })()).join('');
                }
                editor["do"].start();
                editor["do"].insert(li, insert);
                editor.singleCursorAtPos([editor.line(li).length, li]);
                editor["do"].end();
                ({
                    focus: editor.name
                });
                break;
            case 'class':
                clss = args.length && args[0] || _.last(editor.textsInRanges(editor.selections()));
                if (clss != null) {
                    clss;
                } else {
                    clss = 'Class';
                }
                dir = (editor.currentFile != null) && slash.dir(editor.currentFile) || process.cwd();
                file = slash.join(dir, clss.toLowerCase() + '.coffee');
                if (slash.fileExists(file)) {
                    return {
                        text: "file " + file + " exists!"
                    };
                }
                text = "###\n";
                text += ((function() {
                    var len2, n, ref5, results;
                    ref5 = salt(clss).split('\n');
                    results = [];
                    for (n = 0, len2 = ref5.length; n < len2; n++) {
                        s = ref5[n];
                        results.push(s);
                    }
                    return results;
                })()).join('\n');
                text += "\n###\n";
                text += "\nclass " + clss + "\n\n    @: () ->\n\n\nmodule.exports = " + clss + "\n";
                fs.writeFile(file, text, {
                    encoding: 'utf8'
                }, function(err) {
                    if (err != null) {
                        kerror('writing class skeleton failed', err);
                        return;
                    }
                    return post.emit('newTabWithFile', file);
                });
                return {
                    focus: editor.name
                };
            case 'clean':
                editor["do"].start();
                for (li = n = 0, ref5 = editor.numLines(); 0 <= ref5 ? n < ref5 : n > ref5; li = 0 <= ref5 ? ++n : --n) {
                    line = editor.line(li);
                    cleaned = line.trimRight();
                    if (line !== cleaned) {
                        editor["do"].change(li, cleaned);
                    }
                }
                editor["do"].end();
                break;
            case 'unix':
                editor.newlineCharacters = '\n';
                post.emit('saveFile');
                break;
            case 'header':
                editor.toggleHeader();
                break;
            case 'col':
                num = args.length > 0 && parseInt(args[0]) || 10;
                step = args.length > 1 && parseInt(args[1]) || 1;
                editor.cursorColumns(num, step);
                break;
            case 'line':
                num = args.length > 0 && parseInt(args[0]) || 10;
                step = args.length > 1 && parseInt(args[1]) || 1;
                editor.cursorLines(num, step);
                break;
            default:
                if (Transform.transformNames && indexOf.call(Transform.transformNames, cmmd) >= 0) {
                    window.textEditor.Transform["do"].apply(null, [window.textEditor, cmmd].concat(args));
                } else {
                    kerror('unhandled macro', cmmd, Transform.transformNames);
                    if (_.last(this.history) === command.trim()) {
                        this.history.pop();
                    }
                }
        }
        return {
            select: true
        };
    };

    return Macro;

})(Command);

module.exports = Macro;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFjcm8uanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLG9JQUFBO0lBQUE7Ozs7QUFRQSxNQUFzRSxPQUFBLENBQVEsS0FBUixDQUF0RSxFQUFFLGVBQUYsRUFBUSx1QkFBUixFQUFrQixpQkFBbEIsRUFBeUIsaUJBQXpCLEVBQWdDLGlCQUFoQyxFQUF1QyxpQkFBdkMsRUFBOEMsZUFBOUMsRUFBb0QsV0FBcEQsRUFBd0QsbUJBQXhELEVBQWdFOztBQUVoRSxPQUFBLEdBQVksT0FBQSxDQUFRLGlCQUFSOztBQUNaLElBQUEsR0FBWSxPQUFBLENBQVEsZUFBUjs7QUFDWixHQUFBLEdBQVksT0FBQSxDQUFRLGNBQVI7O0FBQ1osT0FBQSxHQUFZLE9BQUEsQ0FBUSxnQkFBUjs7QUFDWixPQUFBLEdBQVksT0FBQSxDQUFRLHdCQUFSOztBQUNaLE1BQUEsR0FBWSxPQUFBLENBQVEsa0JBQVI7O0FBQ1osU0FBQSxHQUFZLE9BQUEsQ0FBUSw2QkFBUjs7QUFFTjs7O0lBRUYsS0FBQyxDQUFBLFVBQUQsR0FBYyxDQUFDLE9BQUQsRUFBUyxNQUFULEVBQWdCLEtBQWhCLEVBQXNCLE9BQXRCLEVBQThCLEtBQTlCLEVBQW9DLEtBQXBDLEVBQTBDLE9BQTFDLEVBQWtELE9BQWxELEVBQTBELEtBQTFELEVBQWdFLEtBQWhFLEVBQXNFLEtBQXRFLEVBQTRFLE1BQTVFOztJQUVYLGVBQUMsV0FBRDtRQUVDLHVDQUFNLFdBQU47UUFFQSxJQUFDLENBQUEsTUFBRCxHQUFVLEtBQUssQ0FBQztRQUNoQixJQUFDLENBQUEsTUFBRCxHQUFVLElBQUMsQ0FBQSxNQUFNLENBQUMsTUFBUixDQUFlLFNBQVMsQ0FBQyxjQUF6QjtRQUNWLElBQUMsQ0FBQSxLQUFELEdBQVUsQ0FBQyxPQUFEO0lBTlg7O29CQWNILEtBQUEsR0FBTyxTQUFDLElBQUQ7QUFFSCxZQUFBO1FBQUEsaUNBQU0sSUFBTjtR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QUFwQixJQUF5QztnQkFDaEQsSUFBQSxHQUFPLElBQUksQ0FBQyxNQUFMLEdBQWMsQ0FBZCxJQUFvQixRQUFBLENBQVMsSUFBSyxDQUFBLENBQUEsQ0FBZCxDQUFwQixJQUF5QztnQkFDaEQsTUFBTSxDQUFDLFdBQVAsQ0FBbUIsR0FBbkIsRUFBd0IsSUFBeEI7QUFKQztBQTVMVDtnQkEwTVEsSUFBRyxTQUFTLENBQUMsY0FBVixJQUE2QixhQUFRLFNBQVMsQ0FBQyxjQUFsQixFQUFBLElBQUEsTUFBaEM7b0JBQ0ksTUFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUMsRUFBRCxFQUFHLENBQUMsS0FBL0IsQ0FBcUMsSUFBckMsRUFBMkMsQ0FBQyxNQUFNLENBQUMsVUFBUixFQUFvQixJQUFwQixDQUF5QixDQUFDLE1BQTFCLENBQWlDLElBQWpDLENBQTNDLEVBREo7aUJBQUEsTUFBQTtvQkFHSSxNQUFBLENBQU8saUJBQVAsRUFBMEIsSUFBMUIsRUFBZ0MsU0FBUyxDQUFDLGNBQTFDO29CQUNBLElBQUcsQ0FBQyxDQUFDLElBQUYsQ0FBTyxJQUFDLENBQUEsT0FBUixDQUFBLEtBQW9CLE9BQU8sQ0FBQyxJQUFSLENBQUEsQ0FBdkI7d0JBQ0ksSUFBQyxDQUFBLE9BQU8sQ0FBQyxHQUFULENBQUEsRUFESjtxQkFKSjs7QUExTVI7ZUFpTkE7WUFBQSxNQUFBLEVBQVEsSUFBUjs7SUFwT0s7Ozs7R0E1Q087O0FBa1JwQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAgICAgIDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMCAgICAwMDAwMDAwXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwICAgMDAwXG4wMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDBcbiMjI1xuXG57IHBvc3QsIHJldmVyc2VkLCBlbXB0eSwgcHJlZnMsIHNsYXNoLCB2YWxpZCwgYXJncywgZnMsIGtlcnJvciwgXyB9ID0gcmVxdWlyZSAna3hrJ1xuXG5pbmRleGVyICAgPSByZXF1aXJlICcuLi9tYWluL2luZGV4ZXInXG5zYWx0ICAgICAgPSByZXF1aXJlICcuLi90b29scy9zYWx0J1xucmVxICAgICAgID0gcmVxdWlyZSAnLi4vdG9vbHMvcmVxJ1xuR2l0SW5mbyAgID0gcmVxdWlyZSAnLi4vd2luL2dpdGluZm8nXG5Db21tYW5kICAgPSByZXF1aXJlICcuLi9jb21tYW5kbGluZS9jb21tYW5kJ1xuc3ludGF4ICAgID0gcmVxdWlyZSAnLi4vZWRpdG9yL3N5bnRheCdcblRyYW5zZm9ybSA9IHJlcXVpcmUgJy4uL2VkaXRvci9hY3Rpb25zL3RyYW5zZm9ybSdcblxuY2xhc3MgTWFjcm8gZXh0ZW5kcyBDb21tYW5kXG5cbiAgICBAbWFjcm9OYW1lcyA9IFsnY2xlYW4nICdoZWxwJyAnZGJnJyAnY2xhc3MnICdyZXEnICdpbnYnICdibGluaycgJ2NvbG9yJyAnZnBzJyAnY3dkJyAnZ2l0JyAndW5peCddXG5cbiAgICBAOiAoY29tbWFuZGxpbmUpIC0+XG5cbiAgICAgICAgc3VwZXIgY29tbWFuZGxpbmVcblxuICAgICAgICBAbWFjcm9zID0gTWFjcm8ubWFjcm9OYW1lc1xuICAgICAgICBAbWFjcm9zID0gQG1hY3Jvcy5jb25jYXQgVHJhbnNmb3JtLnRyYW5zZm9ybU5hbWVzXG4gICAgICAgIEBuYW1lcyAgPSBbJ21hY3JvJ11cblxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMFxuICAgICMgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMDAwICAwMDAwMDAwICAgICAgIDAwMFxuICAgICMgICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMFxuICAgICMgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMFxuXG4gICAgc3RhcnQ6IChuYW1lKSAtPlxuXG4gICAgICAgIHN1cGVyIG5hbWVcbiAgICAgICAgdGV4dCA9IEBsYXN0KClcbiAgICAgICAgdGV4dCA9ICdkYmcnIGlmIG5vdCB0ZXh0Py5sZW5ndGhcbiAgICAgICAgdGV4dDogICB0ZXh0XG4gICAgICAgIHNlbGVjdDogdHJ1ZVxuXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAwMDAwICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgIDAwMCAgMDAwICAgICAgICAgIDAwMFxuICAgICMgMDAwICAgICAgMDAwICAwMDAwMDAwICAgICAgMDAwXG4gICAgIyAwMDAgICAgICAwMDAgICAgICAgMDAwICAgICAwMDBcbiAgICAjIDAwMDAwMDAgIDAwMCAgMDAwMDAwMCAgICAgIDAwMFxuXG4gICAgbGlzdEl0ZW1zOiAtPlxuXG4gICAgICAgIGl0ZW1zID0gXy51bmlxIF8uY29uY2F0IHJldmVyc2VkKEBoaXN0b3J5KSwgQG1hY3Jvc1xuXG4gICAgICAgICh7dGV4dDogaSwgbGluZTogaSBpbiBAbWFjcm9zIGFuZCAn4pe8JyBvciAn4peGJywgdHlwZTonbWFjcm8nfSBmb3IgaSBpbiBpdGVtcylcblxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMFxuXG4gICAgZXhlY3V0ZTogKGNvbW1hbmQpIC0+XG5cbiAgICAgICAgcmV0dXJuIGtlcnJvciAnbm8gY29tbWFuZCEnIGlmIGVtcHR5IGNvbW1hbmRcblxuICAgICAgICBjb21tYW5kID0gc3VwZXIgY29tbWFuZFxuXG4gICAgICAgIGVkaXRvciAgPSB3aW5kb3cuZWRpdG9yXG4gICAgICAgIGNwICAgICAgPSBlZGl0b3IuY3Vyc29yUG9zKClcbiAgICAgICAgYXJncyAgICA9IGNvbW1hbmQuc3BsaXQgL1xccysvXG4gICAgICAgIGNtbWQgICAgPSBhcmdzLnNoaWZ0KClcblxuICAgICAgICB3b3Jkc0luQXJnc09yQ3Vyc29yc09yU2VsZWN0aW9uID0gKGFyZ3MsIG9wdCkgLT5cbiAgICAgICAgICAgIGlmIGFyZ3MubGVuZ3RoXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyZ3NcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBjdyA9IGVkaXRvci53b3Jkc0F0Q3Vyc29ycyBwb3NpdGlvbnNOb3RJblJhbmdlcyhlZGl0b3IuY3Vyc29ycygpLCBlZGl0b3Iuc2VsZWN0aW9ucygpKSwgb3B0XG4gICAgICAgICAgICAgICAgd3MgPSBfLnVuaXEgY3cuY29uY2F0IGVkaXRvci50ZXh0c0luUmFuZ2VzIGVkaXRvci5zZWxlY3Rpb25zKClcbiAgICAgICAgICAgICAgICB3cy5maWx0ZXIgKHcpIC0+IHcudHJpbSgpLmxlbmd0aFxuXG4gICAgICAgIHN3aXRjaCBjbW1kXG5cbiAgICAgICAgICAgICMgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgIDAwMDAgIDAwMCAgMDAwICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgMDAwIDAgMDAwICAgMDAwIDAwMFxuICAgICAgICAgICAgIyAwMDAgIDAwMCAgMDAwMCAgICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgMFxuXG4gICAgICAgICAgICB3aGVuICdpbnYnXG4gICAgICAgICAgICAgICAgd2luZG93LnRleHRFZGl0b3IudG9nZ2xlSW52aXNpYmxlcygpXG5cbiAgICAgICAgICAgICMgMDAwMDAwMCAgICAwMDAgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAwMDAwICAwMDAgIDAwMCAgMDAwXG4gICAgICAgICAgICAjIDAwMDAwMDAgICAgMDAwICAgICAgMDAwICAwMDAgMCAwMDAgIDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgICAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAwMDBcbiAgICAgICAgICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG5cbiAgICAgICAgICAgIHdoZW4gJ2JsaW5rJ1xuICAgICAgICAgICAgICAgIGVkaXRvci50b2dnbGVCbGluaygpXG4gICAgICAgICAgICAgICAgaWYgcHJlZnMuZ2V0ICdibGluaydcbiAgICAgICAgICAgICAgICAgICAgQGNvbW1hbmRsaW5lLnN0YXJ0QmxpbmsoKVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgQGNvbW1hbmRsaW5lLnN0b3BCbGluaygpXG5cbiAgICAgICAgICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAgICAwMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgICAgICAgICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcblxuICAgICAgICAgICAgd2hlbiAnY29sb3InIHRoZW4gZWRpdG9yLnRvZ2dsZVBpZ21lbnRzKClcblxuICAgICAgICAgICAgIyAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAgICAgICAgMDAwMDAwMCAgIDAwMCAgMDAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgICAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgICAgMDAwICAgICAwMDBcbiAgICAgICAgICAgICMgMDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAgICAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAwMDAwICAwMDAgICAgIDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAgICAgIDAwMDAwMDAgICAgICAgICAgMDAwMDAwMCAgMDAgICAgIDAwICAwMDAwMDAwICAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAwMDBcblxuICAgICAgICAgICAgd2hlbiAnZnBzJyAgIHRoZW4gd2luZG93LmZwcz8udG9nZ2xlKClcbiAgICAgICAgICAgIHdoZW4gJ2N3ZCcgICB0aGVuIHdpbmRvdy5jd2Q/LnRvZ2dsZSgpXG4gICAgICAgICAgICB3aGVuICdnaXQnICAgdGhlbiBHaXRJbmZvLnN0YXJ0KClcbiAgICAgICAgICAgIHdoZW4gJ2VycidcbiAgICAgICAgICAgICAgICBwb3N0LnRvTWFpbiAndGhyb3dFcnJvcidcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IgJ2VycidcblxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAgICAwMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDBcbiAgICAgICAgICAgICMgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAgICAgMDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMFxuXG4gICAgICAgICAgICB3aGVuICdoZWxwJ1xuXG4gICAgICAgICAgICAgICAgdGVybWluYWwgPSB3aW5kb3cudGVybWluYWxcbiAgICAgICAgICAgICAgICB0ZXh0ID0gZnMucmVhZEZpbGVTeW5jIFwiI3tfX2Rpcm5hbWV9Ly4uLy4uL2Jpbi9jaGVldC5ub29uXCIsIGVuY29kaW5nOiAndXRmOCdcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbC5jbGVhcigpXG4gICAgICAgICAgICAgICAgZm9yIGwgaW4gdGV4dC5zcGxpdCAnXFxuJ1xuICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hbC5hcHBlbmRMaW5lRGlzcyBsLCBzeW50YXguZGlzc0ZvclRleHRBbmRTeW50YXggbCwgJ25vb24nXG5cbiAgICAgICAgICAgICAgICB0ZXJtaW5hbC5zY3JvbGwuY3Vyc29yVG9Ub3AgMVxuICAgICAgICAgICAgICAgIHdpbmRvdy5zcGxpdC5kbyAnc2hvdyB0ZXJtaW5hbCdcblxuICAgICAgICAgICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAgICAgICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwIDAwIDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMCAwMFxuXG4gICAgICAgICAgICB3aGVuICdyZXEnXG5cbiAgICAgICAgICAgICAgICByZXR1cm4gaWYgc2xhc2guZXh0KGVkaXRvci5jdXJyZW50RmlsZSkgIT0gJ2NvZmZlZSdcbiAgICAgICAgICAgICAgICAjIHdvcmRzID0gd29yZHNJbkFyZ3NPckN1cnNvcnNPclNlbGVjdGlvbiBhcmdzXG4gICAgICAgICAgICAgICAgd29yZHMgPSBbXVxuICAgICAgICAgICAgICAgIGxpbmVzID0gcmVxIGVkaXRvci5jdXJyZW50RmlsZSwgZWRpdG9yLmxpbmVzKCksIHdvcmRzLCBlZGl0b3JcblxuICAgICAgICAgICAgICAgIGlmIHZhbGlkIGxpbmVzXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5kby5zdGFydCgpXG4gICAgICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIGxpbmVzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBsaW5lLm9wID09ICdpbnNlcnQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmRvLmluc2VydCBsaW5lLmluZGV4LCBsaW5lLnRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZG8uY2hhbmdlIGxpbmUuaW5kZXgsIGxpbmUudGV4dFxuICAgICAgICAgICAgICAgICAgICAjIGVkaXRvci5tb3ZlQ3Vyc29yc0Rvd24gZmFsc2UsIGxpbmVzLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZG8uZW5kKClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRvOiBcImZvY3VzIGVkaXRvclwiXG5cbiAgICAgICAgICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMCAgMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgICAgICAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAwMFxuXG4gICAgICAgICAgICB3aGVuICdkYmcnXG5cbiAgICAgICAgICAgICAgICBsaSA9IGNwWzFdXG4gICAgICAgICAgICAgICAgaW5kZW50ID0gZWRpdG9yLmluZGVudFN0cmluZ0ZvckxpbmVBdEluZGV4IGxpXG4gICAgICAgICAgICAgICAgbGkgKz0gMSBpZiBub3QgZWRpdG9yLmlzQ3Vyc29ySW5JbmRlbnQoKSBhbmQgbm90IGVkaXRvci5pc0N1cnNvckluTGFzdExpbmUoKVxuICAgICAgICAgICAgICAgIGluc2VydCA9IGluZGVudCArICdsb2cgXCInXG4gICAgICAgICAgICAgICAgaW5zZXJ0ICs9IGVkaXRvci5mdW5jSW5mb0F0TGluZUluZGV4IGxpXG4gICAgICAgICAgICAgICAgbHN0ID0gYXJncy5sZW5ndGggYW5kIHBhcnNlSW50KGFyZ3NbMF0pIG9yIDBcbiAgICAgICAgICAgICAgICBhcmdzLnNoaWZ0KCkgaWYgbHN0XG4gICAgICAgICAgICAgICAgd29yZHMgPSB3b3Jkc0luQXJnc09yQ3Vyc29yc09yU2VsZWN0aW9uIGFyZ3MsIGluY2x1ZGU6IFwiI0AuLVwiXG4gICAgICAgICAgICAgICAgZm9yIHRpIGluIFswLi4ud29yZHMubGVuZ3RoIC0gbHN0XVxuICAgICAgICAgICAgICAgICAgICB0ID0gd29yZHNbdGldXG4gICAgICAgICAgICAgICAgICAgIGluc2VydCArPSBcIiN7dH06XFwje2tzdHIgI3t0fX0gXCJcbiAgICAgICAgICAgICAgICBpbnNlcnQgPSBpbnNlcnQudHJpbVJpZ2h0KClcbiAgICAgICAgICAgICAgICBpbnNlcnQgKz0gJ1wiJ1xuICAgICAgICAgICAgICAgIGlmIGxzdFxuICAgICAgICAgICAgICAgICAgICBpbnNlcnQgKz0gKFwiLCBrc3RyKCN7d29yZHNbdGldfSlcIiBmb3IgdGkgaW4gW3dvcmRzLmxlbmd0aCAtIGxzdC4uLndvcmRzLmxlbmd0aF0pLmpvaW4gJydcblxuICAgICAgICAgICAgICAgIGVkaXRvci5kby5zdGFydCgpXG4gICAgICAgICAgICAgICAgZWRpdG9yLmRvLmluc2VydCBsaSwgaW5zZXJ0XG4gICAgICAgICAgICAgICAgZWRpdG9yLnNpbmdsZUN1cnNvckF0UG9zIFtlZGl0b3IubGluZShsaSkubGVuZ3RoLCBsaV1cbiAgICAgICAgICAgICAgICBlZGl0b3IuZG8uZW5kKClcblxuICAgICAgICAgICAgICAgIGZvY3VzOiBlZGl0b3IubmFtZVxuXG4gICAgICAgICAgICAjICAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMFxuICAgICAgICAgICAgIyAgMDAwMDAwMCAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwMFxuXG4gICAgICAgICAgICB3aGVuICdjbGFzcydcblxuICAgICAgICAgICAgICAgIGNsc3MgPSBhcmdzLmxlbmd0aCBhbmQgYXJnc1swXSBvciBfLmxhc3QgZWRpdG9yLnRleHRzSW5SYW5nZXMoZWRpdG9yLnNlbGVjdGlvbnMoKSlcbiAgICAgICAgICAgICAgICBjbHNzID89ICdDbGFzcydcbiAgICAgICAgICAgICAgICBkaXIgPSBlZGl0b3IuY3VycmVudEZpbGU/IGFuZCBzbGFzaC5kaXIoZWRpdG9yLmN1cnJlbnRGaWxlKSBvciBwcm9jZXNzLmN3ZCgpXG4gICAgICAgICAgICAgICAgZmlsZSA9IHNsYXNoLmpvaW4gZGlyLCBjbHNzLnRvTG93ZXJDYXNlKCkgKyAnLmNvZmZlZSdcbiAgICAgICAgICAgICAgICBpZiBzbGFzaC5maWxlRXhpc3RzIGZpbGVcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ6IFwiZmlsZSAje2ZpbGV9IGV4aXN0cyFcIlxuICAgICAgICAgICAgICAgIHRleHQgPSBcIiMjI1xcblwiXG4gICAgICAgICAgICAgICAgdGV4dCArPSAocyBmb3IgcyBpbiBzYWx0KGNsc3MpLnNwbGl0ICdcXG4nKS5qb2luICdcXG4nXG4gICAgICAgICAgICAgICAgdGV4dCArPSBcIlxcbiMjI1xcblwiXG4gICAgICAgICAgICAgICAgdGV4dCArPSBcIlwiXCJcblxuICAgICAgICAgICAgICAgIGNsYXNzICN7Y2xzc31cblxuICAgICAgICAgICAgICAgICAgICBAOiAoKSAtPlxuXG5cbiAgICAgICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9ICN7Y2xzc31cblxuICAgICAgICAgICAgICAgIFwiXCJcIlxuICAgICAgICAgICAgICAgIGZzLndyaXRlRmlsZSBmaWxlLCB0ZXh0LCBlbmNvZGluZzondXRmOCcsIChlcnIpIC0+XG4gICAgICAgICAgICAgICAgICAgIGlmIGVycj9cbiAgICAgICAgICAgICAgICAgICAgICAgIGtlcnJvciAnd3JpdGluZyBjbGFzcyBza2VsZXRvbiBmYWlsZWQnLCBlcnJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgICAgICBwb3N0LmVtaXQgJ25ld1RhYldpdGhGaWxlJywgZmlsZVxuICAgICAgICAgICAgICAgIHJldHVybiBmb2N1czogZWRpdG9yLm5hbWVcblxuICAgICAgICAgICAgIyAgMDAwMDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgICAgICAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAwIDAwMFxuICAgICAgICAgICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwXG4gICAgICAgICAgICAjICAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcblxuICAgICAgICAgICAgd2hlbiAnY2xlYW4nXG5cbiAgICAgICAgICAgICAgICBlZGl0b3IuZG8uc3RhcnQoKVxuICAgICAgICAgICAgICAgIGZvciBsaSBpbiBbMC4uLmVkaXRvci5udW1MaW5lcygpXVxuICAgICAgICAgICAgICAgICAgICBsaW5lID0gZWRpdG9yLmxpbmUgbGlcbiAgICAgICAgICAgICAgICAgICAgY2xlYW5lZCA9IGxpbmUudHJpbVJpZ2h0KClcbiAgICAgICAgICAgICAgICAgICAgaWYgbGluZSAhPSBjbGVhbmVkXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZG8uY2hhbmdlIGxpLCBjbGVhbmVkXG4gICAgICAgICAgICAgICAgZWRpdG9yLmRvLmVuZCgpXG5cbiAgICAgICAgICAgIHdoZW4gJ3VuaXgnXG5cbiAgICAgICAgICAgICAgICBlZGl0b3IubmV3bGluZUNoYXJhY3RlcnMgPSAnXFxuJ1xuICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAnc2F2ZUZpbGUnXG5cbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAwMDAwMFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAgICAwMDBcblxuICAgICAgICAgICAgd2hlbiAnaGVhZGVyJ1xuXG4gICAgICAgICAgICAgICAgZWRpdG9yLnRvZ2dsZUhlYWRlcigpXG5cbiAgICAgICAgICAgIHdoZW4gJ2NvbCdcblxuICAgICAgICAgICAgICAgIG51bSAgPSBhcmdzLmxlbmd0aCA+IDAgYW5kIHBhcnNlSW50KGFyZ3NbMF0pIG9yIDEwXG4gICAgICAgICAgICAgICAgc3RlcCA9IGFyZ3MubGVuZ3RoID4gMSBhbmQgcGFyc2VJbnQoYXJnc1sxXSkgb3IgMVxuICAgICAgICAgICAgICAgIGVkaXRvci5jdXJzb3JDb2x1bW5zIG51bSwgc3RlcFxuXG4gICAgICAgICAgICB3aGVuICdsaW5lJ1xuXG4gICAgICAgICAgICAgICAgbnVtICA9IGFyZ3MubGVuZ3RoID4gMCBhbmQgcGFyc2VJbnQoYXJnc1swXSkgb3IgMTBcbiAgICAgICAgICAgICAgICBzdGVwID0gYXJncy5sZW5ndGggPiAxIGFuZCBwYXJzZUludChhcmdzWzFdKSBvciAxXG4gICAgICAgICAgICAgICAgZWRpdG9yLmN1cnNvckxpbmVzIG51bSwgc3RlcFxuXG4gICAgICAgICAgICBlbHNlXG5cbiAgICAgICAgICAgICAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAgICAgIDAwXG4gICAgICAgICAgICAgICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICAgICAgICAgICAgICMgICAgMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwMDBcbiAgICAgICAgICAgICAgICAjICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgICAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwXG4gICAgICAgICAgICAgICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG4gICAgICAgICAgICAgICAgaWYgVHJhbnNmb3JtLnRyYW5zZm9ybU5hbWVzIGFuZCBjbW1kIGluIFRyYW5zZm9ybS50cmFuc2Zvcm1OYW1lc1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5UcmFuc2Zvcm0uZG8uYXBwbHkgbnVsbCwgW3dpbmRvdy50ZXh0RWRpdG9yLCBjbW1kXS5jb25jYXQgYXJnc1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAga2Vycm9yICd1bmhhbmRsZWQgbWFjcm8nLCBjbW1kLCBUcmFuc2Zvcm0udHJhbnNmb3JtTmFtZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgXy5sYXN0KEBoaXN0b3J5KSA9PSBjb21tYW5kLnRyaW0oKVxuICAgICAgICAgICAgICAgICAgICAgICAgQGhpc3RvcnkucG9wKClcblxuICAgICAgICBzZWxlY3Q6IHRydWVcblxubW9kdWxlLmV4cG9ydHMgPSBNYWNyb1xuIl19
//# sourceURL=../../coffee/commands/macro.coffee