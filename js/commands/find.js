// koffee 0.56.0

/*
00000000  000  000   000  0000000  
000       000  0000  000  000   000
000000    000  000 0 000  000   000
000       000  000  0000  000   000
000       000  000   000  0000000
 */
var Command, Find, empty, os, ref,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

ref = require('kxk'), empty = ref.empty, os = ref.os;

Command = require('../commandline/command');

Find = (function(superClass) {
    extend(Find, superClass);

    function Find(commandline) {
        Find.__super__.constructor.call(this, commandline);
        this.types = ['str', 'Str', 'reg', 'Reg', 'fuzzy', 'glob'];
        this.names = ['find', 'Find', '/find/', '/Find/', 'fiZd', 'f*nd'];
    }

    Find.prototype.historyKey = function() {
        return this.name;
    };

    Find.prototype.start = function(name) {
        var editor;
        if (name === 'find') {
            editor = this.receivingEditor();
            editor.highlightForFind();
            window.split.focus('commandline');
            if (this.getText() !== editor.textOfHighlight() && !empty(editor.textOfHighlight())) {
                this.setText(editor.textOfHighlight());
            }
        }
        this.type = this.types[this.names.indexOf(name)];
        return Find.__super__.start.call(this, name);
    };

    Find.prototype.cancel = function() {
        this.hideList();
        return {
            focus: this.receiver,
            show: 'editor'
        };
    };

    Find.prototype.changed = function(command) {
        var ref1, ref2;
        Find.__super__.changed.call(this, command);
        if (command.length) {
            if (((ref1 = this.type) === 'reg' || ref1 === 'Reg') && ((ref2 = command.trim()) === '^' || ref2 === '$' || ref2 === '^$' || ref2 === '.' || ref2 === '?' || ref2 === '\\' || ref2 === '\\b')) {
                return window.textEditor.clearHighlights();
            } else if (!command.trim().startsWith('|') && !command.trim().endsWith('|')) {
                return window.textEditor.highlightText(command, {
                    type: this.type,
                    select: 'keep'
                });
            }
        } else {
            return window.textEditor.clearHighlights();
        }
    };

    Find.prototype.execute = function(command) {
        command = Find.__super__.execute.call(this, command);
        window.textEditor.highlightText(command, {
            type: this.type,
            select: 'after'
        });
        return {
            text: command,
            select: true
        };
    };

    Find.prototype.handleModKeyComboEvent = function(mod, key, combo, event) {
        switch (combo) {
            case 'shift+enter':
            case 'command+shift+g':
                window.textEditor.highlightText(this.getText(), {
                    type: this.type,
                    select: 'before'
                });
                return;
            case 'command+g':
                this.execute(this.getText());
                return;
            case 'tab':
                window.textEditor.focus();
                return;
        }
        return Find.__super__.handleModKeyComboEvent.call(this, mod, key, combo, event);
    };

    return Find;

})(Command);

module.exports = Find;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmluZC5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsNkJBQUE7SUFBQTs7O0FBUUEsTUFBZ0IsT0FBQSxDQUFRLEtBQVIsQ0FBaEIsRUFBRSxpQkFBRixFQUFTOztBQUVULE9BQUEsR0FBVSxPQUFBLENBQVEsd0JBQVI7O0FBRUo7OztJQUVXLGNBQUMsV0FBRDtRQUVULHNDQUFNLFdBQU47UUFFQSxJQUFDLENBQUEsS0FBRCxHQUFTLENBQUMsS0FBRCxFQUFTLEtBQVQsRUFBa0IsS0FBbEIsRUFBNEIsS0FBNUIsRUFBc0MsT0FBdEMsRUFBK0MsTUFBL0M7UUFDVCxJQUFDLENBQUEsS0FBRCxHQUFTLENBQUMsTUFBRCxFQUFTLE1BQVQsRUFBa0IsUUFBbEIsRUFBNEIsUUFBNUIsRUFBc0MsTUFBdEMsRUFBK0MsTUFBL0M7SUFMQTs7bUJBT2IsVUFBQSxHQUFZLFNBQUE7ZUFBRyxJQUFDLENBQUE7SUFBSjs7bUJBUVosS0FBQSxHQUFPLFNBQUMsSUFBRDtBQUVILFlBQUE7UUFBQSxJQUFHLElBQUEsS0FBUSxNQUFYO1lBQ0ksTUFBQSxHQUFTLElBQUMsQ0FBQSxlQUFELENBQUE7WUFDVCxNQUFNLENBQUMsZ0JBQVAsQ0FBQTtZQUNBLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBYixDQUFtQixhQUFuQjtZQUNBLElBQUcsSUFBQyxDQUFBLE9BQUQsQ0FBQSxDQUFBLEtBQWMsTUFBTSxDQUFDLGVBQVAsQ0FBQSxDQUFkLElBQTJDLENBQUksS0FBQSxDQUFNLE1BQU0sQ0FBQyxlQUFQLENBQUEsQ0FBTixDQUFsRDtnQkFDSSxJQUFDLENBQUEsT0FBRCxDQUFTLE1BQU0sQ0FBQyxlQUFQLENBQUEsQ0FBVCxFQURKO2FBSko7O1FBT0EsSUFBQyxDQUFBLElBQUQsR0FBUSxJQUFDLENBQUEsS0FBTSxDQUFBLElBQUMsQ0FBQSxLQUFLLENBQUMsT0FBUCxDQUFlLElBQWYsQ0FBQTtlQUVmLGdDQUFNLElBQU47SUFYRzs7bUJBbUJQLE1BQUEsR0FBUSxTQUFBO1FBRUosSUFBQyxDQUFBLFFBQUQsQ0FBQTtlQUNBO1lBQUEsS0FBQSxFQUFPLElBQUMsQ0FBQSxRQUFSO1lBQ0EsSUFBQSxFQUFNLFFBRE47O0lBSEk7O21CQVlSLE9BQUEsR0FBUyxTQUFDLE9BQUQ7QUFFTCxZQUFBO1FBQUEsa0NBQU0sT0FBTjtRQUVBLElBQUcsT0FBTyxDQUFDLE1BQVg7WUFDSSxJQUFHLFNBQUEsSUFBQyxDQUFBLEtBQUQsS0FBVSxLQUFWLElBQUEsSUFBQSxLQUFpQixLQUFqQixDQUFBLElBQTRCLFNBQUEsT0FBTyxDQUFDLElBQVIsQ0FBQSxFQUFBLEtBQW1CLEdBQW5CLElBQUEsSUFBQSxLQUF3QixHQUF4QixJQUFBLElBQUEsS0FBNkIsSUFBN0IsSUFBQSxJQUFBLEtBQW1DLEdBQW5DLElBQUEsSUFBQSxLQUF3QyxHQUF4QyxJQUFBLElBQUEsS0FBNkMsSUFBN0MsSUFBQSxJQUFBLEtBQW1ELEtBQW5ELENBQS9CO3VCQUNJLE1BQU0sQ0FBQyxVQUFVLENBQUMsZUFBbEIsQ0FBQSxFQURKO2FBQUEsTUFFSyxJQUFHLENBQUksT0FBTyxDQUFDLElBQVIsQ0FBQSxDQUFjLENBQUMsVUFBZixDQUEwQixHQUExQixDQUFKLElBQXVDLENBQUksT0FBTyxDQUFDLElBQVIsQ0FBQSxDQUFjLENBQUMsUUFBZixDQUF3QixHQUF4QixDQUE5Qzt1QkFDRCxNQUFNLENBQUMsVUFBVSxDQUFDLGFBQWxCLENBQWdDLE9BQWhDLEVBQ0k7b0JBQUEsSUFBQSxFQUFRLElBQUMsQ0FBQSxJQUFUO29CQUNBLE1BQUEsRUFBUSxNQURSO2lCQURKLEVBREM7YUFIVDtTQUFBLE1BQUE7bUJBUUksTUFBTSxDQUFDLFVBQVUsQ0FBQyxlQUFsQixDQUFBLEVBUko7O0lBSks7O21CQW9CVCxPQUFBLEdBQVMsU0FBQyxPQUFEO1FBRUwsT0FBQSxHQUFVLGtDQUFNLE9BQU47UUFFVixNQUFNLENBQUMsVUFBVSxDQUFDLGFBQWxCLENBQWdDLE9BQWhDLEVBQ0k7WUFBQSxJQUFBLEVBQU0sSUFBQyxDQUFBLElBQVA7WUFDQSxNQUFBLEVBQVEsT0FEUjtTQURKO2VBSUE7WUFBQSxJQUFBLEVBQVEsT0FBUjtZQUNBLE1BQUEsRUFBUSxJQURSOztJQVJLOzttQkFpQlQsc0JBQUEsR0FBd0IsU0FBQyxHQUFELEVBQU0sR0FBTixFQUFXLEtBQVgsRUFBa0IsS0FBbEI7QUFFcEIsZ0JBQU8sS0FBUDtBQUFBLGlCQUVTLGFBRlQ7QUFBQSxpQkFFd0IsaUJBRnhCO2dCQUlRLE1BQU0sQ0FBQyxVQUFVLENBQUMsYUFBbEIsQ0FBZ0MsSUFBQyxDQUFBLE9BQUQsQ0FBQSxDQUFoQyxFQUNJO29CQUFBLElBQUEsRUFBTSxJQUFDLENBQUEsSUFBUDtvQkFDQSxNQUFBLEVBQVEsUUFEUjtpQkFESjtBQUdBO0FBUFIsaUJBU1MsV0FUVDtnQkFXUSxJQUFDLENBQUEsT0FBRCxDQUFTLElBQUMsQ0FBQSxPQUFELENBQUEsQ0FBVDtBQUNBO0FBWlIsaUJBY1MsS0FkVDtnQkFnQlEsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFsQixDQUFBO0FBQ0E7QUFqQlI7ZUFtQkEsaURBQU0sR0FBTixFQUFXLEdBQVgsRUFBZ0IsS0FBaEIsRUFBdUIsS0FBdkI7SUFyQm9COzs7O0dBckZUOztBQTRHbkIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgXG4wMDAgICAgICAgMDAwICAwMDAwICAwMDAgIDAwMCAgIDAwMFxuMDAwMDAwICAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDBcbjAwMCAgICAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgMDAwXG4wMDAgICAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuIyMjXG5cbnsgZW1wdHksIG9zIH0gPSByZXF1aXJlICdreGsnXG5cbkNvbW1hbmQgPSByZXF1aXJlICcuLi9jb21tYW5kbGluZS9jb21tYW5kJ1xuXG5jbGFzcyBGaW5kIGV4dGVuZHMgQ29tbWFuZFxuXG4gICAgY29uc3RydWN0b3I6IChjb21tYW5kbGluZSkgLT5cbiAgICAgICAgXG4gICAgICAgIHN1cGVyIGNvbW1hbmRsaW5lXG4gICAgICAgIFxuICAgICAgICBAdHlwZXMgPSBbJ3N0cicsICAnU3RyJywgICAncmVnJywgICAgJ1JlZycsICAgICdmdXp6eScsICdnbG9iJ11cbiAgICAgICAgQG5hbWVzID0gWydmaW5kJywgJ0ZpbmQnLCAgJy9maW5kLycsICcvRmluZC8nLCAnZmlaZCcsICAnZipuZCddXG4gICAgICAgXG4gICAgaGlzdG9yeUtleTogLT4gQG5hbWVcbiAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgICAgMDAwICAgXG4gICAgIyAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgXG4gICAgICAgIFxuICAgIHN0YXJ0OiAobmFtZSkgLT5cbiAgICAgICAgXG4gICAgICAgIGlmIG5hbWUgPT0gJ2ZpbmQnXG4gICAgICAgICAgICBlZGl0b3IgPSBAcmVjZWl2aW5nRWRpdG9yKClcbiAgICAgICAgICAgIGVkaXRvci5oaWdobGlnaHRGb3JGaW5kKClcbiAgICAgICAgICAgIHdpbmRvdy5zcGxpdC5mb2N1cyAnY29tbWFuZGxpbmUnXG4gICAgICAgICAgICBpZiBAZ2V0VGV4dCgpICE9IGVkaXRvci50ZXh0T2ZIaWdobGlnaHQoKSBhbmQgbm90IGVtcHR5IGVkaXRvci50ZXh0T2ZIaWdobGlnaHQoKVxuICAgICAgICAgICAgICAgIEBzZXRUZXh0IGVkaXRvci50ZXh0T2ZIaWdobGlnaHQoKVxuICAgICAgICAgICAgXG4gICAgICAgIEB0eXBlID0gQHR5cGVzW0BuYW1lcy5pbmRleE9mIG5hbWVdXG4gICAgICAgIFxuICAgICAgICBzdXBlciBuYW1lXG5cbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgICAgICAgMDAwMDAwMCAgIDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMFxuICAgIFxuICAgIGNhbmNlbDogLT5cbiAgICAgICAgXG4gICAgICAgIEBoaWRlTGlzdCgpICBcbiAgICAgICAgZm9jdXM6IEByZWNlaXZlclxuICAgICAgICBzaG93OiAnZWRpdG9yJ1xuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwICBcblxuICAgIGNoYW5nZWQ6IChjb21tYW5kKSAtPlxuICAgICAgICBcbiAgICAgICAgc3VwZXIgY29tbWFuZFxuICAgICAgICBcbiAgICAgICAgaWYgY29tbWFuZC5sZW5ndGhcbiAgICAgICAgICAgIGlmIEB0eXBlIGluIFsncmVnJywgJ1JlZyddIGFuZCBjb21tYW5kLnRyaW0oKSBpbiBbJ14nLCAnJCcsICdeJCcsICcuJywgJz8nLCAnXFxcXCcsICdcXFxcYiddXG4gICAgICAgICAgICAgICAgd2luZG93LnRleHRFZGl0b3IuY2xlYXJIaWdobGlnaHRzKClcbiAgICAgICAgICAgIGVsc2UgaWYgbm90IGNvbW1hbmQudHJpbSgpLnN0YXJ0c1dpdGgoJ3wnKSBhbmQgbm90IGNvbW1hbmQudHJpbSgpLmVuZHNXaXRoKCd8JylcbiAgICAgICAgICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5oaWdobGlnaHRUZXh0IGNvbW1hbmQsIFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAgIEB0eXBlXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogJ2tlZXAnXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmNsZWFySGlnaGxpZ2h0cygpXG4gICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMDAwMDAgICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMDBcbiAgICBcbiAgICBleGVjdXRlOiAoY29tbWFuZCkgLT5cbiAgICAgICAgXG4gICAgICAgIGNvbW1hbmQgPSBzdXBlciBjb21tYW5kXG4gICAgICAgIFxuICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5oaWdobGlnaHRUZXh0IGNvbW1hbmQsIFxuICAgICAgICAgICAgdHlwZTogQHR5cGVcbiAgICAgICAgICAgIHNlbGVjdDogJ2FmdGVyJ1xuICAgICAgICAgICAgICAgIFxuICAgICAgICB0ZXh0OiAgIGNvbW1hbmRcbiAgICAgICAgc2VsZWN0OiB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwIDAwMCBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICBcbiAgICBcbiAgICBoYW5kbGVNb2RLZXlDb21ib0V2ZW50OiAobW9kLCBrZXksIGNvbWJvLCBldmVudCkgLT4gXG4gICAgICAgIFxuICAgICAgICBzd2l0Y2ggY29tYm9cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAnc2hpZnQrZW50ZXInLCAnY29tbWFuZCtzaGlmdCtnJ1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmhpZ2hsaWdodFRleHQgQGdldFRleHQoKSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogQHR5cGVcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiAnYmVmb3JlJ1xuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHdoZW4gJ2NvbW1hbmQrZycgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgQGV4ZWN1dGUgQGdldFRleHQoKSAgICBcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICd0YWInXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgd2luZG93LnRleHRFZGl0b3IuZm9jdXMoKVxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgc3VwZXIgbW9kLCBrZXksIGNvbWJvLCBldmVudFxuICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IEZpbmRcbiJdfQ==
//# sourceURL=../../coffee/commands/find.coffee