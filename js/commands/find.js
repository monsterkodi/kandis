// koffee 1.4.0

/*
00000000  000  000   000  0000000  
000       000  0000  000  000   000
000000    000  000 0 000  000   000
000       000  000  0000  000   000
000       000  000   000  0000000
 */
var Command, Find, empty, os, ref,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

ref = require('kxk'), empty = ref.empty, os = ref.os;

Command = require('../commandline/command');

Find = (function(superClass) {
    extend(Find, superClass);

    function Find(commandline) {
        Find.__super__.constructor.call(this, commandline);
        this.types = ['str', 'Str', 'reg', 'Reg', 'fuzzy', 'glob'];
        this.names = ['find', 'Find', '/find/', '/Find/', 'fiZd', 'f*nd'];
    }

    Find.prototype.historyKey = function() {
        return this.name;
    };

    Find.prototype.start = function(name) {
        var editor;
        if (name === 'find') {
            editor = this.receivingEditor();
            window.split.focus('commandline');
            if (this.getText() !== editor.textOfHighlight() && !empty(editor.textOfHighlight())) {
                this.setText(editor.textOfHighlight());
            }
        }
        this.type = this.types[this.names.indexOf(name)];
        return Find.__super__.start.call(this, name);
    };

    Find.prototype.cancel = function() {
        this.hideList();
        return {
            focus: this.receiver,
            show: 'editor'
        };
    };

    Find.prototype.changed = function(command) {
        var ref1, ref2;
        Find.__super__.changed.call(this, command);
        if (command.length) {
            if (((ref1 = this.type) === 'reg' || ref1 === 'Reg') && ((ref2 = command.trim()) === '^' || ref2 === '$' || ref2 === '^$' || ref2 === '.' || ref2 === '?' || ref2 === '\\' || ref2 === '\\b')) {
                return window.textEditor.clearHighlights();
            } else if (!command.trim().startsWith('|') && !command.trim().endsWith('|')) {
                return window.textEditor.highlightText(command, {
                    type: this.type,
                    select: 'keep'
                });
            }
        } else {
            return window.textEditor.clearHighlights();
        }
    };

    Find.prototype.execute = function(command) {
        command = Find.__super__.execute.call(this, command);
        window.textEditor.highlightText(command, {
            type: this.type,
            select: 'after'
        });
        return {
            text: command,
            select: true
        };
    };

    Find.prototype.handleModKeyComboEvent = function(mod, key, combo, event) {
        switch (combo) {
            case 'shift+enter':
            case 'command+shift+g':
                window.textEditor.highlightText(this.getText(), {
                    type: this.type,
                    select: 'before'
                });
                return;
            case 'command+g':
                this.execute(this.getText());
                return;
            case 'tab':
                window.textEditor.focus();
                return;
        }
        return Find.__super__.handleModKeyComboEvent.call(this, mod, key, combo, event);
    };

    return Find;

})(Command);

module.exports = Find;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmluZC5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsNkJBQUE7SUFBQTs7O0FBUUEsTUFBZ0IsT0FBQSxDQUFRLEtBQVIsQ0FBaEIsRUFBRSxpQkFBRixFQUFTOztBQUVULE9BQUEsR0FBVSxPQUFBLENBQVEsd0JBQVI7O0FBRUo7OztJQUVDLGNBQUMsV0FBRDtRQUVDLHNDQUFNLFdBQU47UUFFQSxJQUFDLENBQUEsS0FBRCxHQUFTLENBQUMsS0FBRCxFQUFRLEtBQVIsRUFBZ0IsS0FBaEIsRUFBeUIsS0FBekIsRUFBa0MsT0FBbEMsRUFBMEMsTUFBMUM7UUFDVCxJQUFDLENBQUEsS0FBRCxHQUFTLENBQUMsTUFBRCxFQUFRLE1BQVIsRUFBZ0IsUUFBaEIsRUFBeUIsUUFBekIsRUFBa0MsTUFBbEMsRUFBMEMsTUFBMUM7SUFMVjs7bUJBT0gsVUFBQSxHQUFZLFNBQUE7ZUFBRyxJQUFDLENBQUE7SUFBSjs7bUJBUVosS0FBQSxHQUFPLFNBQUMsSUFBRDtBQUVILFlBQUE7UUFBQSxJQUFHLElBQUEsS0FBUSxNQUFYO1lBQ0ksTUFBQSxHQUFTLElBQUMsQ0FBQSxlQUFELENBQUE7WUFDVCxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQWIsQ0FBbUIsYUFBbkI7WUFDQSxJQUFHLElBQUMsQ0FBQSxPQUFELENBQUEsQ0FBQSxLQUFjLE1BQU0sQ0FBQyxlQUFQLENBQUEsQ0FBZCxJQUEyQyxDQUFJLEtBQUEsQ0FBTSxNQUFNLENBQUMsZUFBUCxDQUFBLENBQU4sQ0FBbEQ7Z0JBQ0ksSUFBQyxDQUFBLE9BQUQsQ0FBUyxNQUFNLENBQUMsZUFBUCxDQUFBLENBQVQsRUFESjthQUhKOztRQU1BLElBQUMsQ0FBQSxJQUFELEdBQVEsSUFBQyxDQUFBLEtBQU0sQ0FBQSxJQUFDLENBQUEsS0FBSyxDQUFDLE9BQVAsQ0FBZSxJQUFmLENBQUE7ZUFFZixnQ0FBTSxJQUFOO0lBVkc7O21CQWtCUCxNQUFBLEdBQVEsU0FBQTtRQUVKLElBQUMsQ0FBQSxRQUFELENBQUE7ZUFDQTtZQUFBLEtBQUEsRUFBTyxJQUFDLENBQUEsUUFBUjtZQUNBLElBQUEsRUFBTSxRQUROOztJQUhJOzttQkFZUixPQUFBLEdBQVMsU0FBQyxPQUFEO0FBRUwsWUFBQTtRQUFBLGtDQUFNLE9BQU47UUFFQSxJQUFHLE9BQU8sQ0FBQyxNQUFYO1lBQ0ksSUFBRyxTQUFBLElBQUMsQ0FBQSxLQUFELEtBQVUsS0FBVixJQUFBLElBQUEsS0FBaUIsS0FBakIsQ0FBQSxJQUE0QixTQUFBLE9BQU8sQ0FBQyxJQUFSLENBQUEsRUFBQSxLQUFtQixHQUFuQixJQUFBLElBQUEsS0FBdUIsR0FBdkIsSUFBQSxJQUFBLEtBQTJCLElBQTNCLElBQUEsSUFBQSxLQUFnQyxHQUFoQyxJQUFBLElBQUEsS0FBb0MsR0FBcEMsSUFBQSxJQUFBLEtBQXdDLElBQXhDLElBQUEsSUFBQSxLQUE2QyxLQUE3QyxDQUEvQjt1QkFDSSxNQUFNLENBQUMsVUFBVSxDQUFDLGVBQWxCLENBQUEsRUFESjthQUFBLE1BRUssSUFBRyxDQUFJLE9BQU8sQ0FBQyxJQUFSLENBQUEsQ0FBYyxDQUFDLFVBQWYsQ0FBMEIsR0FBMUIsQ0FBSixJQUF1QyxDQUFJLE9BQU8sQ0FBQyxJQUFSLENBQUEsQ0FBYyxDQUFDLFFBQWYsQ0FBd0IsR0FBeEIsQ0FBOUM7dUJBQ0QsTUFBTSxDQUFDLFVBQVUsQ0FBQyxhQUFsQixDQUFnQyxPQUFoQyxFQUNJO29CQUFBLElBQUEsRUFBUSxJQUFDLENBQUEsSUFBVDtvQkFDQSxNQUFBLEVBQVEsTUFEUjtpQkFESixFQURDO2FBSFQ7U0FBQSxNQUFBO21CQVFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsZUFBbEIsQ0FBQSxFQVJKOztJQUpLOzttQkFvQlQsT0FBQSxHQUFTLFNBQUMsT0FBRDtRQUVMLE9BQUEsR0FBVSxrQ0FBTSxPQUFOO1FBRVYsTUFBTSxDQUFDLFVBQVUsQ0FBQyxhQUFsQixDQUFnQyxPQUFoQyxFQUNJO1lBQUEsSUFBQSxFQUFNLElBQUMsQ0FBQSxJQUFQO1lBQ0EsTUFBQSxFQUFRLE9BRFI7U0FESjtlQUlBO1lBQUEsSUFBQSxFQUFRLE9BQVI7WUFDQSxNQUFBLEVBQVEsSUFEUjs7SUFSSzs7bUJBaUJULHNCQUFBLEdBQXdCLFNBQUMsR0FBRCxFQUFNLEdBQU4sRUFBVyxLQUFYLEVBQWtCLEtBQWxCO0FBRXBCLGdCQUFPLEtBQVA7QUFBQSxpQkFFUyxhQUZUO0FBQUEsaUJBRXVCLGlCQUZ2QjtnQkFJUSxNQUFNLENBQUMsVUFBVSxDQUFDLGFBQWxCLENBQWdDLElBQUMsQ0FBQSxPQUFELENBQUEsQ0FBaEMsRUFDSTtvQkFBQSxJQUFBLEVBQU0sSUFBQyxDQUFBLElBQVA7b0JBQ0EsTUFBQSxFQUFRLFFBRFI7aUJBREo7QUFHQTtBQVBSLGlCQVNTLFdBVFQ7Z0JBV1EsSUFBQyxDQUFBLE9BQUQsQ0FBUyxJQUFDLENBQUEsT0FBRCxDQUFBLENBQVQ7QUFDQTtBQVpSLGlCQWNTLEtBZFQ7Z0JBZ0JRLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBbEIsQ0FBQTtBQUNBO0FBakJSO2VBbUJBLGlEQUFNLEdBQU4sRUFBVyxHQUFYLEVBQWdCLEtBQWhCLEVBQXVCLEtBQXZCO0lBckJvQjs7OztHQXBGVDs7QUEyR25CLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAwMDBcbjAwMDAwMCAgICAwMDAgIDAwMCAwIDAwMCAgMDAwICAgMDAwXG4wMDAgICAgICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMFxuMDAwICAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICBcbiMjI1xuXG57IGVtcHR5LCBvcyB9ID0gcmVxdWlyZSAna3hrJ1xuXG5Db21tYW5kID0gcmVxdWlyZSAnLi4vY29tbWFuZGxpbmUvY29tbWFuZCdcblxuY2xhc3MgRmluZCBleHRlbmRzIENvbW1hbmRcblxuICAgIEA6IChjb21tYW5kbGluZSkgLT5cbiAgICAgICAgXG4gICAgICAgIHN1cGVyIGNvbW1hbmRsaW5lXG4gICAgICAgIFxuICAgICAgICBAdHlwZXMgPSBbJ3N0cicgICdTdHInICAgJ3JlZycgICAgJ1JlZycgICAgJ2Z1enp5JyAnZ2xvYiddXG4gICAgICAgIEBuYW1lcyA9IFsnZmluZCcgJ0ZpbmQnICAnL2ZpbmQvJyAnL0ZpbmQvJyAnZmlaZCcgICdmKm5kJ11cbiAgICAgICBcbiAgICBoaXN0b3J5S2V5OiAtPiBAbmFtZVxuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICAgICAwMDAgICBcbiAgICAjICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICBcbiAgICAgICAgXG4gICAgc3RhcnQ6IChuYW1lKSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgbmFtZSA9PSAnZmluZCdcbiAgICAgICAgICAgIGVkaXRvciA9IEByZWNlaXZpbmdFZGl0b3IoKVxuICAgICAgICAgICAgd2luZG93LnNwbGl0LmZvY3VzICdjb21tYW5kbGluZSdcbiAgICAgICAgICAgIGlmIEBnZXRUZXh0KCkgIT0gZWRpdG9yLnRleHRPZkhpZ2hsaWdodCgpIGFuZCBub3QgZW1wdHkgZWRpdG9yLnRleHRPZkhpZ2hsaWdodCgpXG4gICAgICAgICAgICAgICAgQHNldFRleHQgZWRpdG9yLnRleHRPZkhpZ2hsaWdodCgpXG4gICAgICAgICAgICBcbiAgICAgICAgQHR5cGUgPSBAdHlwZXNbQG5hbWVzLmluZGV4T2YgbmFtZV1cbiAgICAgICAgXG4gICAgICAgIHN1cGVyIG5hbWVcblxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwXG4gICAgXG4gICAgY2FuY2VsOiAtPlxuICAgICAgICBcbiAgICAgICAgQGhpZGVMaXN0KCkgIFxuICAgICAgICBmb2N1czogQHJlY2VpdmVyXG4gICAgICAgIHNob3c6ICdlZGl0b3InXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAgIFxuXG4gICAgY2hhbmdlZDogKGNvbW1hbmQpIC0+XG4gICAgICAgIFxuICAgICAgICBzdXBlciBjb21tYW5kXG4gICAgICAgIFxuICAgICAgICBpZiBjb21tYW5kLmxlbmd0aFxuICAgICAgICAgICAgaWYgQHR5cGUgaW4gWydyZWcnLCAnUmVnJ10gYW5kIGNvbW1hbmQudHJpbSgpIGluIFsnXicgJyQnICdeJCcgJy4nICc/JyAnXFxcXCcgJ1xcXFxiJ11cbiAgICAgICAgICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5jbGVhckhpZ2hsaWdodHMoKVxuICAgICAgICAgICAgZWxzZSBpZiBub3QgY29tbWFuZC50cmltKCkuc3RhcnRzV2l0aCgnfCcpIGFuZCBub3QgY29tbWFuZC50cmltKCkuZW5kc1dpdGgoJ3wnKVxuICAgICAgICAgICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmhpZ2hsaWdodFRleHQgY29tbWFuZCwgXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICAgQHR5cGVcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiAna2VlcCdcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgd2luZG93LnRleHRFZGl0b3IuY2xlYXJIaWdobGlnaHRzKClcbiAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMFxuICAgIFxuICAgIGV4ZWN1dGU6IChjb21tYW5kKSAtPlxuICAgICAgICBcbiAgICAgICAgY29tbWFuZCA9IHN1cGVyIGNvbW1hbmRcbiAgICAgICAgXG4gICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmhpZ2hsaWdodFRleHQgY29tbWFuZCwgXG4gICAgICAgICAgICB0eXBlOiBAdHlwZVxuICAgICAgICAgICAgc2VsZWN0OiAnYWZ0ZXInXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHRleHQ6ICAgY29tbWFuZFxuICAgICAgICBzZWxlY3Q6IHRydWVcbiAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMCAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgIFxuICAgIFxuICAgIGhhbmRsZU1vZEtleUNvbWJvRXZlbnQ6IChtb2QsIGtleSwgY29tYm8sIGV2ZW50KSAtPiBcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBjb21ib1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdzaGlmdCtlbnRlcicgJ2NvbW1hbmQrc2hpZnQrZydcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5oaWdobGlnaHRUZXh0IEBnZXRUZXh0KCksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IEB0eXBlXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogJ2JlZm9yZSdcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdjb21tYW5kK2cnIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIEBleGVjdXRlIEBnZXRUZXh0KCkgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAndGFiJ1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmZvY3VzKClcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIHN1cGVyIG1vZCwga2V5LCBjb21ibywgZXZlbnRcbiAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBGaW5kXG4iXX0=
//# sourceURL=../../coffee/commands/find.coffee