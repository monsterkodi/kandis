// koffee 1.4.0

/*
00000000  000  000   000  0000000  
000       000  0000  000  000   000
000000    000  000 0 000  000   000
000       000  000  0000  000   000
000       000  000   000  0000000
 */
var Command, Find, empty,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

empty = require('kxk').empty;

Command = require('../commandline/command');

Find = (function(superClass) {
    extend(Find, superClass);

    function Find(commandline) {
        Find.__super__.constructor.call(this, commandline);
        this.types = ['str', 'Str', 'reg', 'Reg', 'fuzzy', 'glob'];
        this.names = ['find', 'Find', '/find/', '/Find/', 'fiZd', 'f*nd'];
    }

    Find.prototype.historyKey = function() {
        return this.name;
    };

    Find.prototype.start = function(name) {
        var editor;
        if (name === 'find') {
            editor = this.receivingEditor();
            window.split.focus('commandline');
            if (this.getText() !== editor.textOfHighlight() && !empty(editor.textOfHighlight())) {
                this.setText(editor.textOfHighlight());
            }
        }
        this.type = this.types[this.names.indexOf(name)];
        return Find.__super__.start.call(this, name);
    };

    Find.prototype.cancel = function() {
        this.hideList();
        return {
            focus: this.receiver,
            show: 'editor'
        };
    };

    Find.prototype.changed = function(command) {
        var ref, ref1;
        Find.__super__.changed.call(this, command);
        if (command.length) {
            if (((ref = this.type) === 'reg' || ref === 'Reg') && ((ref1 = command.trim()) === '^' || ref1 === '$' || ref1 === '^$' || ref1 === '.' || ref1 === '?' || ref1 === '\\' || ref1 === '\\b')) {
                return window.textEditor.clearHighlights();
            } else if (!command.trim().startsWith('|') && !command.trim().endsWith('|')) {
                return window.textEditor.highlightText(command, {
                    type: this.type,
                    select: 'keep'
                });
            }
        } else {
            return window.textEditor.clearHighlights();
        }
    };

    Find.prototype.execute = function(command) {
        command = Find.__super__.execute.call(this, command);
        window.textEditor.highlightText(command, {
            type: this.type,
            select: 'after'
        });
        return {
            text: command,
            select: true
        };
    };

    Find.prototype.handleModKeyComboEvent = function(mod, key, combo, event) {
        switch (combo) {
            case 'shift+enter':
            case 'command+shift+g':
                window.textEditor.highlightText(this.getText(), {
                    type: this.type,
                    select: 'before'
                });
                return;
            case 'command+g':
                this.execute(this.getText());
                return;
            case 'tab':
                window.textEditor.focus();
                return;
        }
        return Find.__super__.handleModKeyComboEvent.call(this, mod, key, combo, event);
    };

    return Find;

})(Command);

module.exports = Find;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmluZC5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsb0JBQUE7SUFBQTs7O0FBUUUsUUFBVSxPQUFBLENBQVEsS0FBUjs7QUFFWixPQUFBLEdBQVUsT0FBQSxDQUFRLHdCQUFSOztBQUVKOzs7SUFFQyxjQUFDLFdBQUQ7UUFFQyxzQ0FBTSxXQUFOO1FBRUEsSUFBQyxDQUFBLEtBQUQsR0FBUyxDQUFDLEtBQUQsRUFBUSxLQUFSLEVBQWdCLEtBQWhCLEVBQXlCLEtBQXpCLEVBQWtDLE9BQWxDLEVBQTBDLE1BQTFDO1FBQ1QsSUFBQyxDQUFBLEtBQUQsR0FBUyxDQUFDLE1BQUQsRUFBUSxNQUFSLEVBQWdCLFFBQWhCLEVBQXlCLFFBQXpCLEVBQWtDLE1BQWxDLEVBQTBDLE1BQTFDO0lBTFY7O21CQU9ILFVBQUEsR0FBWSxTQUFBO2VBQUcsSUFBQyxDQUFBO0lBQUo7O21CQVFaLEtBQUEsR0FBTyxTQUFDLElBQUQ7QUFFSCxZQUFBO1FBQUEsSUFBRyxJQUFBLEtBQVEsTUFBWDtZQUNJLE1BQUEsR0FBUyxJQUFDLENBQUEsZUFBRCxDQUFBO1lBQ1QsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFiLENBQW1CLGFBQW5CO1lBQ0EsSUFBRyxJQUFDLENBQUEsT0FBRCxDQUFBLENBQUEsS0FBYyxNQUFNLENBQUMsZUFBUCxDQUFBLENBQWQsSUFBMkMsQ0FBSSxLQUFBLENBQU0sTUFBTSxDQUFDLGVBQVAsQ0FBQSxDQUFOLENBQWxEO2dCQUNJLElBQUMsQ0FBQSxPQUFELENBQVMsTUFBTSxDQUFDLGVBQVAsQ0FBQSxDQUFULEVBREo7YUFISjs7UUFNQSxJQUFDLENBQUEsSUFBRCxHQUFRLElBQUMsQ0FBQSxLQUFNLENBQUEsSUFBQyxDQUFBLEtBQUssQ0FBQyxPQUFQLENBQWUsSUFBZixDQUFBO2VBRWYsZ0NBQU0sSUFBTjtJQVZHOzttQkFrQlAsTUFBQSxHQUFRLFNBQUE7UUFFSixJQUFDLENBQUEsUUFBRCxDQUFBO2VBQ0E7WUFBQSxLQUFBLEVBQU8sSUFBQyxDQUFBLFFBQVI7WUFDQSxJQUFBLEVBQU0sUUFETjs7SUFISTs7bUJBWVIsT0FBQSxHQUFTLFNBQUMsT0FBRDtBQUVMLFlBQUE7UUFBQSxrQ0FBTSxPQUFOO1FBRUEsSUFBRyxPQUFPLENBQUMsTUFBWDtZQUNJLElBQUcsUUFBQSxJQUFDLENBQUEsS0FBRCxLQUFVLEtBQVYsSUFBQSxHQUFBLEtBQWlCLEtBQWpCLENBQUEsSUFBNEIsU0FBQSxPQUFPLENBQUMsSUFBUixDQUFBLEVBQUEsS0FBbUIsR0FBbkIsSUFBQSxJQUFBLEtBQXVCLEdBQXZCLElBQUEsSUFBQSxLQUEyQixJQUEzQixJQUFBLElBQUEsS0FBZ0MsR0FBaEMsSUFBQSxJQUFBLEtBQW9DLEdBQXBDLElBQUEsSUFBQSxLQUF3QyxJQUF4QyxJQUFBLElBQUEsS0FBNkMsS0FBN0MsQ0FBL0I7dUJBQ0ksTUFBTSxDQUFDLFVBQVUsQ0FBQyxlQUFsQixDQUFBLEVBREo7YUFBQSxNQUVLLElBQUcsQ0FBSSxPQUFPLENBQUMsSUFBUixDQUFBLENBQWMsQ0FBQyxVQUFmLENBQTBCLEdBQTFCLENBQUosSUFBdUMsQ0FBSSxPQUFPLENBQUMsSUFBUixDQUFBLENBQWMsQ0FBQyxRQUFmLENBQXdCLEdBQXhCLENBQTlDO3VCQUNELE1BQU0sQ0FBQyxVQUFVLENBQUMsYUFBbEIsQ0FBZ0MsT0FBaEMsRUFDSTtvQkFBQSxJQUFBLEVBQVEsSUFBQyxDQUFBLElBQVQ7b0JBQ0EsTUFBQSxFQUFRLE1BRFI7aUJBREosRUFEQzthQUhUO1NBQUEsTUFBQTttQkFRSSxNQUFNLENBQUMsVUFBVSxDQUFDLGVBQWxCLENBQUEsRUFSSjs7SUFKSzs7bUJBb0JULE9BQUEsR0FBUyxTQUFDLE9BQUQ7UUFFTCxPQUFBLEdBQVUsa0NBQU0sT0FBTjtRQUVWLE1BQU0sQ0FBQyxVQUFVLENBQUMsYUFBbEIsQ0FBZ0MsT0FBaEMsRUFDSTtZQUFBLElBQUEsRUFBTSxJQUFDLENBQUEsSUFBUDtZQUNBLE1BQUEsRUFBUSxPQURSO1NBREo7ZUFJQTtZQUFBLElBQUEsRUFBUSxPQUFSO1lBQ0EsTUFBQSxFQUFRLElBRFI7O0lBUks7O21CQWlCVCxzQkFBQSxHQUF3QixTQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsS0FBWCxFQUFrQixLQUFsQjtBQUVwQixnQkFBTyxLQUFQO0FBQUEsaUJBRVMsYUFGVDtBQUFBLGlCQUV1QixpQkFGdkI7Z0JBSVEsTUFBTSxDQUFDLFVBQVUsQ0FBQyxhQUFsQixDQUFnQyxJQUFDLENBQUEsT0FBRCxDQUFBLENBQWhDLEVBQ0k7b0JBQUEsSUFBQSxFQUFNLElBQUMsQ0FBQSxJQUFQO29CQUNBLE1BQUEsRUFBUSxRQURSO2lCQURKO0FBR0E7QUFQUixpQkFTUyxXQVRUO2dCQVdRLElBQUMsQ0FBQSxPQUFELENBQVMsSUFBQyxDQUFBLE9BQUQsQ0FBQSxDQUFUO0FBQ0E7QUFaUixpQkFjUyxLQWRUO2dCQWdCUSxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQWxCLENBQUE7QUFDQTtBQWpCUjtlQW1CQSxpREFBTSxHQUFOLEVBQVcsR0FBWCxFQUFnQixLQUFoQixFQUF1QixLQUF2QjtJQXJCb0I7Ozs7R0FwRlQ7O0FBMkduQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICBcbjAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAgICAgMDAwICAwMDAgMCAwMDAgIDAwMCAgIDAwMFxuMDAwICAgICAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDBcbjAwMCAgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgXG4jIyNcblxueyBlbXB0eSB9ID0gcmVxdWlyZSAna3hrJ1xuXG5Db21tYW5kID0gcmVxdWlyZSAnLi4vY29tbWFuZGxpbmUvY29tbWFuZCdcblxuY2xhc3MgRmluZCBleHRlbmRzIENvbW1hbmRcblxuICAgIEA6IChjb21tYW5kbGluZSkgLT5cbiAgICAgICAgXG4gICAgICAgIHN1cGVyIGNvbW1hbmRsaW5lXG4gICAgICAgIFxuICAgICAgICBAdHlwZXMgPSBbJ3N0cicgICdTdHInICAgJ3JlZycgICAgJ1JlZycgICAgJ2Z1enp5JyAnZ2xvYiddXG4gICAgICAgIEBuYW1lcyA9IFsnZmluZCcgJ0ZpbmQnICAnL2ZpbmQvJyAnL0ZpbmQvJyAnZmlaZCcgICdmKm5kJ11cbiAgICAgICBcbiAgICBoaXN0b3J5S2V5OiAtPiBAbmFtZVxuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICAgICAwMDAgICBcbiAgICAjICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICBcbiAgICAgICAgXG4gICAgc3RhcnQ6IChuYW1lKSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgbmFtZSA9PSAnZmluZCdcbiAgICAgICAgICAgIGVkaXRvciA9IEByZWNlaXZpbmdFZGl0b3IoKVxuICAgICAgICAgICAgd2luZG93LnNwbGl0LmZvY3VzICdjb21tYW5kbGluZSdcbiAgICAgICAgICAgIGlmIEBnZXRUZXh0KCkgIT0gZWRpdG9yLnRleHRPZkhpZ2hsaWdodCgpIGFuZCBub3QgZW1wdHkgZWRpdG9yLnRleHRPZkhpZ2hsaWdodCgpXG4gICAgICAgICAgICAgICAgQHNldFRleHQgZWRpdG9yLnRleHRPZkhpZ2hsaWdodCgpXG4gICAgICAgICAgICBcbiAgICAgICAgQHR5cGUgPSBAdHlwZXNbQG5hbWVzLmluZGV4T2YgbmFtZV1cbiAgICAgICAgXG4gICAgICAgIHN1cGVyIG5hbWVcblxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwXG4gICAgXG4gICAgY2FuY2VsOiAtPlxuICAgICAgICBcbiAgICAgICAgQGhpZGVMaXN0KCkgIFxuICAgICAgICBmb2N1czogQHJlY2VpdmVyXG4gICAgICAgIHNob3c6ICdlZGl0b3InXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAgIFxuXG4gICAgY2hhbmdlZDogKGNvbW1hbmQpIC0+XG4gICAgICAgIFxuICAgICAgICBzdXBlciBjb21tYW5kXG4gICAgICAgIFxuICAgICAgICBpZiBjb21tYW5kLmxlbmd0aFxuICAgICAgICAgICAgaWYgQHR5cGUgaW4gWydyZWcnLCAnUmVnJ10gYW5kIGNvbW1hbmQudHJpbSgpIGluIFsnXicgJyQnICdeJCcgJy4nICc/JyAnXFxcXCcgJ1xcXFxiJ11cbiAgICAgICAgICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5jbGVhckhpZ2hsaWdodHMoKVxuICAgICAgICAgICAgZWxzZSBpZiBub3QgY29tbWFuZC50cmltKCkuc3RhcnRzV2l0aCgnfCcpIGFuZCBub3QgY29tbWFuZC50cmltKCkuZW5kc1dpdGgoJ3wnKVxuICAgICAgICAgICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmhpZ2hsaWdodFRleHQgY29tbWFuZCwgXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICAgQHR5cGVcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiAna2VlcCdcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgd2luZG93LnRleHRFZGl0b3IuY2xlYXJIaWdobGlnaHRzKClcbiAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMFxuICAgIFxuICAgIGV4ZWN1dGU6IChjb21tYW5kKSAtPlxuICAgICAgICBcbiAgICAgICAgY29tbWFuZCA9IHN1cGVyIGNvbW1hbmRcbiAgICAgICAgXG4gICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmhpZ2hsaWdodFRleHQgY29tbWFuZCwgXG4gICAgICAgICAgICB0eXBlOiBAdHlwZVxuICAgICAgICAgICAgc2VsZWN0OiAnYWZ0ZXInXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHRleHQ6ICAgY29tbWFuZFxuICAgICAgICBzZWxlY3Q6IHRydWVcbiAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMCAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgIFxuICAgIFxuICAgIGhhbmRsZU1vZEtleUNvbWJvRXZlbnQ6IChtb2QsIGtleSwgY29tYm8sIGV2ZW50KSAtPiBcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCBjb21ib1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdzaGlmdCtlbnRlcicgJ2NvbW1hbmQrc2hpZnQrZydcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB3aW5kb3cudGV4dEVkaXRvci5oaWdobGlnaHRUZXh0IEBnZXRUZXh0KCksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IEB0eXBlXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDogJ2JlZm9yZSdcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB3aGVuICdjb21tYW5kK2cnIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIEBleGVjdXRlIEBnZXRUZXh0KCkgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgd2hlbiAndGFiJ1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHdpbmRvdy50ZXh0RWRpdG9yLmZvY3VzKClcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIHN1cGVyIG1vZCwga2V5LCBjb21ibywgZXZlbnRcbiAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBGaW5kXG4iXX0=
//# sourceURL=../../coffee/commands/find.coffee