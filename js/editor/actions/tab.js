// koffee 1.4.0
var _, ref, stopEvent;

ref = require('kxk'), stopEvent = ref.stopEvent, _ = ref._;

module.exports = {
    actions: {
        insertOrDeleteTab: {
            combos: ['tab', 'shift+tab']
        }
    },
    insertOrDeleteTab: function(key, info) {
        stopEvent(info != null ? info.event : void 0);
        switch (info.combo) {
            case 'tab':
                return this.insertTab();
            case 'shift+tab':
                return this.deleteTab();
        }
    },
    insertTab: function() {
        var c, i, il, len, n, newCursors;
        if (this.numSelections()) {
            return this.indent();
        } else {
            this["do"].start();
            newCursors = this["do"].cursors();
            il = this.indentString.length;
            for (i = 0, len = newCursors.length; i < len; i++) {
                c = newCursors[i];
                n = 4 - (c[0] % il);
                this["do"].change(c[1], this["do"].line(c[1]).splice(c[0], 0, _.padStart("", n)));
                cursorDelta(c, n);
            }
            this["do"].setCursors(newCursors);
            return this["do"].end();
        }
    },
    deleteTab: function() {
        var c, i, len, n, newCursors, t;
        if (this.numSelections()) {
            return this.deIndent();
        } else {
            this["do"].start();
            newCursors = this["do"].cursors();
            for (i = 0, len = newCursors.length; i < len; i++) {
                c = newCursors[i];
                if (c[0]) {
                    n = (c[0] % this.indentString.length) || this.indentString.length;
                    t = this["do"].textInRange([c[1], [c[0] - n, c[0]]]);
                    if (t.trim().length === 0) {
                        this["do"].change(c[1], this["do"].line(c[1]).splice(c[0] - n, n));
                        cursorDelta(c, -n);
                    }
                }
            }
            this["do"].setCursors(newCursors);
            return this["do"].end();
        }
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBT0EsSUFBQTs7QUFBQSxNQUFtQixPQUFBLENBQVEsS0FBUixDQUFuQixFQUFFLHlCQUFGLEVBQWE7O0FBRWIsTUFBTSxDQUFDLE9BQVAsR0FFSTtJQUFBLE9BQUEsRUFDSTtRQUFBLGlCQUFBLEVBQ0k7WUFBQSxNQUFBLEVBQVEsQ0FBQyxLQUFELEVBQVEsV0FBUixDQUFSO1NBREo7S0FESjtJQUlBLGlCQUFBLEVBQW1CLFNBQUMsR0FBRCxFQUFNLElBQU47UUFFZixTQUFBLGdCQUFVLElBQUksQ0FBRSxjQUFoQjtBQUVBLGdCQUFPLElBQUksQ0FBQyxLQUFaO0FBQUEsaUJBQ1MsS0FEVDt1QkFDMEIsSUFBQyxDQUFBLFNBQUQsQ0FBQTtBQUQxQixpQkFFUyxXQUZUO3VCQUUwQixJQUFDLENBQUEsU0FBRCxDQUFBO0FBRjFCO0lBSmUsQ0FKbkI7SUFZQSxTQUFBLEVBQVcsU0FBQTtBQUVQLFlBQUE7UUFBQSxJQUFHLElBQUMsQ0FBQSxhQUFELENBQUEsQ0FBSDttQkFDSSxJQUFDLENBQUEsTUFBRCxDQUFBLEVBREo7U0FBQSxNQUFBO1lBR0ksSUFBQyxFQUFBLEVBQUEsRUFBRSxDQUFDLEtBQUosQ0FBQTtZQUNBLFVBQUEsR0FBYSxJQUFDLEVBQUEsRUFBQSxFQUFFLENBQUMsT0FBSixDQUFBO1lBQ2IsRUFBQSxHQUFLLElBQUMsQ0FBQSxZQUFZLENBQUM7QUFDbkIsaUJBQUEsNENBQUE7O2dCQUNJLENBQUEsR0FBSSxDQUFBLEdBQUUsQ0FBQyxDQUFFLENBQUEsQ0FBQSxDQUFGLEdBQUssRUFBTjtnQkFDTixJQUFDLEVBQUEsRUFBQSxFQUFFLENBQUMsTUFBSixDQUFXLENBQUUsQ0FBQSxDQUFBLENBQWIsRUFBaUIsSUFBQyxFQUFBLEVBQUEsRUFBRSxDQUFDLElBQUosQ0FBUyxDQUFFLENBQUEsQ0FBQSxDQUFYLENBQWMsQ0FBQyxNQUFmLENBQXNCLENBQUUsQ0FBQSxDQUFBLENBQXhCLEVBQTRCLENBQTVCLEVBQStCLENBQUMsQ0FBQyxRQUFGLENBQVcsRUFBWCxFQUFlLENBQWYsQ0FBL0IsQ0FBakI7Z0JBQ0EsV0FBQSxDQUFZLENBQVosRUFBZSxDQUFmO0FBSEo7WUFJQSxJQUFDLEVBQUEsRUFBQSxFQUFFLENBQUMsVUFBSixDQUFlLFVBQWY7bUJBQ0EsSUFBQyxFQUFBLEVBQUEsRUFBRSxDQUFDLEdBQUosQ0FBQSxFQVhKOztJQUZPLENBWlg7SUEyQkEsU0FBQSxFQUFXLFNBQUE7QUFFUCxZQUFBO1FBQUEsSUFBRyxJQUFDLENBQUEsYUFBRCxDQUFBLENBQUg7bUJBQ0ksSUFBQyxDQUFBLFFBQUQsQ0FBQSxFQURKO1NBQUEsTUFBQTtZQUdJLElBQUMsRUFBQSxFQUFBLEVBQUUsQ0FBQyxLQUFKLENBQUE7WUFDQSxVQUFBLEdBQWEsSUFBQyxFQUFBLEVBQUEsRUFBRSxDQUFDLE9BQUosQ0FBQTtBQUNiLGlCQUFBLDRDQUFBOztnQkFDSSxJQUFHLENBQUUsQ0FBQSxDQUFBLENBQUw7b0JBQ0ksQ0FBQSxHQUFJLENBQUMsQ0FBRSxDQUFBLENBQUEsQ0FBRixHQUFPLElBQUMsQ0FBQSxZQUFZLENBQUMsTUFBdEIsQ0FBQSxJQUFpQyxJQUFDLENBQUEsWUFBWSxDQUFDO29CQUNuRCxDQUFBLEdBQUksSUFBQyxFQUFBLEVBQUEsRUFBRSxDQUFDLFdBQUosQ0FBZ0IsQ0FBQyxDQUFFLENBQUEsQ0FBQSxDQUFILEVBQU8sQ0FBQyxDQUFFLENBQUEsQ0FBQSxDQUFGLEdBQUssQ0FBTixFQUFTLENBQUUsQ0FBQSxDQUFBLENBQVgsQ0FBUCxDQUFoQjtvQkFDSixJQUFHLENBQUMsQ0FBQyxJQUFGLENBQUEsQ0FBUSxDQUFDLE1BQVQsS0FBbUIsQ0FBdEI7d0JBQ0ksSUFBQyxFQUFBLEVBQUEsRUFBRSxDQUFDLE1BQUosQ0FBVyxDQUFFLENBQUEsQ0FBQSxDQUFiLEVBQWlCLElBQUMsRUFBQSxFQUFBLEVBQUUsQ0FBQyxJQUFKLENBQVMsQ0FBRSxDQUFBLENBQUEsQ0FBWCxDQUFjLENBQUMsTUFBZixDQUFzQixDQUFFLENBQUEsQ0FBQSxDQUFGLEdBQUssQ0FBM0IsRUFBOEIsQ0FBOUIsQ0FBakI7d0JBQ0EsV0FBQSxDQUFZLENBQVosRUFBZSxDQUFDLENBQWhCLEVBRko7cUJBSEo7O0FBREo7WUFPQSxJQUFDLEVBQUEsRUFBQSxFQUFFLENBQUMsVUFBSixDQUFlLFVBQWY7bUJBQ0EsSUFBQyxFQUFBLEVBQUEsRUFBRSxDQUFDLEdBQUosQ0FBQSxFQWJKOztJQUZPLENBM0JYIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbiMgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXHJcbiMgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXHJcbiMgICAgMDAwICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgXHJcbiMgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXHJcbiMgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXHJcblxyXG57IHN0b3BFdmVudCwgXyB9ID0gcmVxdWlyZSAna3hrJ1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBcclxuICAgIFxyXG4gICAgYWN0aW9uczpcclxuICAgICAgICBpbnNlcnRPckRlbGV0ZVRhYjpcclxuICAgICAgICAgICAgY29tYm9zOiBbJ3RhYicsICdzaGlmdCt0YWInXVxyXG4gICAgICAgIFxyXG4gICAgaW5zZXJ0T3JEZWxldGVUYWI6IChrZXksIGluZm8pIC0+XHJcbiAgICAgICAgXHJcbiAgICAgICAgc3RvcEV2ZW50IGluZm8/LmV2ZW50XHJcbiAgICAgICAgXHJcbiAgICAgICAgc3dpdGNoIGluZm8uY29tYm9cclxuICAgICAgICAgICAgd2hlbiAndGFiJyAgICAgICB0aGVuIEBpbnNlcnRUYWIoKVxyXG4gICAgICAgICAgICB3aGVuICdzaGlmdCt0YWInIHRoZW4gQGRlbGV0ZVRhYigpXHJcbiAgICAgICAgICAgIFxyXG4gICAgaW5zZXJ0VGFiOiAtPlxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIEBudW1TZWxlY3Rpb25zKClcclxuICAgICAgICAgICAgQGluZGVudCgpXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBAZG8uc3RhcnQoKVxyXG4gICAgICAgICAgICBuZXdDdXJzb3JzID0gQGRvLmN1cnNvcnMoKVxyXG4gICAgICAgICAgICBpbCA9IEBpbmRlbnRTdHJpbmcubGVuZ3RoXHJcbiAgICAgICAgICAgIGZvciBjIGluIG5ld0N1cnNvcnNcclxuICAgICAgICAgICAgICAgIG4gPSA0LShjWzBdJWlsKVxyXG4gICAgICAgICAgICAgICAgQGRvLmNoYW5nZSBjWzFdLCBAZG8ubGluZShjWzFdKS5zcGxpY2UgY1swXSwgMCwgXy5wYWRTdGFydCBcIlwiLCBuXHJcbiAgICAgICAgICAgICAgICBjdXJzb3JEZWx0YSBjLCBuXHJcbiAgICAgICAgICAgIEBkby5zZXRDdXJzb3JzIG5ld0N1cnNvcnNcclxuICAgICAgICAgICAgQGRvLmVuZCgpICAgXHJcblxyXG4gICAgZGVsZXRlVGFiOiAtPlxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIEBudW1TZWxlY3Rpb25zKClcclxuICAgICAgICAgICAgQGRlSW5kZW50KClcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIEBkby5zdGFydCgpXHJcbiAgICAgICAgICAgIG5ld0N1cnNvcnMgPSBAZG8uY3Vyc29ycygpXHJcbiAgICAgICAgICAgIGZvciBjIGluIG5ld0N1cnNvcnNcclxuICAgICAgICAgICAgICAgIGlmIGNbMF1cclxuICAgICAgICAgICAgICAgICAgICBuID0gKGNbMF0gJSBAaW5kZW50U3RyaW5nLmxlbmd0aCkgb3IgQGluZGVudFN0cmluZy5sZW5ndGhcclxuICAgICAgICAgICAgICAgICAgICB0ID0gQGRvLnRleHRJblJhbmdlIFtjWzFdLCBbY1swXS1uLCBjWzBdXV1cclxuICAgICAgICAgICAgICAgICAgICBpZiB0LnRyaW0oKS5sZW5ndGggPT0gMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBAZG8uY2hhbmdlIGNbMV0sIEBkby5saW5lKGNbMV0pLnNwbGljZSBjWzBdLW4sIG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yRGVsdGEgYywgLW5cclxuICAgICAgICAgICAgQGRvLnNldEN1cnNvcnMgbmV3Q3Vyc29yc1xyXG4gICAgICAgICAgICBAZG8uZW5kKClcclxuXHJcbiJdfQ==
//# sourceURL=../../../coffee/editor/actions/tab.coffee